<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Mathematical description</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect2">
<h3 id="_mathematical_description">Mathematical description</h3>
<div class="paragraph">
<p>The goal of the Model Exchange interface is to numerically solve a system of differential,
algebraic and
discrete-time equations.
In this version of the interface,
ordinary differential equations in state-space
form with events are handled (abbreviated as "hybrid ODE").
Algebraic equation systems might be
contained inside the FMU.
Also, the FMU might consist of discrete-time equations only,
for example, describing a sampled-data controller.</p>
</div>
<div class="paragraph">
<p>The independent variable time \(t \in \mathbb{T}\) is a tuple
\(t = (t_R,t_I)\), where \(t_R \in \mathbb{R},\ t_{I} \in \mathbb{N} = \{0, 1, 2, \ldots\}\).
The real part \(t_R\) of this tuple is the independent variable of the FMU for describing the continuous-time behavior of the model between events.
In this phase \(t_I = 0\).
The integer part \(t_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).
This time definition is also called "super dense time" in literature,
see, for instance, (Lee and Zheng 2007).
An ordering is defined on \(\mathbb{\text{T}}\) leading to the following notation
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 58.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Operation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Mathematical meaning</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 &lt; t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{R1},t_{I1}) &lt; (t_{R2}, t_{I2})\ \Leftrightarrow \ t_{R1} &lt; t_{R2}\ \textbf{or} \ t_{R1}= t_{R2} \ \textbf{and} \ t_{I1} &lt; t_{I2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is before \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 = t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{R1},t_{I1}) = (t_{R2},t_{I2}) \ \Leftrightarrow  t_{R1}= t_{R2}\ \textbf{and} \ t_{I1} = t_{I2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is identical to \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t^{+}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({{(t}_{R},t_{I})}^{+} \Leftrightarrow (\lim_{\epsilon \rightarrow 0}{\left(t_{R} + \varepsilon \right),t_{Imax})}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">right limit at \(t\).
\(t_{Imax}\) is the largest occurring Integer index of super dense time</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^-t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{-}{{(t}_{R},t_{I})} \Leftrightarrow (\lim_{\epsilon \rightarrow 0}{\left( t_{R} - \varepsilon \right),0)}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left limit at \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{\bullet}{\left( t_{R},t_{I} \right)\ } \Leftrightarrow \left\{ \begin{matrix} ^-t \ &amp; \mathbf{if} \ t_I = 0 \\ (t_R, t_I - 1) \ &amp; \mathbf{if} \ t_I &gt; 0 \\ \end{matrix} \right.\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous time instant (= either left limit or previous event instant).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v^+\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(t^+)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the right limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{-}v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^-t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the left limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^{\bullet}t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous value (= either left limit or value from the previous event)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Assume that an FMU has an event at \(t_R=2.1s\) and here a signal changes discontinuously.
If no event
iteration occurs,
the time instant when the event occurs is defined as (2.1, 0),
and the time instant whenthe integration is restarted is defined as (2.1, 1).]</em></p>
</div>
<div class="paragraph">
<p>The hybrid ODEs supported by FMI are described as <span class="underline">piecewise continuous-time systems</span>.
Discontinuities
can occur at time instants \(t_0, t_1, \ldots, t_n\) where \(t_i &lt; t_{i+1}\).
These time instants are called "events".
Events can
be known before hand (= time event),
or are defined implicitly (= state and step events), see below.
Between events, variables are either continuous or do not change their value.
A variable is called
discrete-time, if it changes its value only at an event instant.
Otherwise the variable is called continuoustime.
Only real variables can be continuous-time.
The following variable indices are used to describe the timing behavior of the corresponding variable
(for example, 𝑣𝑑 is a discrete-time variable).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Index</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>continuous-time</strong> variable,
that is, a variable that is a continuous function of time inside each interval \(t_i^+ &lt; \ ^-t_{i+1}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>discrete-time</strong> variable,
that is, a variable that changes its value only at an event instant \(t_i\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c+d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of <strong>continuous-time</strong> and <strong>discrete-time</strong> variables</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At every event instant \(t_i\), variables might be discontinuous (see Figure 3).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/PieceWiseContinuousVariables.svg" alt="PieceWiseContinuousVariables" width="60%">
</div>
<div class="title">Figure 3: Piecewise-continuous variables of an FMU: continuous-time (\(v_c\)) and discrete-time (\(v_d\)).</div>
</div>
<div class="paragraph">
<p>An <span class="underline">event instant</span> \(t_i\) is defined by one of the following conditions that give the smallest time instant:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The environment of the FMU triggers an event at the current time instant because at least one discrete-time input changes its value,
a continuous-time input has a discontinuous change,
or a tunable parameter changes its value.
Such an event is called <span class="underline">external event</span>.
 <em>[Note that if an FMU A is connected to an FMU B, and an event is triggered for A,
 then potentially all outputs of A will be discontinuous at this time instant.
 It is therefore adviceable to trigger an external event for B at this time instant too,
 if an output of A is connected to B.
 This means to call <code>fmi2EnterEventMode</code> on B.]</em><br>
All the following events are internal events.</p>
</li>
<li>
<p>At a predefined time instant \(t_i=(T_{next}(t_{i-1}, 0)\)
that was defined at the previous event instant ti-1 by the FMU.
Such an event is called <span class="underline">time event</span>.</p>
</li>
<li>
<p>At a time instant,
where an <span class="underline">event indicator</span> \(z_j(t)\) changes its domain from \(z_j &gt; 0\) to \(z_j \leq 0\) or from \(z_j \leq 0\) to \(z_j &gt; 0\) (see Figure 4 below).
More precisely: An event \(t = t_i\) occurs at the smallest time instant "min t" with \(t&gt;t_{i-1}\) where "\((z_j(t)&gt;0) \ne (z_j(t_{i-1}) &gt;0)\)".
Such an event is called <span class="underline">state event</span>
<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>.
All event indicators are piecewise continuous and are collected together in one vector of real numbers \(\mathbf{z(t)}\).<br></p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Event.svg" alt="Event" width="60%">
</div>
<div class="title">Figure 4: An event occurs when the event indicator changes its domain from \(z&gt;0\) to \(z\leq 0\) or vice versa.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>At every completed step of an integrator,
<code>fmi2CompletedIntegratorStep</code> must be called (provided the capability flag <code>ModelDescription.completedIntegratorStepNotNeeded = false</code>).
An event occurs at this time instant,
if indicated by the return argument <code>enterEventMode = fmi2True</code>.
Such an event is called <span class="underline">step event</span>.
<em>[Step events are,
for example, used to dynamically change the (continuous) states of a model internally in the FMU,
because the previous states are no longer suited numerically.]</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An FMI Model-Exchange model is described by the following variables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Variable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Independent variable time \(\in \mathbb{T}\).
(Variable defined with <code>causality = "independent"</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of all exposed variables (all variables defined in element <code>&lt;ModelVariables&gt;</code>,
see section 2.2.7).
A subset of the variables is selected via a subscript.
Example: \(\mathbf{v}_{initial=exact}\) are variables defined with attribute <code>initial ="exact"</code> (see section 2.2.7).
These are independent parameters and startvalues of other variables,
such as initial values for states, state derivatives or outputs.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters that are constant during simulation.
The symbol without a subscript references independent parameters (variables with <code>causality = "parameter"</code>).
Dependent parameters (variables with <code>causality = "calculatedParameter"</code>) are denoted as \(\mathbf{p}_{calculated}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{u}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <code>causality = "input"</code>.
Whether the input is a discrete-time or continuous-time variable is defined
via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> (see section 2.2.7).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{y}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU and they are designed to be used in a model connection.
For instance, output variables might be used in the environment as input values to other FMUs or other submodels.
Variables of this type are defined with attribute <code>causality = "output"</code>.
Whether the output is a discrete-time or continuous-time variable is defined
via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> (see section 2.2.7).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{w}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that cannot be used for FMU connections.
Variables of this type are defined with attribute <code>causality = "local"</code>, see section 2.2.7.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{z}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of real continuous-time variables utilized to define state events, see below.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_c(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of real continuous-time variables representing the continuous-time states.
For notational convenience,
a continuous-time state is conceptually treated as a different type of variable as an output or a local variable for the mathematical description below.
In reality, a continuous-time state is however part of the outputs \(\mathbf{y}\) or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\)<br>
\(^{\bullet}\mathbf{x}_d(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\) is a vector of (internal) discrete-time variables (of any type) representing the discrete states.<br>
\({}^{\bullet}\mathbf{x}_d(t)\) a is the value of \(\mathbf{x}_d(t)\) at the previous super dense time instant,
so \({}^{\bullet}\mathbf{x}_d(t)=\mathbf{x}_d({}^{\bullet}t)\).
Given the previous values of the discrete-time states,
\({}^{\bullet}\mathbf{x}_d(t)\), at the actual time instant \(t\),
all other discrete-time variables,
especially the discrete states \(\mathbf{x}_d(t)\), can be computed.<br>
Discrete states are not visible in the interface of an FMU and are only introduced here to clarify the mathematical description.
Formally, a discrete state is part of the outputs \(\mathbf{y}\) or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(T_{next}(t_{i})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At initialization or at an event insant,
an FMU can define the next time instant \(T_{next}\),
at which the next event occurs (see also the definition of events above).
Every event removes automatically a previous definition of \(T_{next}\),
and it must be explicitly defined again,
if a previously defined \(T_{next}\) was not triggered at the current event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{r}(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of Boolean variables with \(r_{i} := z_{i} &gt; 0\).
When entering Continuous-Time Mode all relations reported via the event indicators \(\mathbf{z}\) are fixed and during this Mode these relations are replaced by \(\mathbf{r}\).
Only during Initialization or Event Mode the domains \(z_{i} &gt; 0\) can be changed.
For notational convenience,
\(\mathbf{r} := \mathbf{z} &gt; 0\)is an abbreviation for \(\mathbf{r}:=\{z_1&gt;0, z_2&gt;0, \ldots \}\).
<em>[For more details, see "Remark 3" below.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Computing the solution of an FMI model means to split the solution process in different phases, and in
every phase different equations and solution methods are utilized.
The phases can be categorized
according to the following modes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Initialization Mode:</strong><br>
This mode is used to compute at the start time stem[t_0] initial values for continuous-time states,
\(\mathbf{x}_c(t_0)\),
and for the previous (internal) discrete-time states,
\(\mathbf{x}_d(t_0)\),
by utilizing extra equations not present in the other modes (for example, equations to define the start value for a state or for the derivative of a state).</p>
</li>
<li>
<p><strong>Continuous-Time Mode:</strong><br>
This mode is used to compute the values of all (real) continuous-time variables between events by numerically solving ordinary differential and algebraic equations.
All discrete-time variables are fixed during this phase and the corresponding discrete-time equations are not evaluated.</p>
</li>
<li>
<p><strong>Event Mode:</strong><br>
This mode is used to compute new values for all continuous-time variables,
as well as for all discrete-time variables that are activated at the current event instant \(t\),
given the values of the variables from the previous instant \({}^{\bullet}t\).
This is performed by solving algebraic equations consisting
of all continuous-time and all active discrete-time equations.
In FMI 2.0 there is no mechanism that the FMU can provide the information whether a discrete-time variable is active or is not active (is not computed) at an event instant.
Therefore, the environment has to assume that at an event instant always all discrete-time variables are computed,
although internally in the FMU only a subset might be newly computed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When connecting FMUs together,
loop structures can occur that lead to particular difficulties because
linear or non-linear algebraic systems of equations in Real variables but also in Boolean or Integer
variables might be present.
In order to solve such systems of equations over FMUs efficiently,
the dependency information is needed stating,
for example, which outputs depend directly on inputs.
This data is optionally provided in the XML file under element <code>&lt;ModelStructure&gt;</code>.
If this data is not provided,
the worst case must be assumed
(for example, all output variables depend algebraically on all input variables).</p>
</div>
<div class="paragraph">
<p><em>[Example: In Figure 5 two different types of connected FMUs are shown (the "dotted lines" characterize the dependency information):</em></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ArtificialAlgebraicLoop.svg" alt="ArtificialAlgebraicLoop" width="80%">
</div>
<div class="title">Figure 5: Calling sequences for FMUs that are connected in a loop.</div>
</div>
<div class="paragraph">
<p><em>In the upper diagram, FMU1 and FMU2 are connected in such a way that by an appropriate sequence of <code>fmi2SetXXX</code> and <code>fmi2GetXXX</code> calls, the FMU variables can be computed.
In the lower diagram, FMU3 and FMU4 are connected in such a way that a "real" algebraic loop is present.
This loop might be solved iteratively with a Newton method.
In every iteration the iteration variable u<sub>4</sub> is
provided by the solver, and via the shown sequence of <code>fmi2SetXXX</code> and <code>fmi2GetXXX</code> calls, the residue is computed and is provided back to the solver.
Based on the residue a new value of u<sub>4</sub> is provided.
The iteration is terminated when the residue is close to zero.
These types of artifical or real algebraic loops can occur in all the different modes,
such as Initialization Mode,
Event Mode, and Continuous-Time Mode.
Since different variables are computed in every Mode and the causality of variable computation can be different in Initialization Mode as with respect to the other two
Modes, it might be necessary to solve different kinds of loops in the different Modes.]</em></p>
</div>
<div class="paragraph">
<p>In Table 1 the equations are defined that can be evaluated in the respective Mode.
The following color coding is used in the table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="silver"><strong>grey</strong></span>: If a variable in an argument list is marked in <span class="silver">grey</span>,
then this variable is not changing in this mode and just the last calculated value from the previous mode is internally used.
For an input argument, it is not allowed to call <code>fmi2SetXXX</code>.
For an output argument,
calling <code>fmi2GetXXX</code> on such a variable returns always the same value in this mode.</p>
</li>
<li>
<p><span class="lime"><strong>green</strong></span>: Functions marked in <span class="lime">green</span> are special functions to enter or leave a mode.</p>
</li>
<li>
<p><span class="blue"><strong>blue</strong></span>: Equations and functions marked in <span class="blue">blue</span> define the actual computations to be performed in the respective mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Function <code>fmi2SetXXX</code> is an abbreviation for functions <code>fmi2SetReal</code>, <code>fmi2SetBoolean</code>,
<code>fmi2SetInteger</code> and <code>fmi2SetString</code> respectively.
Function <code>fmi2GetXXX</code> is an abbreviation for functions <code>fmi2GetReal</code>, <code>fmi2GetBoolean</code>,
<code>fmi2GetInteger</code> and <code>fmi2GetString</code> respectively.</p>
</div>
<div class="paragraph">
<p><em>[In the following table the setting of the super dense time, (t<sub>R</sub>, t<sub>I</sub>),
is precisely described.
Tools will usually not have such a representation of time.
However, super-dense time defines precisely when a new "model evaluation" starts
and therefore which variable values belong to the same "model evaluation" at
the same (super dense) time instant and should be stored together.]</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1: Mathematical description of an FMU for Model Exchange.</caption>
<colgroup>
<col style="width: 62.5%;">
<col style="width: 37.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Equations</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FMI functions</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations before Initialization Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(T_{R0}\) and define \(t_0 := (t_{R0},0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetupExperiment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{initial=exact}\) and \(\mathbf{v}_{initial=approx}\)  that have a start value (<code>initial</code> = <code>"exact"</code> or `"approx`")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Initialization Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Initialization Mode at \(t=t_0\) (activate initialization,
discrete-time and continuous-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2EnterInitializationMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{initial=exact}\) that have a start value with
<code>initial="exact"</code> (independent parameters \(\mathbf{p}\) and
continuous-time states with start values \(\mathbf{x_c}\),
initial=exact_~ are included here)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}(\color{grey}t_{\color{grey} 0})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\mathbf{v}_{initialUnknowns}:=f_{init}(\mathbf{u_c}, \mathbf{u_d}, \color{grey}t_{\color{grey} 0}, \mathbf{v}_{initial=exact}\))</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi2GetXXX</span></code>, <code><span class="blue">fmi2GetContinuousStates</span></code>,
<code><span class="blue">fmi2GetEventIndicators</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Exit Initialization Mode (de-activate initialization equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2ExitInitializationMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Event Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Event Mode at \(t = t_{i}\) with \({t_{i}\ : = (t}_{R},t_{I} + 1)\) <strong>if</strong>  <em>externalEvent</em> <strong>or</strong> <em>nextMode</em> \(\equiv\) <em>EventMode</em> <strong>or</strong> \(t_i=(T_{next}(t_{i-1}), 0)\) <strong>or</strong>  \(\min_{t&gt;t_{i-1}} t:\left\lbrack z_{j}\left( t \right) &gt; 0\  \neq \ z_{j}\left( t_{i - 1} \right) &gt; 0 \right\rbrack\)<br>
(activate discrete-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2EnterInitializationMode</span></code> <span class="lime">(only from Continuous-Time Mode or after calling</span> <code><span class="lime">fmi2SetTime</span></code>
<span class="lime">if FMU has no continuous-time equations)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent tunable parameters \(\mathbf{p}_{tune}\)<br>
(and do not set other parameters \(\mathbf{p}_{other}\))</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{w}_{c+d}, \mathbf{z}, \mathbf{x}_{c, reinit})=\mathbf{f}_{sim}(\mathbf{x_c}, \mathbf{u_{c+d}}, \color{grey}t_{\color{grey} i}, \mathbf{p}_{tune}, \color{grey}{\mathbf{p}_{other})}\)</span> <br>
\(\mathbf{f}_{sim}\)is also a function of the internal variables  \({}^\bullet\mathbf{x}_d\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi2GetXXX</span></code>,
<code><span class="blue">fmi2GetContinuousStates</span></code>,
<code><span class="blue">fmi2GetDerivatives</span></code>,
<code><span class="blue">fmi2GetEventIndicators</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Increment super dense time and define with</span>
<code><span class="lime">newDiscreteStatesNeeded</span></code> <span class="lime">whether a new event iteration is required.</span><br>
<span class="blue">\(\qquad\)<strong>if not</strong></span> <code><span class="blue">newDiscreteStatesNeeded</span></code><span class="blue"><strong>then</strong><br>
\(\qquad \qquad T_{next}=T_{next}(\mathbf{x}_c,{}^\bullet\mathbf{x}_d, \mathbf{u_{c+d}}, \color{grey}t_{\color{grey} i}, \mathbf{p}_{tune}, \color{grey}{\mathbf{p}_{other})}\)</span><br>
<span class="blue">\(\qquad\)<strong>end if</strong></span><br>
<span class="blue">\(\qquad t:=t(t_R, t_i+1)\)</span><br>
<span class="blue">\(\qquad {}^\bullet\mathbf{x}_d:=\mathbf{x}_d\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2NewDiscreteState</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(t_i := (T_{next},0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetTime</code><br>
(if no continuous-time equations)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Continuous-Time Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Continuous-Time Mode:</span><br>
<span class="lime">\(\qquad \textrm{// de-activate discrete-time equations}\)</span><br>
<span class="lime">\(\qquad \textrm{// "freeze" variables:}\)</span><br>
<span class="lime">\(\qquad \mathbf{r} := \mathbf{z}&gt;0 \qquad \textrm{//all relations}\)</span><br>
<span class="lime">\(\qquad \textbf{x}_d, \textbf{w}_d \qquad \textrm{//all discrete-time variables}\)</span><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2EnterContinuousTimeMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(t(&gt;t_{enter  mode}): t:=(t_R, 0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetTime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time inputs \(\mathbf{u}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time states \(\mathbf{x}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code>,
<code>fmi2SetContinuousStates</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="blue">\((\mathbf{y}_{c}\mathbf{,} \color{grey}{\mathbf{y}_{d}}\mathbf{,\ }{\dot{\mathbf{x}}}_{c}\mathbf{,}_{}\mathbf{w}_{c}\mathbf{,}\color{grey}{\mathbf{w}_{d}}\mathbf{,z,}\color{grey}{\mathbf{x}_{c,reinit}}):=\mathbf{f}_{sim}(\mathbf{x}_{c},\ \mathbf{u}_{c}\mathbf{,} \color{grey}{\mathbf{\ u}_{d}}, t,\color{grey}{\mathbf{p}_{tune},\mathbf{p}_{other}})\)</span><br>
<span class="blue">\(\qquad \mathbf{f}_{sim}\) is also a function of the internal variables</span> <span class="silver">\({}^\bullet\mathbf{x}_{d},\mathbf{r}\).</span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><span class="blue">fmi2GetXXX,</span></code>
<code><span class="blue">fmi2GetDerivatives,</span></code>
<code><span class="blue">fmi2GetEventIndicators</span></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Complete integrator step and return <em>enterEventMode</em></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2CompletedIntegratorStep</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Data types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">\(t \in \mathbb{R}, \mathbf{p} \in \mathbb{P}^{np},  \mathbf{u}(t) \in \mathbb{P}^{nu},\mathbf{y}(t) \in \mathbb{P}^{ny}, \mathbf{x}_c(t) \in \mathbb{R}^{nxc}, \mathbf{x}_d(t) \in \mathbb{P}^{nxd}, \mathbf{w}(t) \in \mathbb{P}^{nw}, \mathbf{z}(t) \in \mathbb{R}^{nz}\)<br>
\(\qquad \mathbb{R}\): Real variable, \(\mathbb{P}\): real <strong>or</strong> boolean <strong>or</strong> integer <strong>or</strong> enumeration <strong>or</strong> string variable<br>
\(\mathbf{f}_{init}, \mathbf{f}_{sim} \in C^0\) (=continuous functions with respect to all input arguments inside the respective mode).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Remark 1 - Calling Sequences:</em></p>
</div>
<div class="paragraph">
<p><em>In the table above, for notational convenience in every Mode one function call is defined to compute all output arguments from all inputs arguments.
In reality, every scalar output argument is computed by one
<code>fmi2GetXXX</code> function call.
Additionally, the output argument need not be a function of all input arguments,
but of only a subset from it, as defined in the XML file under</em> <code>&lt;ModelStructure&gt;</code>.
<em>This is essential when FMUs are connected in a loop,
as shown in</em> Figure 6: <em>For example, since</em> \(y_{2a}\) <em>depends only on</em>
\(u_{1a}\) <em>, but not on</em> \(u_{1b}\)<em>, it is
possible to call</em> <code>fmi2SetXXX</code> <em>to set</em> \(u_{1a}\) <em>,
and then inquire</em> \(y_{2a}\) <em>with</em> <code>fmi2GetXXX</code> <em>without setting</em> \(u_{1b}\) <em>beforehand.</em></p>
</div>
<div class="paragraph">
<p><em>It is non-trivial to provide code for <code>fmi2SetXXX</code>, <code>fmi2GetXXX</code>,
if the environment can call</em> <code>fmi2SetXXX</code> <em>on the inputs in quite different orders.
A simple remedy is to provide the <span class="underline">dependency information</span>, not according to the "real" functional dependency,
but according to the <span class="underline">sorted equations in the generated code</span>.
Example:</em></p>
</div>
<div class="paragraph">
<p>Assume an FMU is described by the following equations
(<code>u1</code>, <code>u2</code> are inputs, <code>y1</code>, <code>y2</code> are outputs,<code>w1</code>, <code>w2</code> are internal variables):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w1 = w2 + u1
w2 = u2
y1 = w1
y2 = w2</pre>
</div>
</div>
<div class="paragraph">
<p>Sorting of the equations might result in (this ordering is not unique):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w2 := u2
y2 := w2
w1 := w2 + u1
y1 := w1</pre>
</div>
</div>
<div class="paragraph">
<p>With this ordering, the dependency should be defined as <code>y2 = f(u2), y1 = f(u1,u2)</code>.
When <code>y2</code> is called first with <code>fmi2GetXXX</code>,
then only <code>u2</code> must be set first (since <code>y2 = f(u2)</code>),
and the first two equations are evaluated.
If later <code>y1</code> is inquired as well,
then the first two equations are not evaluated
again and only the last two equations are evaluated.
On the other hand,
if <code>y1</code> is inquired first,
then <code>u1</code> and <code>u2</code> must be set first (since <code>y1 = f(u1,u2)</code>) and then all equations are computed.
When <code>y2</code> is inquired afterwards,
the cached value is returned.</p>
</div>
<div class="paragraph">
<p>If sorting of the equations in this example would instead result in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w2 := u2
w1 := w2 + u1
y1 := w1
y2 := w2</pre>
</div>
</div>
<div class="paragraph">
<p>then the dependency should be defined as <code>y2 = f(u1,u2)</code>,
<code>y1 = f(u1,u2)</code>, because <code>u1</code> and <code>u2</code> must be first set,
before <code>y2</code> can be inquired with <code>fmi2GetXXX</code> when executing this code.</p>
</div>
<div class="paragraph">
<p><em>Remark 2 - Mathematical Model of Discrete-Time FMUs:</em></p>
</div>
<div class="paragraph">
<p><em>There are many different ways discrete-time systems are described.
For FMI, the following basic mathematical model for discrete-time systems is used
(other description forms must be mapped, as sketched below):</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/remark_2_source.png" alt="remark 2 source" width="70%">
</div>
</div>
<div class="paragraph">
<p><em>At an event instant,
the discrete system is described by algebraic equations as function of the previous (internal) discrete-time states</em> \(_{‍}^{\bullet}\mathbf{x}_{d}\) <em>and the discrete-time inputs</em> \(\mathbf{u}_{d}\)<em>.
If FMUs are connected in a loop, these algebraic equations are called iteratively,
until the solution is found.
If the actual discrete-time states</em> \(\mathbf{x}_{d}\) <em>and the previous discrete-time states</em> \(_{‍}^{\bullet}\mathbf{x}_{d}\) <em>are not identical,
the discrete-time states are updated,
the Integer part of the time is incremented and a new event iteration is performed.
Other discrete-time models must be mapped to this description form.
Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Synchronous systems:</em><br>
<em>A synchronous system,
such as Lucid Synchrone (Pouzet 2006) or Modelica 3.3 (Modelica 2012),
is called periodically, and at every sample instant the discrete-time equations are evaluated exactly once.
An FMU of this type can be implemented by activating the model equations only at the first event iteration and returning always <code>newDiscreteStatesNeeded = false</code> from <code>fmi2NewDiscreteStates</code>.
Furthermore, the discrete-time states are not updated by <code>fmi2NewDiscreteStates</code>,
but as first action before the discrete-time equations are evaluated,
in order that</em> \(^{\bullet}\mathbf{x}_d\) <em>(= value at the previous clock tick) and</em> \(\mathbf{x}_d\) <em>(value at the latest clock tick) have reasonable values between clock ticks.</em></p>
</li>
<li>
<p><em>State machines with one memory location for a state:</em><br>
<em>In such a system there is only one memory location for a discrete-time state and not two,
and therefore a discrete-time state is updated in the statement where it is assigned (and not in <code>fmi2NewDiscreteStates</code>).
As a result,
<code>fmi2NewDiscreteStates</code> is basically just used to start a new (super dense) time instant.
This is unproblematic, as long as no algebraic loops occur.
FMUs of this type can therefore not be used in "real" algebraic loops if the involved variables depend on a discrete-time state.
This restriction is communicated to the environment of the FMU by the <code>ScalarVariable</code> definition of the corresponding input with flag <code>canHandleMultipleSetPerTimeInstant = false</code> (so an input with this flag is not allowed to be called in an algebraic loop).</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Remark 3 - Event Indicators / Freezing Relations:</em></p>
</div>
<div class="paragraph">
<p><em>In the above table, vector</em> <strong>r</strong> <em>is used to collect all relations together that are utilized in the event indicators</em> <strong>z</strong> <em>.
In Continuous-Time Mode all these relations are "frozen" and do not change during the evaluations in the respective Mode.
This is indicated in the table above by computing_</em> <strong>r</strong> <em>when entering the Continuous-Time Mode and providing</em> <strong>r</strong> <em>as (internal) input argument to the evaluation functions.
Example:</em></p>
</div>
<div class="paragraph">
<p><em>An equation of the form</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = if x1 &gt; x2 or x1 &lt; x3 then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>can be implemented in the FMU as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>z1 := x1 - x2;
z2 := x3 - x1;
if InitializationMode or EventMode then
  r1 := z1 &gt; 0;
  r2 := z2 &gt; 0;
end if;
y = if r1 or r2 then +1 else -1</pre>
</div>
</div>
<div class="paragraph">
<p><em>Therefore,
the original if-clause is evaluated in this form only during Initialization and Event Mode.
In Continuous-Time Mode this equation is evaluated as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>z1 = x1 - x2;
z2 = x3 - x1
y = if r1 or r2 then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>and when entering Continuous-Time Mode r1 and r2 are computed as</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>r1 = z1 &gt; 0
r2 = z2 &gt; 0</pre>
</div>
</div>
<div class="paragraph">
<p><em>When z1 changes from z1 &gt; 0 to z1 &#8656; 0 or vice versa, or z2 correspondingly,
the integration is halted, and the environment must call <code>fmi2EnterEventMode</code>.</em></p>
</div>
<div class="paragraph">
<p><em>An actual implementation will pack the code in an impure function,
say Greater(&#8230;&#8203;), resulting in:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = if Greater(x1-x2,...) or Greater(x3-x1,...) then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>Furthermore, a hysteresis should be added for the event indicators.</em></p>
</div>
<div class="paragraph">
<p><em>Remark 4 - Pure Discrete-Time FMUs:</em></p>
</div>
<div class="paragraph">
<p><em>If an FMU has only discrete-time equations (and no variables with <code>variability = "continuous"</code>),
then the environment need not call <code>fmi2EnterContinuousTimeMode</code> but can directly call
<code>fmi2SetTime</code> to set the value of the next event instant,
before <code>fmi2EnterEventMode</code> is called.
<strong>This is an optional optimization for the master, the FMU must support all functions that are required for a continuous time FMU and should run in a master that treats it as such.</strong>
If a Pure Discrete time FMU has state events and uses crossing functions, it has to enter continuousTimeMode to evaluate these.
In fact it is no longer a Pure Discrete time FMU but this was not clearly defined in 2.0 so this clarification is needed for 2.0.1]</em></p>
</div>
<div class="paragraph">
<p>An FMU is initialized in Initialization Mode with \(\mathbf{f}_{init}(\ldots)\).
The input arguments to this function consist of the input variables (= variables with <code>causality = "input"</code>),
of the independent variable (= variable with <code>causality = "independent"</code>; usually the default value <code>"time"</code>), and of all variables that have a start value with (explicitly or implicitly) <code>initial = "exact"</code> in order to compute the continuous-time states and the output variables at the initial time \(t_0\).
In the above table,
the variables with <code>initial = "exact"</code> are collected together in variable \(\mathbf{v}_{initial=exact}\).
For example, initialization might be defined by providing initial start values for the states,
\(\mathbf{x}_{c0}\),
or by stating that the state derivatives are zero (\(\dot{\mathbf{x}}_{c} = \mathbf{0}\)).
Initialization is a difficult topic by itself, and it is required that an FMU solves a well-defined initialization problem inside the FMU in Initialization Mode.<br>
After calling <code>fmi2ExitInitializationMode</code>, the FMU is implicitly in Event Mode, and all discrete-time and continuous-time variables at the initial time instant \((t_R, 0)\) can be calculated.
If these variables are present in an algebraic loop,
iteration can be used to compute them.
Once finalized, <code>fmi2NewDiscreteStates</code> must be called,
and depending on the value of the return argument,
the FMU either continues the event iteration at the initial time instant or switches to Continuous-Time Mode.<br>
After switching to Continuous-Time Mode, the integration is started.
Basically, in this phase the derivatives of the continuous states are computed.
If FMUs and/or submodels are connected together,
then the inputs of these models are the outputs of other models, and therefore, the corresponding FMU outputs must be computed.
Whenever result values shall be stored,
usually at output points defined before the start of the simulation,
the <code>fmi2GetXXX</code> function with respect to the desired variables must be called.<br>
Continuous integration is stopped at an event instant.
An event instant is determined by a time,
state or step event, or by an external event triggered by the environment.
In order to determine a state event,
the event indicators <strong>z</strong> have to be inquired at every completed integrator step.
Once the event indicators signal a change of their domain,
an iteration over time is performed between the previous and the actual completed integrator step,
in order to determine the time instant of the domain change up to a certain precision.<br>
After an event is triggered,
the FMU needs to be switched to Event Mode.
In this mode, systems of equations over connected FMUs might be solved (similarily as in Continuous-Time Mode).
Once convergence is reached,
<code>fmi2NewDiscreteStates(..)</code> must be called to increment super dense time (and conceptually update the discrete-time states defined internally in the FMU by \(^{\bullet}\mathbf{x}_d := \mathbf{x}_d\)).
Depending on the discrete-time model,
a new event iteration might be needed
(for example, because the FMU describes internally a state machine
and transitions are still able to fire,
but new inputs shall be taken into account).<br>
The function calls in the table above describe precisely
which input arguments are needed to compute the desired output argument(s).
There is no 1:1 mapping of these mathematical functions to C functions.
Instead, all input arguments are set with <code>fmi2SetXXX(..)</code> C function calls, and then the result argument(s) can be determined with the C functions defined in the right column of the above table.
This technique is discussed in detail in section 3.2.1.
<em><span class="In short:
For efficiency reasons">one</span> (internal) C function.
With the C functions described in the next sections,
input arguments are copied into the internal model data structure only when their value has changed in the environment.
With the C functions in the right column of the table above,
the internal function is called in such a way
that only the minimum needed equations are evaluated.
Hereby, variable values calculated from previous calls can be reused.
This technique is called "caching" and can significantly enhance the simulation efficiency of real-world models.]</em></p>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. The notation \(^{\bullet}t\) is from (<em>Benveniste et.al. 2010</em>) adapted from non-standard analysis to super-dense time, in order to precisely define the value from the previous event iteration.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. This definition is slightly different from the standard definition of state events: "\(z_j(t) \cdot z_j(t_{i-1}) \leq 0\)". This often used definition has the severe drawback that \(z_j(t_{i-1}) \ne 0\) is required in order to be well-defined and this condition cannot be guaranteed.
</div>
</div>
</body>
</html>
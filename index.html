<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<title>Functional Mock-up Interface for Model&#160;Exchange and Co-Simulation</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:30em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* customizations */

/*
div.paragraph.indented p {
  text-indent: 3em;
}

.indented {
  padding-left: 3em;
}
*/

body{
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}

.toc-hidden {
  padding-left: 0 !important;
}

.imageblock {
  text-align: center;
}

.imageblock img {
  display: block;
  margin: auto;
}

.imageblock .title {
  display: inline-block;
  margin: auto;
}

.indented p {
  margin-left: 3em;
  text-indent: -3em;
}

.indented2 > p {
  margin-left: 3em;
}

.indented2 > ul {
 margin-left: 0;
 padding-left: 4.5em;
}

/* first line normal, rest indented */
.second-indented p {
  margin-left: 3em;
  text-indent: -3em;
}

.vertical-text {
	transform: rotate(-90deg) translate(-8em, 0);
	transform-origin: left top 0;
  float: left;
  display: inline-block;
  white-space: nowrap;
  width: 1em;
  height: 8em;
}

/* no alternating row colors */
table tr.even,table tr.alt,table tr:nth-of-type(even) {
  background:none
}

/* use parent text color for captions */
.subheader, .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title, .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title, .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title, .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
  color: inherit;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Functional Mock-up Interface for Model&#160;Exchange and Co-Simulation</h1>
<div class="details">
<span id="revnumber">version 2.0.3,</span>
<span id="revdate">unreleased</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contents</div>
<ul class="sectlevel1">
<li><a href="#_概要">1. 概要</a>
<ul class="sectlevel2">
<li><a href="#_特性と指針となる考え方">1.1. 特性と指針となる考え方</a></li>
<li><a href="#_謝辞">1.2. 謝辞</a></li>
</ul>
</li>
<li><a href="#_モデル交換とコシミュレーションに関するfmiの共通概念">2. モデル交換とコ・シミュレーションに関するFMIの共通概念</a>
<ul class="sectlevel2">
<li><a href="#_fmiアプリケーションプログラミングインターフェース">2.1. FMIアプリケーション・プログラミング・インターフェース</a>
<ul class="sectlevel3">
<li><a href="#_ヘッダーファイルと関数名の命名">2.1.1. ヘッダーファイルと関数名の命名</a></li>
<li><a href="#_プラットフォームに依存する定義_fmi2typesplatform_h">2.1.2. プラットフォームに依存する定義 (fmi2TypesPlatform.h)</a></li>
<li><a href="#_関数が返すステータス">2.1.3. 関数が返すステータス</a></li>
<li><a href="#_ヘッダーファイルのプラットフォームとバージョン番号の照会">2.1.4. ヘッダーファイルのプラットフォームとバージョン番号の照会</a></li>
<li><a href="#_fmuインスタンスの作成破棄ログの記録">2.1.5. FMUインスタンスの作成、破棄、ログの記録</a></li>
<li><a href="#_initialization_termination_and_resetting_an_fmu">2.1.6. Initialization, Termination, and Resetting an FMU</a></li>
<li><a href="#_getting_and_setting_variable_values">2.1.7. Getting and Setting Variable Values</a></li>
<li><a href="#GetSetCompleteFMUState">2.1.8. FMU Complete Stateの取得と設定</a></li>
<li><a href="#_偏微分の取得">2.1.9. 偏微分の取得</a></li>
</ul>
</li>
<li><a href="#_fmi_description_schema">2.2. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#_definition_of_an_fmu_fmimodeldescription">2.2.1. Definition of an FMU (fmiModelDescription)</a></li>
<li><a href="#_definition_of_units_unitdefinitions">2.2.2. Definition of Units (UnitDefinitions)</a></li>
<li><a href="#_definition_of_types_typedefinitions">2.2.3. Definition of Types (TypeDefinitions)</a></li>
<li><a href="#_definition_of_log_categories_logcategories">2.2.4. Definition of Log Categories (LogCategories)</a></li>
<li><a href="#_definition_of_a_default_experiment_defaultexperiment">2.2.5. Definition of a Default Experiment (DefaultExperiment)</a></li>
<li><a href="#_definition_of_vendor_annotations_vendorannotations">2.2.6. Definition of Vendor Annotations (VendorAnnotations)</a></li>
<li><a href="#_definition_of_model_variables_modelvariables">2.2.7. Definition of Model Variables (ModelVariables)</a></li>
<li><a href="#_definition_of_the_model_structure_modelstructure">2.2.8. Definition of the Model Structure (ModelStructure)</a></li>
<li><a href="#_variable_naming_conventions_variablenamingconvention">2.2.9. Variable Naming Conventions (variableNamingConvention)</a></li>
</ul>
</li>
<li><a href="#_fmu_distribution">2.3. FMU Distribution</a></li>
</ul>
</li>
<li><a href="#_fmi_for_model_exchange">3. FMI for Model Exchange</a>
<ul class="sectlevel2">
<li><a href="#_mathematical_description">3.1. Mathematical description</a></li>
<li><a href="#_fmi_application_programming_interface">3.2. FMI Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#_providing_independent_variables_and_re_initialization_of_caching">3.2.1. Providing Independent Variables and Re-initialization of Caching</a></li>
<li><a href="#_evaluation_of_model_equations">3.2.2. Evaluation of Model Equations</a></li>
<li><a href="#_state_machine_of_calling_sequence">3.2.3. State Machine of Calling Sequence</a></li>
<li><a href="#_pseudocode_example">3.2.4. Pseudocode Example</a></li>
</ul>
</li>
<li><a href="#_fmi_description_schema_2">3.3. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#_model_exchange_fmu_modelexchange">3.3.1. Model Exchange FMU (ModelExchange)</a></li>
<li><a href="#_example_xml_description_file">3.3.2. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_fmi_for_cosimulation">4. FMI for Co‑Simulation</a>
<ul class="sectlevel2">
<li><a href="#_mathematical_description_2">4.1. Mathematical Description</a>
<ul class="sectlevel3">
<li><a href="#_basics">4.1.1. Basics</a></li>
<li><a href="#_mathematical_model">4.1.2. Mathematical Model</a></li>
</ul>
</li>
<li><a href="#_fmi_application_programming_interface_2">4.2. FMI Application Programming Interface</a>
<ul class="sectlevel3">
<li><a href="#_transfer_of_input_output_values_and_parameters">4.2.1. Transfer of Input / Output Values and Parameters</a></li>
<li><a href="#_computation">4.2.2. Computation</a></li>
<li><a href="#_retrieving_status_information_from_the_slave">4.2.3. Retrieving Status Information from the Slave</a></li>
<li><a href="#_state_machine_of_calling_sequence_from_master_to_slave">4.2.4. State Machine of Calling Sequence from Master to Slave</a></li>
<li><a href="#_pseudocode_example_2">4.2.5. Pseudocode Example</a></li>
</ul>
</li>
<li><a href="#_fmi_description_schema_3">4.3. FMI Description Schema</a>
<ul class="sectlevel3">
<li><a href="#_co_simulation_fmu_cosimulation">4.3.1. Co-Simulation FMU (CoSimulation)</a></li>
<li><a href="#_example_xml_description_file_2">4.3.2. Example XML Description File</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_literature">5. Literature</a></li>
<li><a href="#_fmi_revision_history">Appendix A: FMI Revision History</a>
<ul class="sectlevel2">
<li><a href="#_a_1_version_1_0_fmi_for_model_exchange">A.1 Version 1.0 – FMI for Model Exchange</a></li>
<li><a href="#_a_2_version_1_0_fmi_for_co_simulation">A.2 Version 1.0 – FMI for Co-Simulation</a></li>
<li><a href="#_a_3_version_2_0_fmi_for_model_exchange_and_co_simulation">A.3 Version 2.0 – FMI for Model Exchange and Co-Simulation</a>
<ul class="sectlevel3">
<li><a href="#_a_3_1_overview">A.3.1 Overview</a></li>
<li><a href="#_a_3_2_main_changes">A.3.2 Main changes</a></li>
<li><a href="#_a_3_3_contributors">A.3.3 Contributors</a></li>
<li><a href="#_a_3_4_fmi_2_0_1_maintenane_release_changes_and_contributors">A.3.4 FMI 2.0.1 maintenane release: changes and contributors</a></li>
<li><a href="#_a_3_5fmi_2_0_2_maintenance_release_changes_and_contributors">A.3.5	FMI 2.0.2 maintenance release: changes and contributors</a></li>
<li><a href="#_a_3_6fmi_2_0_3_maintenance_release_changes_and_contributors">A.3.6	FMI 2.0.3 maintenance release: changes and contributors</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_glossary">Appendix B: Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本ドキュメントは、Functional Mock-up Interface（FMI）バージョン2.0.3を定義しています。これは、FMI 2.0 と比較して新機能を持たないメンテナンスリリースです。
FMIは、XMLファイルとCコード（DLL/共有ライブラリまたはソースコードにコンパイルされたもの）を組み合わせて、ダイナミックモデル（動的モデル）のモデル交換(model exchange)とコ・シミュレーション(coo-simulation)の両方をサポートする、ツールに依存しない標準規格です。
最初のバージョンであるFMI 1.0は2010年に発表されました。
FMIの開発は、ダイムラー社がサプライヤーとOEMの間でのシミュレーションモデルの交換を改善することを目的として開始しました。
現在も、多くの企業や研究機関の参加を得て、規格の開発が続けられています。
FMI 2.0は、100以上のツールでサポートされており、ヨーロッパ、アジア、北米の自動車メーカーおよび非自動車メーカーで使用されています。</p>
</div>
<div class="paragraph">
<p>ダウンロードページ（https://fmi-standard.org/downloads/）では、本仕様書のほか、サポートするC言語のヘッダーファイルやXMLスキーマファイル、FMI準拠チェックツールを提供しています。
また、ツールベンダーが他のツールとの互換性を確保するためのサンプルモデル（異なるツールからFMIフォーマットでエクスポートされたもの）や、接続されたFMU（Function Mock-up Units）がツールによって適切に処理されているかどうかをチェックするテストスイートも提供されています。</p>
</div>
<div class="paragraph">
<p>FMI開発グループ（<a href="mailto:contact@fmi-standard.org">contact@fmi-standard.org</a>）までお問い合わせください。</p>
</div>
<div class="paragraph">
<p><em>履歴 / ロードマップ</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Date</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-01-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデル交換のためのFMIの最初のバージョン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-10-12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">コ・シミュレーションのためのFMIの最初のバージョン</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014-07-25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデル交換とコ・シミュレーションのためのFMIの第2版</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-10-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデル交換とコ・シミュレーションのためのFMI 2.0のバグフィックス/メンテナンス リリース</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-12-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデル交換とコ・シミュレーションのためのFMI 2.0のバグフィックス/メンテナンス リリース</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-12-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">モデル交換とコ・シミュレーションのためのFMI 2.0のバグフィックス/メンテナンス リリース</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>本仕様に関して発見された問題は、FMIの公開課題追跡システム（https://trac.fmi-standard.org）に報告してください。</p>
</div>
<div class="paragraph">
<p><strong>このドキュメントのライセンス</strong></p>
</div>
<div class="paragraph second-indented">
<p>Copyright &#169;<br>
2008-2011 MODELISAR consortium and<br>
2012-2021 Modelica Association Project "FMI"</p>
</div>
<div class="paragraph">
<p>本ドキュメントは、いかなる保証もなく「現状のまま」提供されます。
この文書は、ウィキペディアで使用されているライセンスであるCC-BY-SA（Creative Commons Attribution-Sharealike 4.0 International）ライセンスのもとに提供されています。
<a href="http://creativecommons.org/licenses/by-sa/4.0/" class="bare">http://creativecommons.org/licenses/by-sa/4.0/</a> からのライセンステキストの人間が読める要約は以下の通りです。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">You are free to</p>
<p class="tableblock"><strong>Share</strong> — copy and redistribute the material in any medium or format</p>
<p class="tableblock"><strong>Remix</strong> — remix, transform, and build upon the material for any purpose, even commercially.</p>
<p class="tableblock">The licensor cannot revoke these freedoms as long as you follow the license terms.</p>
<p class="tableblock">Under the following terms:</p>
<p class="tableblock"><strong>Attribution</strong> — You must give appropriate credit, provide a link to the
license, and indicate if changes were made.
You may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.</p>
<p class="tableblock"><strong>Share Alike</strong> — If you remix, transform, or build upon the material, you must distribute your contributions under the same license as the original.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>法的なライセンステキストと免責事項は、以下のサイトでご覧いただけます。</p>
</div>
<div class="paragraph">
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/legalcode" class="bare">http://creativecommons.org/licenses/by-sa/4.0/legalcode</a></p>
</div>
<div class="paragraph">
<p>注:</p>
</div>
<div class="paragraph indented2">
<p>本ライセンスの第3a条では、本作品の改変は、変更が加えられたことを明確に表示、区分け、またはその他の方法で示す必要があります。</p>
</div>
<div class="paragraph indented2">
<p>この文書に添付されているC言語のヘッダーファイルとXML-schemaファイルは，BSD 2-Clauseライセンス（http://www.opensource.org/licenses/bsd-license.html）で提供されています。</p>
</div>
<div class="paragraph indented2">
<p>この文書の一部の要素が特許権の対象となる可能性があることに注意を喚起します。
Modelica Associationは、そのような特許権を特定する責任を負いません。</p>
</div>
<div class="paragraph indented2">
<p>改善提案がありましたら、FMI開発グループ（mailto:contact@fmi-standard.org）までお送りください。</p>
</div>
<div class="paragraph">
<p><strong>概要</strong></p>
</div>
<div class="paragraph">
<p>本ドキュメントでは、ダイナミック・システム・シミュレーション環境において、(a)ツール間でのダイナミック・モデルの交換、
(b)ツール間の結合を定義するためのFunctional Mock-up Interface (FMI), version 2.0.3を定義しています。</p>
</div>
<div class="paragraph">
<p><em>モデル交換のためのFMI（第3章）</em></p>
</div>
<div class="paragraph">
<p>これは、モデリング環境が、他のモデリングおよびシミュレーション環境で利用可能な、
動的システムモデルのCコード表現を生成できることを意図したものです。
モデルは、時間、状態、ステップイベントを伴う微分方程式、代数方程式、離散方程式によって記述されます。
Cコードに連続系が記述されている場合、この系は使用される環境の積分器で解かれます。
このインターフェースで扱われるモデルは、オフラインまたはオンライン・シミュレーションで使用するための大規模なものもあれば、
マイクロプロセッサ上の組み込み制御システムで使用するものもあります。</p>
</div>
<div class="paragraph">
<p><em>コ・シミュレーションのためのFMI（第４章）</em></p>
</div>
<div class="paragraph">
<p>その意図は、コ・シミュレーション環境におけるシミュレーション・ツールの結合のためのインターフェース規格を提供することにあります。
サブシステム間のデータ交換は、離散的な通信ポイントに制限されます。
2つの通信ポイントの間の時間では、サブシステムはそれぞれのソルバーによって互いに独立して解かれます。
マスター・アルゴリズムは、サブシステム間のデータ交換と、すべてのシミュレーション・ソルバー（スレーブ）の同期を制御します。
シンプルなマスター・アルゴリズムと、より高度なマスター・アルゴリズムの両方がサポートされています。
なお、マスター・アルゴリズム自体はFMI規格には含まれていません。</p>
</div>
<div class="paragraph">
<p><em>FMIの共通概念（第２章）</em></p>
</div>
<div class="paragraph">
<p>この2つのインターフェース規格には、共通する部分が多くあります。
特に、モデルやコ・シミュレーション・ツールの複数のインスタンスを利用し、それらを接続することが可能です。
また、ターゲット環境に依存するヘッダーファイルを使用していないため、ターゲット環境に依存しないインターフェースとなっています
（ターゲットプラットフォームのデータ型を除く）。
これにより、同一プラットフォーム上のどの環境でも利用可能な1つのダイナミックリンクライブラリを生成することができます。
モデル、コシミュレーション・スレーブ、ツールのカップリング部分は、FMU（Functional Mockup Unit）と呼ばれる
複数のファイルを含む1つのZIPファイルで配布されます。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>XMLファイルには、FMUで公開されているすべての変数の定義やその他の静的情報が含まれています。
この情報がなければ、ターゲットシステム上でFMUを実行することはできません。つまり、不必要なオーバーヘッドがないということです。</p>
</li>
<li>
<p>必要なモデル方程式やコ・シミュレーション・ツールへのアクセスは、使いやすいC言語の関数で提供されます。
新しいキャッシング技術により、他のアプローチよりも効率的にモデル方程式を評価することができます。
これらのC関数は、ソースまたはバイナリ形式で提供されます。
異なるプラットフォーム用のバイナリ形式は、同じFMU ZIPファイルに含めることができます。</p>
</li>
<li>
<p>モデル方程式やコ・シミュレーションツールは、FMU内で直接提供することもできる。
または、モデルの評価やシミュレーションを行う外部ツールと通信する汎用通信モジュールのみをFMUに搭載することも可能です。
モデルの評価またはシミュレーションを行う外部ツールと通信する汎用通信モジュールのみを含むことができます。
XMLファイルには、FMUの機能に関する情報が含まれています。例えば、コ・シミュレーション・スレーブが、可変の通信ステップ・サイズの使用など、
高度なマスター・アルゴリズムをサポートする能力を特徴づけるために使用されます。高次信号の外挿など、
高度なマスターアルゴリズムをサポートするコ・シミュレーションスレーブの能力を示す情報が含まれています。</p>
</li>
<li>
<p>FMU ZIPファイルには、特にモデルアイコン（ビットマップファイル）、ドキュメントファイル、FMUが必要とするマップやテーブル、
および/または利用されるすべてのオブジェクトライブラリやダイナミックリンクライブラリなど、さらなるデータを含めることができます。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>FMIをサポートするツールは増えています。
ツールの実際のリストは、https://www.fmi-standard.org/tools でご覧いただけます。</p>
</div>
<div class="paragraph">
<p><strong>FMI 2.0.3について</strong></p>
</div>
<div class="paragraph">
<p>FMI 2.0.3は、FMI 2.0または2.0.1と比較して新しい機能の変更がないメンテナンスリリースです。+
FMI 2.0.2 に基づいて作成された FMU は、FMI 2.0 または 2.0.1 に基づいて有効な FMU です。
FMI 2.0.3 では、主に FMI3.0 の開発から得られた知見を基に、若干の明確化を行っています。</p>
</div>
<div class="paragraph">
<p><strong>FMI 2.0.2について</strong></p>
</div>
<div class="paragraph">
<p>FMI 2.0.2は、FMI 2.0または2.0.1と比較して新しい機能の変更がないメンテナンスリリースです。+
FMI 2.0.2 に従って作成された FMU は、FMI 2.0 または 2.0.1 に従って有効な FMU です。
FMI 2.0.2では、階層化された規格に従ってFMUの追加情報を提供するための標準的な場所として、「/extra」ディレクトリが導入されています。+
これは、FMUの動作を変更するものではなく、階層化された規格で要求されるなどの追加ファイル（FMUの作成後も）の保存場所を明確にするものである。</p>
</div>
<div class="paragraph">
<p><strong>FMI 2.0.1について</strong></p>
</div>
<div class="paragraph">
<p>FMI 2.0.1 はメンテナンスリリースで、FMI 2.0 と比較して新機能はありません。
FMI 2.0.1 に基づいて作成された FMU は、FMI 2.0 に基づいて有効な FMU です。</p>
</div>
<div class="paragraph">
<p><strong>FMI 2.0について</strong></p>
</div>
<div class="paragraph">
<p>FMI 2.0は、FMI 1.0を大幅に改良したもので、FMI 1.0のモデル交換およびコ・シミュレーション規格を統合し、FMI 1.0規格を使用した際の実際の経験に基づいて、多くの改善点を取り入れています。
新機能は通常、オプションです（FMUをエクスポートするツールでも、FMUをインポートするツールでもサポートする必要はない）。
詳細は付録A.3.1に記載されている。</p>
</div>
<div class="paragraph">
<p><strong>この文書で使用されている規約</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>規範とならない文章は、イタリックフォントで角括弧内に記載されています：<em>[特に例はこのスタイルで定義されています。]</em></p>
</li>
<li>
<p>配列には2つの形態があります。</p>
<div class="ulist">
<ul>
<li>
<p>エンドユーザー／論理的な視点では、1次元および2次元の配列が使用されます。
ここでは、線形代数の慣習、制御コミュニティ、およびこの分野の最も重要なツールが利用されています。
言い換えれば、1つの次元に沿った最初の要素は、インデックス1から始まります。
これらのケースでは、開始インデックスは、配列のそれぞれの定義で明示的に言及されています。
例えば、modelDescription.xmlファイルでは、公開された変数のセットが順序付きセットとして
定義されており、最初の要素がインデックス1で参照されています（これらのインデックスは、
例えば偏微分行列のスパースネス構造を定義するために使用されます）。</p>
</li>
<li>
<p>実装ビューでは、1次元のC配列が使用されます。
配列の要素にアクセスするには，C言語の規約が用いられる。
例えば，以下のようになります．関数`setContinuousStates(&#8230;&#8203;)`の入力引数`x`の最初の
要素は`x[0]`である。</p>
</li>
<li>
<p><em>[FMI 2.0.2での明確化：構造化された命名規則では、0ベースと1ベースの両方の配列インデックスが認められています。]</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>FMI 2.0実装に関するヘルプ</strong></p>
</div>
<div class="paragraph">
<p>FMI 2.0フォーマットのモデルをエクスポートまたはインポートする予定の方は、以下のツール/モデルが開発に役立つかもしれません（https://fmi-standard.org/downloads から入手可能）。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">FMU Compliance Checker</dt>
<dd>
<p>FMIモデルがFMI規格に準拠しているかどうかをチェックするフリーソフトです。</p>
</dd>
<dt class="hdlist1">FMUs from other tools</dt>
<dd>
<p>他のベンダーのFMIモデルのインポートをツールでテストするために、テストFMUのセットが提供されています。</p>
</dd>
<dt class="hdlist1">Library to test connected FMUs</dt>
<dd>
<p>接続されたFMIモデルの難しいケースをテストするための無償のModelicaライブラリです。</p>
</dd>
<dt class="hdlist1">FMU Software Development Kit</dt>
<dd>
<p>FMIの基本的な使い方をデモンストレーションするためのQTronic社の無償ソフトウェア開発キットです。</p>
</dd>
<dt class="hdlist1">FMI Library</dt>
<dd>
<p>FMIモデルのアプリケーションへの統合を可能にするModelon社のフリーソフトウェアパッケージ。</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_概要">1. 概要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FMI(Functional Mock-up Interface)は、FMU(Functional Mock-up Unit)と呼ばれる実行形式で実装されるインターフェースを定義したものです。
FMIの機能は、シミュレーション環境がFMUの1つまたは複数のインスタンスを作成し、通常は他のモデルと一緒にシミュレーションを行う際に使用されます（コール）。
FMUは独自のソルバーを持つこともあれば（「コ・シミュレーションのためのFMI」第4章）、シミュレーション環境に数値積分を要求することもあります（「モデル交換のためのFMI」第3章）。
このインターフェースの目的は、シミュレーション環境におけるFMUの呼び出しが合理的に簡単であることです。
本ドキュメントでは、モデリング環境からFMUを生成する方法については規定していません。</p>
</div>
<div class="paragraph">
<p><span class="underline">FMI for Model Exchange</span> インターフェースは、 <span class="underline">微分方程式</span>、 <span class="underline">代数方程式</span>、[.underline]#離散時間方程式#で記述される動的システムのモデルに対するインターフェースを定義します。
このインターフェースは、さまざまな [underline]#シミュレーション環境#や [underline]#組み込み制御システム#において、明示的または暗黙的な積分器、固定または可変のステップサイズで、必要に応じてこれらの方程式を評価するためのインターフェースを提供します。
インターフェースは、大規模なモデルの記述を可能にするように設計されています。</p>
</div>
<div class="paragraph">
<p>[.underline]#FMI for Co-Simulation#は、シミュレーションツールの結合（シミュレータ結合、ツール結合）と、シミュレータがソルバーとともに[.underline]#実行可能なコード#としてエクスポートしたサブシステムモデルの結合の両方に対応するように設計されています。
その目的は、時間的に連続したサブシステム（微分代数方程式で記述されたモデルコンポーネント）、または時間的に離散したサブシステム（差分方程式で記述されたモデルコンポーネント、例えば離散コントローラ）からなる時間依存の連成システムの解を計算することです。
結合システムのブロック表現では、サブシステムは、（内部）状態変数 `x(t)`を持つブロックで表され、サブシステム入力`u(t)`とサブシステム出力 `y(t)`によって結合問題の他のサブシステム（ブロック）に接続されます。</p>
</div>
<div class="paragraph">
<p>ツールカップリングの場合、連成問題のモジュール構造は、シミュレーションプロセスのすべての段階で利用されます。まず、個々のサブシステムについて、異なるシミュレーションツールで個別にモデルを設定し、前処理を行います。
時間統合の際には、シミュレーションはすべてのサブシステムで独立して実行され、サブシステム間のデータ交換は離散的な_通信ポイント_に制限されます。
最後に、シミュレーションデータの視覚化と後処理は、各サブシステムごとに、それぞれのネイティブシミュレーションツールで行います。</p>
</div>
<div class="paragraph">
<p>この2つのインターフェースには共通する大きな部分があります。
これらの部分は第2章で定義されています。
特に、以下の点です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="underline">FMIアプリケーションプログラミングインターフェース（C）</span><br>
すべての必要な方程式やツールカップリング計算は、標準化された[underline]#C関数#を呼び出して評価されます。
C言語は、現在最もポータブルなプログラミング言語であり、すべての組み込み制御システムで使用できる唯一のプログラミング言語であるため、C言語を使用しています。</p>
</li>
<li>
<p><span class="underline">FMI記述スキーマ(XML)</span><br>
このスキーマは、モデリング環境によって生成されるXMLファイルの構造と内容を定義するものです。
このXMLファイルには、FMUのすべての変数の定義が標準化された方法で含まれています。
これにより、変数定義のオーバーヘッドなしに、組み込みシステムでCコードを実行することができます（この情報をCコードに格納し、関数呼び出しでアクセスするという方法もありますが、組み込みシステムや大規模なモデルでは実用的ではありません）。
さらに、変数定義は複雑なデータ構造であり、このデータ構造をどのようにプログラムで表現するかは、ツールが自由に決定できるべきです。
ここでは、C++、C#、Java、Python などのシミュレーション環境のプログラミング言語で、ツールが変数定義を（標準化されたアクセス関数によるメモリや効率のオーバーヘッドなしに）保存し、アクセスできるようにするアプローチを採用しています。
なお、XMLファイルを適切なデータ構造に読み込むためのフリーおよび商用のライブラリが、さまざまなプログラミング言語で多数提供されています。
例えば、http://en.wikipedia.org/wiki/XML#Parsers、特に効率的なオープンソースのパーサーであるSAXを参照してください（http://sax.sourceforge.net/, <a href="http://en.wikipedia.org/wiki/Simple_API_for_XML）。" class="bare">http://en.wikipedia.org/wiki/Simple_API_for_XML）。</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FMU (言い換えれば、インテグレータなしのモデル、インテグレータ付きの実行可能なモデル、またはツール・カップリング・インターフェース)は、1つのZIPファイルで配布されます。
ZIPファイルの内容は以下の通りです（詳細は2.3項に記載）。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI記述ファイル（XML形式）</p>
</li>
<li>
<p>FMUのCソース（モデルで使用される必要なランタイムライブラリを含む）、およびWindowsのダイナミックリンクライブラリ（.dll）やLinuxのシェアードオブジェクトライブラリ（.so）など、1つまたは複数のターゲットマシン用のバイナリーです。
後者のソリューションは、FMUプロバイダが、含まれるノウハウを保護するためにソースコードを隠したい場合や、別のシミュレーション環境にFMUを完全に自動的にインポートできるようにしたい場合に特に使用されます。
FMUには物理的なパラメータや幾何学的な寸法が含まれている場合がありますが、これらはオープンにすべきではありません。一方で、一部の機能はソースコードを必要とします。</p>
</li>
<li>
<p>FMU固有のファイル形式による追加のFMUデータ（表や地図など）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FMUの概略図を図1に示します。</p>
</div>
<div class="paragraph">
<div class="title">環境とFMUの間のデータの流れ。</div>
<p>詳しくは第3章、第4章をご覧ください。
[blue]#青い#矢印：FMUが提供する情報です。
[red]#赤い#矢印：FMUに提供される情報です。</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/enclosing_model.svg" alt="enclosing model" width="60%">
</div>
</div>
<div class="paragraph">
<p>FMIに関する出版物は、https://fmi-standard.org/literature/, 特にBlochwitz他によるものはhttp://www.ep.liu.se/ecp/063/013/ecp11063013.pdf[2011]やhttp://www.ep.liu.se/ecp/076/017/ecp12076017.pdf[2012]から入手できます。</p>
</div>
<div class="sect2">
<h3 id="_特性と指針となる考え方">1.1. 特性と指針となる考え方</h3>
<div class="paragraph">
<p>このセクションでは、プロパティをリストアップし、FMIの低レベル設計の指針となるいくつかの原則を定義しています。
これにより、インターフェース機能の自己整合性を高めることができます。
リストアップされた問題は、高レベルのプロパティから低レベルの実装問題へとソートされています。</p>
</div>
<div class="paragraph indented">
<p><em>表現性</em>:
FMIは、Modelica&#174;、Simulink&#174;、SIMPACK&#174; <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>のモデルがFMUに変換するために必要な機能を提供します。</p>
</div>
<div class="paragraph indented">
<p><em>安定性</em>: FMIは、世界中の多くのシミュレーションツールでサポートされることが期待されています。
このようなサポートを実装することは ツールベンダーにとって大きな投資となります。
そのため、FMIの安定性と後方互換性 の安定性と後方互換性は高い優先度を持っています。
これをサポートするために、FMIでは「ケイパビリティフラグ(capability flags)」を定義しています。
FMIの将来のバージョンで使用される「ケイパビリティフラグ(capability flags)」を定義しています。
このフラグは、将来のバージョンのFMIで使用されます。</p>
</div>
<div class="paragraph indented">
<p><em>実装</em>:
FMUは、手動で記述することも、モデリング環境から自動的に生成することもできます。
既存の手動でコード化されたモデルを、FMI規格に準拠したモデルに手動で変換することができます。</p>
</div>
<div class="paragraph indented">
<p><em>プロセッサの独立性</em>:
ターゲットとなるプロセッサを知らなくても、FMUを配布することができます。
これにより、FMUをPC上で動作させることができます。Hardware-in-the-Loopシミュレーションプラットフォームや、ECUのコントローラソフトウェアの一部として動作させることができます。
例えば、AUTOSAR SWCの一部として動作させることができます。
FMUをターゲットプロセッサから独立させることで、FMUの使い勝手が向上し、AUTOSARのソフトウェアコンポーネントモデルでも要求されています。
実装:テキスト形式のFMUを使用します（FMUのC言語ソースを配布）。</p>
</div>
<div class="paragraph indented">
<p><em>シミュレータの独立性</em>:
ターゲットとなるシミュレータを知らなくても、FMUをコンパイル、リンク、配布することができます。
理由：コンパイル時にFMUの使用を不必要に制限したり、ユーザーがFMUのシミュレータ固有のバリエーションを維持することを強要するなど、そうでなければこの規格の魅力は大きく損なわれます。
実装：バイナリFMUの使用。
Windowsのダイナミックリンクライブラリ（.dll）やLinuxのシェアードオブジェクトライブラリ（.so）などのバイナリFMUを生成する際には、ターゲットとなるオペレーティングシステム、そして最終的にはターゲットとなるプロセッサを知る必要があります。
しかし、バイナリFMUの生成には、ターゲット・シミュレータのランタイム・ライブラリ、ソース・ファイル、ヘッダ・ファイルは必要ありません。
その結果、バイナリFMUは、ターゲット・プラットフォーム上で動作するどのようなシミュレータでも実行することができます（ただし、モデルや使用するランタイム・ライブラリから必要なライセンスが提供されている場合に限ります）。</p>
</div>
<div class="paragraph indented">
<p><em>小さいランタイムオーバーヘッド</em>:
FMUとターゲット・シミュレータの間でFMIを介して通信を行う場合、ランタイム・オーバーヘッドが大きくなることはありません。
これは、新しいキャッシング技術（同じ変数を何度も計算することを避けるため）と、スカラー量の代わりにベクトルを交換することによって実現されています。</p>
</div>
<div class="paragraph indented">
<p><em>小さいフットプリント</em>:
コンパイルされたFMU（実行ファイル）は小さい。
理由：FMUは、ECU（Electronic Control Unit、マイクロプロセッサなど）上で動作する場合があり、ECUには強いメモリ制限があります。
そのため、信号の属性（名称、単位など）やモデル評価に必要のない静的な情報は、実行ファイルが動作する可能性のあるマイクロプロセッサ上では不要な別のテキストファイル（＝モデル記述ファイル）に格納することで実現しています。</p>
</div>
<div class="paragraph indented">
<p><em>データ構造の隠蔽</em>:
モデル交換のためのFMIでは、モデルを表現するためのデータ構造（C構造体）を規定していません。
理由：FMI規格は、異なるツールベンダーによる実装を容易にするために、FMUまたはシミュレータ（モデルデータを含むもの）の特定の実装を不必要に制限または規定していません。</p>
</div>
<div class="paragraph indented">
<p><em>多数のFMUとネストしたFMUをサポート</em>:
シミュレータでは、1回のシミュレーションで多くのFMUを実行したり、1つのFMUの複数のインスタンスを実行したりすることができます。
これらのFMUの入力と出力は、直接フィードスルーで接続することができます。
さらに、1つのFMUがネストしたFMUを含む場合もあります。</p>
</div>
<div class="paragraph indented">
<p><em>数値的なロバスト性</em>:
FMI規格では、数値的に重要な問題（時間や状態のイベント、複数のサンプルレート、硬い問題など）をロバストな方法で扱うことができます。</p>
</div>
<div class="paragraph indented">
<p><em>キャッシュの隠蔽</em>:
一般的なFMUでは、計算結果を後で再利用するためにキャッシュします。
使い方を簡単にするために、また、シミュレータによるエラーの可能性を減らすために、キャッシュメカニズムはFMUの使用からは隠されています。
理由は以下の通りです。
第一に、FMIはFMUに特定のキャッシングポリシーの実装を強制してはならないためです。
第二に、これはFMIをシンプルに保つのに役立ちます。
実装：FMI は、キャッシュデータを無効にするプロパティを設定するための明示的なメソッド（FMU 環境によって呼び出されます）を提供します。
キャッシュを実装することを選択したFMUは、シミュレータから隠された「ダーティ」フラグのセットを維持することができます。
状態を取得するメソッドなどは、これらのフラグの値に応じて、計算を起動するか、キャッシュされたデータを返すことになります。</p>
</div>
<div class="paragraph indented">
<p><em>数値ソルバーのサポート</em>:
一般的なターゲットシミュレーターでは、数値ソルバーを使用します。
これらのソルバーは、状態、導関数、ゼロクロス関数のためのベクトルを必要とします。
FMUは、ソルバーから提供されたそのようなベクトルの値を直接埋めます。理由：実行時間の短縮のためです。
これらのベクトルの公開は、”データ構造の隠蔽"という要件に多少抵触しますが、効率化により正当化されます。</p>
</div>
<div class="paragraph indented">
<p><em>明示的なシグネチャ</em>:
意図した操作、引数の型、戻り値はシグネチャで明示されます。
例えば，演算子（`compute_derivatives`など）をint型の引数として渡すのではなく、そのための特別な関数が呼ばれます．
また，`char*`ではなく`const char*`など，変更してはいけないポインタには`const`という接頭辞が使われます．
理由: FMIの正しい使用方法をコンパイル時にチェックすることができ（Cよりも`const`に厳しい）、C++環境でCコードを呼び出すことができます。
これにより、意図した方法でFMIを使用するFMUの開発が可能になります。</p>
</div>
<div class="paragraph indented">
<p><em>少ない機能</em>:
FMIは、いくつかの「直交する」機能で構成されており、他の機能で定義できるような冗長な機能を避けています。
理由は：これにより、コンパクトで使いやすく、魅力的なAPIとコンパクトなドキュメントを実現しています。</p>
</div>
<div class="paragraph indented">
<p><em>エラーハンドリング</em>:
すべてのFMIメソッドは、エラーを伝えるために共通のメソッドを使用しています。</p>
</div>
<div class="paragraph indented">
<p><em>アロケータはフリー</em>:
FMUによって割り当てられたメモリ（およびその他のリソース）は、FMUによって解放（リリース）されます。
同様に、シミュレータによって割り当てられたリソースは、シミュレータによって解放されます。
理由：異なるコンポーネントの実行環境に互換性がないことによるメモリリークやランタイムエラーを防ぐことができます。</p>
</div>
<div class="paragraph indented">
<p><em>イミュータブルな文字列</em>:
引数として渡された文字列や返された文字列はすべて読み取り専用であり、受信者が変更することはできません。
理由： 文字列の再利用を容易にするためです。</p>
</div>
<div class="paragraph indented">
<p><em>名前付きリスト要素</em>:
<code>fmiModelDescription.xsd`というXMLスキーマファイルで定義されているすべてのリストは、リスト要素にString属性の`name`を持ちます。
この属性は、同じリストの他のすべての `name</code> 属性に対して一意でなければなりません。</p>
</div>
<div class="paragraph indented">
<p><em>Cの使用</em>:
FMIはC++ではなくCでエンコードされています。
理由:コンパイラやリンカに依存する動作の問題を避けるためです。
組み込みターゲットでFMUを実行します。</p>
</div>
<div class="paragraph">
<p>本バージョンの機能的モックアップ・インターフェースは、以下の望ましい特性を持って[underline]<mark>いません</mark>。
これらは将来のバージョンで追加されるかもしれません。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI for Model Exchangeは、状態空間形式の常微分方程式（ODE）を対象としています。
一般的な微分代数方程式系のためのものではありません。
しかし、FMU内部の代数方程式系はサポートされています（例えば、FMUは、代数方程式系の解が見つからなかったので、より小さなステップサイズで現在のステップを再実行するように環境に報告することができます）。</p>
</li>
<li>
<p>SIMPACKのようなマルチボディシステムプログラムに役立つ特別な機能は含まれていません。</p>
</li>
<li>
<p>このインターフェースは、シミュレーションと組み込みシステムのためのものです。
軌道最適化のために追加で必要となる可能性のあるプロパティ、例えば、連続的な統合中のパラメータに関するモデルの微分などは含まれていません。</p>
</li>
<li>
<p>XMLファイルでは、変数の階層を明示的に定義していません。</p>
</li>
<li>
<p>FMUでは、ステート数とイベントインジケータの数は固定されており、変更することはできません。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_謝辞">1.2. 謝辞</h3>
<div class="paragraph">
<p>2011 年 12 月まで，本研究は ITEA2 MODELISAR プロジェクト（プロジェクト番号：ITEA2-07006, <a href="https://itea3.org/project/modelisar.html）の中で行われました。" class="bare">https://itea3.org/project/modelisar.html）の中で行われました。</a></p>
</div>
<div class="paragraph">
<p>Daimler AG，DLR，ITI GmbH，Martin Luther University Halle-Wittenberg，QTronic GmbH，SIMPACK AG は，MODELISAR 内での本研究の部分的な資金提供に対して BMBF に感謝します（BMBF Förderkennzeichen: 01lS0800x）。</p>
</div>
<div class="paragraph">
<p>Dassault Systèmes（スウェーデン）は，MODELISARにおける本研究の一部に資金を提供してくれたスウェーデンの助成機関VINNOVA（2008-02291）に感謝します．</p>
</div>
<div class="paragraph">
<p>LMS ImagineおよびIFPENは，DGCISがMODELISAR内の本研究に一部資金を提供してくれたことに感謝します。
2012年9月から2015年11月まで、本研究の一部はITEA2 MODRIOプロジェクト（プロジェクト番号：ITEA 2-11004, <a href="https://itea3.org/project/modrio.html）の中で行われています。" class="bare">https://itea3.org/project/modrio.html）の中で行われています。</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>DLR，ITI GmbH，QTronic GmbH，SIMPACK AG は，BMBF から MODRIO 内の本研究の一部の資金提供を受けたことに感謝します（BMBF Förderkennzeichen: 01IS12022E）。</p>
</li>
<li>
<p>Dassault Systèmes（スウェーデン），Linköping University，Modelon ABは，MODRIOにおける本研究の一部を助成してくれたスウェーデンの助成機関VINNOVA（2012&#8212;&#8203;01157）に感謝します。</p>
</li>
<li>
<p>シーメンスPLMソフトウェア（フランス）とIFPENは，DGCISによるMODRIO内の作業に対する部分的な資金提供に感謝します。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_モデル交換とコシミュレーションに関するfmiの共通概念">2. モデル交換とコ・シミュレーションに関するFMIの共通概念</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本章では、「モデル交換」と「コ・シミュレーション」に共通する概念を定義しています。
どちらの場合も、FMIはダイナミックモデルの入出力ブロックを定義しており、ブロックの配布、プラットフォーム依存のヘッダーファイル、いくつかのアクセス関数、およびスキーマファイルは同一です。
特定のケースに特有の定義は、第3章と第4章で定義されています。</p>
</div>
<div class="paragraph">
<p>以下では、<em>FMU</em>（Functional Mock-up Unit）という用語を、「FMI for model exchange」形式のモデル、または「FMI for co-simulation」形式のコ・シミュレーション・[underline]#スレーブ#の共通用語として使用します。
なお、このインターフェースは[underline]#1つのFMU#の[underline]#複数のインスタンス#をサポートしています。</p>
</div>
<div class="sect2">
<h3 id="_fmiアプリケーションプログラミングインターフェース">2.1. FMIアプリケーション・プログラミング・インターフェース</h3>
<div class="paragraph">
<p>このセクションでは、CプログラムからFMUの機能を実行するための共通インターフェース定義を記載しています。</p>
</div>
<div class="paragraph">
<p>なお、FMUには以下のような一般的な性質があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1つのインスタンスのFMI関数は、スレッドセーフである必要はありません。<br>
<em>[例えば、FMUの1つのインスタンスの機能が複数のスレッドからアクセスされる場合。FMUを使用するマルチスレッド環境では、3.2.3項および4.2.4項で定義された関数の呼び出しシーケンスが使用されることを保証する必要があります。
FMU自身は、これをサポートするサービスを実装していません。]</em></p>
</li>
<li>
<p>FMI 関数は、他のプロセス/スレッドに影響するグローバル設定を変更してはいけません。
FMI 関数は、呼び出されたプロセス／スレッドの設定（浮動小数点制御レジスタなど）を変更することができます。ただし、これらの変更は、関数を終了する前、またはコールバック関数が呼び出される前に復元されます。<br>
<em>[この特性により、異なるFMUインスタンスの関数を任意の順序で安全に呼び出すことができます。
さらに、関数が異なるプロセス/スレッドで呼び出されていれば、並行して呼び出すことができます。
FMI関数がCPUの浮動小数点制御ワードなどを変更した場合、関数が戻る前に以前の値に戻す必要があります。
x86 CPUの場合、浮動小数点制御ワードはfldcw命令で設定されます。
これは、「浮動小数点のゼロ除算」などの追加例外のスイッチを入れるために使用できます。
FMUは一時的に浮動小数点制御ワードを変更し、内部的に浮動小数点例外の通知を受けることができますが、それぞれのFMI関数が戻る前にフラグを復元し、浮動小数点ステータス・ワードをクリアする必要があります。]</em></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ヘッダーファイルと関数名の命名">2.1.1. ヘッダーファイルと関数名の命名</h4>
<div class="paragraph">
<p>FMUのインターフェースを定義する3つのヘッダーファイルが用意されています。
すべてのヘッダーファイルでは、C言語の関数や型の定義はすべて「<span class="underline">fumi2</span>」という接頭辞で始まるという規則が使われています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fmi2TypesPlatform.h</code><br>
には、関数の入力引数と出力引数の型定義が含まれています。
このヘッダファイルは，FMUとターゲットとなるシミュレータの両方で使用する必要があります。
ターゲットとなるシミュレータでヘッダファイルの定義が異なる場合（例えば、<code><strong>typedef double</strong> fmi2Real`の代わりに</code><strong>typedef float</strong> fmi2Real`）、[underline]#ターゲットとなるシミュレータ#で使用されているヘッダファイルを用いて[underline]#FMU#を[underline]#再コンパイル#する必要があります。
モデルがコンパイルされたヘッダファイルのプラットフォームは、ターゲットのシミュレータで次のように照会できます。
fmi2GetTypesPlatform` (セクション 2.1.4 参照)。<br>
<em>[このヘッダーファイルでの定義の例:<br>
 <code><strong>typedef double</strong> fmi2Real;</code><br>
 ]</em></p>
</li>
<li>
<p><code>fmi2FunctionTypes.h</code><br>
には、FMUのすべての関数プロトタイプの <code><strong>typedef</strong></code> 定義が含まれています。
FMUを動的にロードする際には、これらの定義を使って、関数ポインタをそれぞれの関数定義にタイプキャストすることができます。
<em>[このヘッダーファイルでの定義の例:<br>
 <code><strong>typedef</strong> fmi2Status fmi2SetTimeTYPE(fmi2Component, fmi2Real);</code><br>
 ]</em></p>
</li>
<li>
<p><code>fmi2Functions.h</code><br>
には，シミュレーション環境でアクセス可能なFMUの関数プロトタイプが含まれており，2章，3章，4章で定義されています。
このヘッダファイルには，<code>fmi2TypesPlatform.h`と`fmi2Function.h`が含まれています。
モデルがコンパイルされたときのヘッダーファイルのバージョン番号です。ターゲットのシミュレータでは、`fmi2GetVersion</code> (セクション2.1.4参照)で確認できます。
<em>[このヘッダーファイルでの定義の例</em> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>:<br>
<em>`FMI2_Export fmi2SetTimeTYPE fmi2SetTime;`<br>
]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>目標は、FMUのテキスト表現とバイナリ表現の両方をサポートし、1つの実行ファイルに複数のFMUが同時に存在する可能性があることです（例えば、FMU AがFMU Bを使用する場合など）。
これを可能にするためには、異なるFMUの関数名が異なるか、関数ポインタを使用する必要があります。
最初のバリエーションをサポートするために、FMUの出荷方法に依存する関数プレフィックスを使用して実際の関数名を構築するマクロが <code>fmi2Functions.h</code> で提供されています。
<em>[これらのマクロは、サポートされているコンパイラやインポートツールのプラットフォームの要件に合わせて、`fmi2Functions.h`のターゲット固有のバージョンで異なる定義をすることができます。]</em></p>
</div>
<div class="paragraph">
<p>FMUのCファイルは、先頭に&lt;fmiModelDescription&gt;&lt;ModelExchange&gt;`または&lt;fmiModelDescription&gt;&lt;CoSimulation&gt;`で定義された`modelIdentifier`属性としての`FMI2_FUNCTION_PREFIX`の`define`を、末尾に`_`を含めなければなりません（3.3.1項および4.3.1項参照）。</p>
</div>
<div class="paragraph">
<p>この`define`には、`#include "fumi2Functions.h"`を直接記述する必要があります。</p>
</div>
<div class="paragraph">
<p>通常、FMUの機能は以下のように使用されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">// FMU is shipped with C source code, or with static link library
#define FMI2_FUNCTION_PREFIX MyModel_
#include "fmi2Functions.h"
&lt; usage of the FMU functions &gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">// FMU is shipped with DLL/SharedObject
#include "fmi2Functions.h"
&lt; usage of the FMU functions &gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>fmi2GetReal`と定義されている関数は、マクロによって以下のように関数名に変更されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMUにC言語のソースコードやスタティックリンクライブラリが付属している場合は:<br>
構築された関数名は <code>MyModel_fmi2GetReal</code> です。
つまり，関数名の前にはモデルの識別子と`_`が付けられています．
したがって，シミュレーション環境では，実際の関数呼び出しのためのコードを生成することで，関連する関数名を構築することができます．
スタティックリンクライブラリの場合、ライブラリ名はWindowsではMyModel.lib、LinuxではlibMyModel.aとなり、`modelIdentifier`属性がライブラリ名として使用されます。</p>
</li>
<li>
<p>FMUにDLL/SharedObjectが同梱されている場合:<br>
構築された関数名は <code>fmi2GetReal</code> であり、変更されていません。
<em>[これは、ソースコードのFMUが、関数名の構築にFMI2_FUNCTION_PREFIXを使用しないターゲット固有のバージョンの`fmi2Functions.h`を持つ場合に実現できます。]</em>
シミュレーション環境は、このライブラリを動的にロードし、FMI関数名を文字列として提供することで、関数シンボルを明示的にインポートします。
ライブラリの名前は、Windowsでは`MyModel.dll`、Linuxでは`MyModel.so`となり、つまり、`modelIdentifier`属性がライブラリ名として使われます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[FMUは、基本的に他のツールとの通信のみを含むように、オプションで出荷することができます（needsExecutionTool = true、4.3.1項参照）。
これは、特に共同シミュレーションタスクでよく見られます。
FMI 1.0では、関数名の前に常にモデル名が付いているため、モデルごとにDLL/共有オブジェクトを生成する必要があります。
FMI 2.0では、DLL/共有オブジェクトの場合、モデル名がプレフィックスとして使用されなくなったため、この状況が改善されました。
したがって、ツールカップリングの場合、1つのDLL/共有オブジェクトをすべてのモデルに使用することができます。
FMUがシミュレーション環境にインポートされる場合、これは通常、動的に実行され（FMU名に基づいて、シミュレーション環境の実行中に対応するFMUがロードされます）、モデル名がプレフィックスであるかどうかは問題ではありません。
]</em></p>
</div>
<div class="paragraph">
<p>`modelIdentifier`は、C関数名のプレフィックスとして使用されるので、C関数名の制限を満たさなければなりません（文字、数字、アンダースコアのみが使用可能）。
<em>[例えば、`modelName = "A.B.C"`であれば、`modelIdentifier`は "A_B_C "となります。]</em>
modelIdentifier`は、ファイルシステムの名前としても使われます。ファイルシステムの名前としても使われるので、対象となるOSの制限を満たす必要があります。
基本的に、これは短くなければならないことを意味します。
例えば、WindowsのAPIでは、ファイルのフルパス名を260文字までしかサポートしていません。文字までしかサポートしていません（参照：http://msdn.microsoft.com/en-us/library/aa365247%28VS.85%29.aspx）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_プラットフォームに依存する定義_fmi2typesplatform_h">2.1.2. プラットフォームに依存する定義 (fmi2TypesPlatform.h)</h4>
<div class="paragraph">
<p>移植を容易にするため、関数のインターフェースにはC言語の型は使用していません。
しかし，このセクションではエイリアス型が定義されています。
このセクションのすべての定義は，ヘッダファイル <code>fmi2TypesPlatform.h</code> で提供されています。</p>
</div>
<div class="paragraph">
<p><code>#define fmi2TypesPlatform "default"</code></p>
</div>
<div class="paragraph">
<p>fmi2GetTypesPlatform`で問い合わせることができる定義です。
バイナリのコンパイルに使用するヘッダファイルを一意に識別するために使用されます。
<em>[以下の「デフォルト」定義は、ほとんどの一般的なプラットフォームに適しています。
すべてのバイナリFMUにこの「デフォルト」定義を使用することをお勧めします。
ソースコードFMUに限っては、場合によっては変更が有効なことがあります。]</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>fmi2Component           : 不透明なオブジェクトポインタ
fmi2ComponentEnvironment: 不透明なオブジェクトポインタ
fmi2FMUstate            : 不透明なオブジェクトポインタ
fmi2ValueReference      : 値のハンドル型
fmi2Real                : リアルデータ型
fmi2Integer             : 整数データ型
fmi2Boolean             : fmi2Trueおよびfmi2Falseで使用されるデータ型
fmi2Char                : 文字データ型（1文字の大きさ）
fmi2String              : fmi2Char文字のベクトルへのポインタ
                          (UTF-8エンコードのヌル終端文字列'\0')
fmi2Byte                : マシンの最小アドレス単位
                          (通常1バイト)</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void* fmi2Component;</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、モデルの方程式を処理したり、それぞれのスレーブのコ・シミュレーションを処理するために必要な情報を含むFMU固有のデータ構造へのポインタです。
このデータ構造は、FMUを提供する環境によって実装されます。
言い換えれば、呼び出した環境はその内容を知らず、それを処理するコードはFMU生成環境が提供し、FMUと共に出荷されなければならないということです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void* fmi2ComponentEnvironment;</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは，FMUを呼び出すシミュレーション環境のデータ構造へのポインタです．
このポインタを使って，<code>modelDescription.xml`ファイルのデータ_[例えば、`valueReference</code>sの変数名へのマッピング。]_をシミュレーション環境と`logger`関数（2.1.5項参照）の間で転送することができます．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef void* fmi2FMUstate;</code></pre>
</div>
</div>
<div class="paragraph">
<p>FMUの内部状態を保存するデータ構造へのポインタで、実際の時間または前の時間の瞬間のFMUの内部状態を保存します。
これにより、前回のFMUの状態からシミュレーションを再開することができます（2.1.8項参照）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef unsigned int fmi2ValueReference;</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは、モデルの(ベースタイプ)変数値へのハンドルです。
ハンドルとベースタイプ（`fmi2Real`など）は、変数の値を一意に識別します。
同じハンドルを持つ同じベースタイプの変数は、常に同一の値を持ちます。しかし、変数の定義の他の部分は異なる場合があります。 <em>[例えば、min/max属性]</em>.</p>
</div>
<div class="paragraph">
<p>レコードや配列などの構造化されたエンティティはすべて，<code>fmi2Real`や`fmi2Integer`などのスカラ値の集合に "フラット化 "されます．
fmi2ValueReference`はそのようなスカラの一つを参照します。
fmi2ValueReference`のコーディングは，FMUを生成した環境の "秘密 "です．
方程式のインターフェイスでは，このハンドルを介して変数にアクセスすることしかできません．
変数の具体的な情報を抽出するには、値のハンドルが定義されているモデル記述ファイルを読み込んだ使用環境に特有のものとなります。
以下のセクションの関数が間違った`fmi2ValueReference`の値で呼び出された場合は
<em>[例えば、`fmi2SetReal(&#8230;&#8203;)`関数の呼び出しで定数を設定する場合などです]</em>,
その場合、この関数はエラー（`fmi2Status = fmi2Error</code>、セクション2.1.3参照）で返さなければなりません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef double fmi2Real ; // Data type for floating point real numbers
typedef int fmi2Integer;  // Data type for signed integer numbers
typedef int fmi2Boolean;  // Data type for Boolean numbers
                          // (only two values: fmi2False, fmi2True)
typedef char fmi2Char;    // Data type for one character
typedef const fmi2Char* fmi2String; // Data type for character strings
                                    // ('\0' terminated, UTF8 encoded)
typedef char fmi2Byte;    // Data type for the smallest addressable
                          // unit, typically one byte
#define fmi2True 1
#define fmi2False 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>これらは、C関数のインターフェースで使用される基本的なデータ型です。
将来のバージョンのインターフェースでは、さらに多くのデータ型が追加される可能性があります。柔軟性を保つために，特に組み込みシステムや高性能コンピュータのために，正確なデータ型や数値のワード長は標準化されていません．
代わりに、正確な定義（言い換えれば、ヘッダファイル <code>fmi2TypesPlatform.h</code>）は、FMUが使用される環境によって提供されます。ほとんどの場合、上記の定義が使われます。
ターゲット環境の定義が異なり、FMUがバイナリ形式で配布されている場合は、このターゲットヘッダーファイルを用いて新たにコンパイルおよびリンクする必要があります。</p>
</div>
<div class="paragraph">
<p>fmi2String`変数がFMI関数の[underline]#input#引数として渡され、FMUがその文字列を後で使用する必要がある場合、FMI関数は関数が戻る前にその文字列をコピーし、FMUの内部メモリに保存しなければなりません。</p>
</div>
<div class="paragraph">
<p>FMI関数の[underline]#output#引数として`fmi2String`変数が渡され、その文字列がターゲット環境で使用される場合、ターゲット環境は（ポインタだけでなく）文字列全体をコピーする必要があります。
この文字列のメモリは、いずれかのFMIインターフェース関数の次の呼び出しによって解放される可能性があります。(文字列のメモリは、再利用される単なるバッファの場合もあります)。</p>
</div>
</div>
<div class="sect3">
<h4 id="_関数が返すステータス">2.1.3. 関数が返すステータス</h4>
<div class="paragraph">
<p>このセクションでは、すべての関数が返す <code>status</code> フラグ (ファイル <code>fmi2FunctionTypes.h</code> で定義されている <code>fmi2Status</code> 型の列挙型) を定義します。ファイル`fmi2FunctionTypes.h`で定義されている`fmi2Status`型の列挙）を定義します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum { fmi2OK,
               fmi2Warning,
               fmi2Discard,
               fmi2Error,
               fmi2Fatal,
               fmi2Pending } fmi2Status;</code></pre>
</div>
</div>
<div class="paragraph">
<p>関数が返すステータス。
ステータスの意味は以下の通りです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fmi2OK</code> - すべて順調</p>
</li>
<li>
<p><code>fmi2Warning</code> - 完全に正しくありませんが、計算は続行できます。
モデルの中では，関数`logger`が呼び出されており（下記参照），この関数が用意した情報メッセージをユーザに表示したことが予想されます。</p>
</li>
<li>
<p><code>fmi2Discard</code> - この戻り値は、対応する関数で明示的に定義されている場合のみ可能です <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>:
(ModelExchange: <code>fmi2SetReal</code>, <code>fmi2SetInteger</code>, <code>fmi2SetBoolean</code>, <code>fmi2SetString</code>,
<code>fmi2SetContinuousStates</code>, <code>fmi2GetReal</code>, <code>fmi2GetDerivatives</code>,
<code>fmi2GetContinuousStates</code>, <code>fmi2GetEventIndicators</code>;
CoSimulation: <code>fmi2SetReal</code>, <code>fmi2SetInteger</code>, <code>fmi2SetBoolean</code>, <code>fmi2SetString</code>, <code>fmi2DoStep</code>,
<code>fmiGetXXXStatus</code> ):<br>
「モデル交換」の場合：モデルの反復ソルバーが収束しなかった場合や、モデルの方程式を再度評価する場合など、ステップサイズを小さくして実行することが推奨されます。モデルの反復ソルバーが収束しなかった場合や、関数が領域外にある場合（例：<code>sqrt(&lt;負の数&gt;)</code>）などには 例えば、モデル内の反復ソルバーが収束しなかった場合や、関数がその領域外にある場合（例：<code>sqrt(&lt;負の数&gt;)</code>）などです。
これができない場合は、シミュレーションを終了しなければなりません。<br>
「co-simulation」の場合：スレーブが必要なステータス情報を返せなかった場合も、<code>fmi2Discard`を返します。ステータス情報を返すことができない場合にも返されます。
マスターは、シミュレーションの実行を継続できるかどうかを判断する必要があります。<br>
いずれの場合も、FMUでは関数`logger`が呼び出されており（下記参照）、FMUがデバッグモード（`loggingOn = fmi2True</code>）で呼び出された場合には、この関数が用意された情報メッセージをユーザーに表示していることが予想されます。
それ以外の場合は、`logger`はメッセージを表示してはいけません。</p>
</li>
<li>
<p><code>fmi2Error</code> - FMUにエラーが発生しました。
このFMUインスタンスでは、シミュレーションを続行できません。
いずれかの関数が <code>fmi2Error</code> を返した場合は、<code>fmi2SetFMUstate</code> を呼び出して、以前に保存した FMU の状態からシミュレーションを再開することができます。
これは、ケイパビリティフラグの <code>canGetAndSetFMUstate</code> が真であり、<code>fmi2GetFMUstate</code> が以前にエラーにならない状態で呼び出されていた場合に実行できます。
<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup>。+
特に他のFMUインスタンスは影響を受けません。
FMUでは、関数`logger`が呼び出されており（下記参照）、この関数が用意された情報メッセージをユーザーに表示していることが予想されます。</p>
</li>
<li>
<p><code>fmi2Fatal</code> - すべての FMU インスタンスでモデル計算が修復不可能なほど破損します。
_[例えば、fmi関数の実行中に、アクセス違反や整数のゼロ除算などのランタイム例外が発生したため]_です。
FMUで関数`logger`が呼び出され（下記参照）、この関数が用意した情報メッセージをユーザーに表示したことが予想されます。
FMUのどのインスタンスに対しても、他の関数を呼び出すことはできません。</p>
</li>
<li>
<p><code>fmi2Pending</code> - このステータスは、スレーブが非同期で関数を実行した場合に、コ・シミュレーションのインターフェースからのみ返されます。
つまり，スレーブが計算を開始してもすぐに戻ってくるということです．
マスターはスレーブが計算を終了したかどうかを判断するために、<code>fmi2GetStatus(&#8230;&#8203;, fmi2DoStepStatus)`を呼び出す必要があります。
fmi2DoStep`と`fmi2GetStatus</code>(4.2.3項参照)でのみ返すことができます。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ヘッダーファイルのプラットフォームとバージョン番号の照会">2.1.4. ヘッダーファイルのプラットフォームとバージョン番号の照会</h4>
<div class="paragraph">
<p>このセクションでは、関数のコンパイルに使用されたヘッダーファイルの情報を照会するために、関数を文書化します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">const char* fmi2GetTypesPlatform(void);</code></pre>
</div>
</div>
<div class="paragraph">
<p>FMUの機能のコンパイルに用いられるヘッダファイル <code>fmi2TypesPlatform.h</code> を一意に識別するための文字列を返します。
この関数は，このヘッダファイルで定義されている <code>fmi2TypesPlatform</code> で指定される静的な文字列へのポインタを返します．
本仕様書に記載されている標準的なヘッダファイルでは，`fmi2TypesPlatform`が`default`に設定されています（したがって，この関数は通常`default`を返します）．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">const char* fmi2GetVersion(void);</code></pre>
</div>
</div>
<div class="paragraph">
<p>FMUの関数をコンパイルする際に使用したヘッダファイル <code>fmi2Functions.h</code> のバージョンを返します。
この関数は、このヘッダファイルで定義されている <code>fmiVersion</code> を返します。
本仕様書に記載されている標準的なヘッダファイルのバージョンは <code>"2.0"</code> です（したがって、この関数は通常 <code>"2.0"</code> を返します）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmuインスタンスの作成破棄ログの記録">2.1.5. FMUインスタンスの作成、破棄、ログの記録</h4>
<div class="paragraph">
<p>ここでは、FMUのインスタンス化、破壊、ロギングに対応する機能について説明します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Component fmi2Instantiate(fmi2String  instanceName,
                              fmi2Type    fmuType,
                              fmi2String fmuGUID,
                              fmi2String fmuResourceLocation,
                              const fmi2CallbackFunctions* functions,
                              fmi2Boolean visible,
                              fmi2Boolean loggingOn);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {fmi2ModelExchange,
              fmi2CoSimulation
             }fmi2Type;</code></pre>
</div>
</div>
<div class="paragraph">
<p>この関数は，FMU の新しいインスタンスを返します。
もし，NULLポインタが返された場合には，インスタンスの生成に失敗したことになります．
この場合，<code>functions&#8594;logger</code> が呼ばれ，その理由に関する詳細な情報が表示されます．
FMUは何度でもインスタンスを作成することができます（ケイパビリティフラグ`canBeInstantiatedOnlyOncePerProcess = false`があれば）。</p>
</div>
<div class="paragraph">
<p>以下の関数を呼び出す前に、この関数が正常に呼び出される必要があります。
共同シミュレーションの場合、この関数の呼び出しは、シミュレーションの実行を開始する前に必要なスレーブのすべてのアクションを実行する必要があります（たとえば、モデルファイルの読み込み、コンパイルなど）。</p>
</div>
<div class="paragraph">
<p>引数 <code>instanceName</code> は、FMUインスタンスの一意の識別子です。
これは、例えば、<code>fmi2XXX`関数のいずれかによって生成されたエラーまたは情報メッセージの中で、インスタンスの名前を付けるために使用されます。
また、この文字列は空であってはなりません（言い換えれば、少なくとも1つの文字が空白であってはなりません）。
<em>[1つのFMUのみをシミュレートする場合、instanceName属性として`modelName`またはXMLスキーマ`fmiModelDescription`の</code>&lt;ModelExchange/CoSimulation modelIdentifier="&#8230;&#8203;"&gt;`が使用されるかもしれません]</em>。</p>
</div>
<div class="paragraph">
<p>引数 <code>fmuType</code> は、FMUのタイプを定義します。:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>= <code>fmi2ModelExchange</code>: FMUの初期化とイベント;
連続したシステムのイベント間シミュレーションは、環境からの外部インテグレータを用いて 環境からの外部インテグレーターを用いて行われます（セクション3参照）。</p>
</li>
<li>
<p>= <code>fmi2CoSimulation</code>: コ・シミュレーションのためのブラックボックス・インターフェース（セクション4参照）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>引数 <code>fmuGUID</code> は，<code>modelDescription.xml</code> ファイル（2.3節参照）がFMUのCコードと互換性があるかどうかを確認するために使用します．
これは、XMLファイルのベンダー固有のグローバルに一意な識別子です（例えば、XMLファイルに格納されている関連情報の「フィンガープリント」です）。
これは、XMLファイルの属性 "guid"（2.2.1項参照）として格納されており、`fmi2Instantiate`関数の引数`fmuGUID`に渡す必要があります。
これは，`fmi2Instantiate`関数の内部に格納されているものと同一でなければなりません．
さもなければ、C言語のコードとFMUのXMLファイルの整合性が取れません。
この引数はNULLではありません。</p>
</div>
<div class="paragraph">
<p>引数 <code>fmuResourceLocation</code> は、次の構文によるURIです。
<a href="http://datatracker.ietf.org/doc/rfc3986/">IETF RFC3986</a>の構文に従ったURIです。FMUアーカイブを解凍した際の`resources`ディレクトリへの位置を示すURIです。
以下のスキームは、FMUによって理解されなければなりません。:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>必須項目です。"file "の絶対パス（オーソリティコンポーネントを含む、または含まない）。</p>
</li>
<li>
<p>任意："http"、"https"、"ftp"</p>
</li>
<li>
<p>予約済みです。FMI for PLM のための "fumi2" です。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>[例 FMUを "C:temp\MyFMU "というディレクトリに解凍した場合、fmuResourceLocation = "file:///C:/temp/MyFMU/resources "または "file:/C:/temp/MyFMU/resources "となります。
関数 <code>fmi2Instantiate</code> は、このディレクトリから、FMUが使用するマップやテーブルなど、必要なリソースをすべて読み込むことができます。]</em></p>
</div>
<div class="paragraph">
<p>引数 <code>functions</code> は、環境からのリソースを利用するために、FMUの機能から使用するコールバック関数を提供します（下記のタイプ <code>fmi2CallbackFunctions</code> を参照）。</p>
</div>
<div class="paragraph">
<p>引数 <code>visible = fmi2False</code> は、ユーザーとのインタラクションを最小限に抑えることを定義しています（アプリケーションウィンドウがない、プロットがない、アニメーションがない、など）。
言い換えれば，FMUはバッチモードで実行されます．
Visible = fmi2True`の場合、FMUはインタラクティブモードで実行され、FMUはシミュレーション/インスタンス化/初期化の開始を明示的に確認する必要があるかもしれません（確認はノンブロッキングです）。</p>
</div>
<div class="paragraph">
<p>If <code>loggingOn = fmi2True</code>, デバッグログが有効になります。<br>
If <code>loggingOn = fmi2False</code>, デバッグログが無効になります。</p>
</div>
<div class="paragraph">
<p><em>[FMUは、この引数に従って、デバッグに役立つ`LogCategories`を有効／無効にします。
FMUがどの`LogCategories`を設定するかは未設定です。]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef struct {
     void  (*logger)(fmi2ComponentEnvironment componentEnvironment,
                          fmi2String instanceName,
                          fmi2Status status,
                          fmi2String category,
                          fmi2String message, ...);
     void* (*allocateMemory)(size_t nobj, size_t size);
     void  (*freeMemory)    (void* obj);
     void (*stepFinished)   (fmi2ComponentEnvironment componentEnvironment,
                             fmi2Status status);
     fmi2ComponentEnvironment componentEnvironment;
} fmi2CallbackFunctions;</code></pre>
</div>
</div>
<div class="paragraph">
<p>この構造体には、FMUが使用するために環境が提供する関数へのポインタが含まれています。
これらの関数を <code>fmi2Instantiate(&#8230;&#8203;)</code> と <code>fmi2Terminate(&#8230;&#8203;)</code> の間で変更することはできません。
さらに、<code>logger`関数が環境からのデータを利用できるように、`valueReference`を文字列にマッピングするなど、`logger`関数に渡す必要のある環境へのポインタ（componentEnvironment）が提供されます。
万が一、`fmi2Component`が`logger`でも必要になる場合は、引数componentEnvironment`を介して渡す必要があります。
引数 `componentEnvironment</code> には null ポインタを指定できます。</p>
</div>
<div class="paragraph">
<p>componentEnvironment` ポインタは、<code>stepFinished(&#8230;&#8203;)</code> 関数にも渡されます。これは、<code>stepFinished(&#8230;&#8203;)</code> を呼び出したスレーブを特定するための効率的な方法を環境が提供するためです。</p>
</div>
<div class="paragraph">
<p>デフォルトの <code>fmi2FunctionTypes.h</code> ファイルでは．使い方を簡単にするために、関数定義の型定義があります。これは規範的ではありません。
関数の意味は次のとおりです。:</p>
</div>
<div class="paragraph">
<p>関数*logger*:
FMUによって呼び出される関数へのポインタ _[通常、<code>fmi2XXX`関数が希望通りに動作しない場合]_です。
status = fmi2OK`の場合、メッセージは純粋な情報メッセージです。
instanceName</code> はこの関数を呼び出した FMU インスタンスの名前です。
category` はメッセージのカテゴリーです。</p>
</div>
<div class="paragraph">
<p><code>category`の許容値は、`modelDescription.xml`ファイルの&lt;fmiModelDescription&gt;&lt;LogCategories&gt;`という要素で定義されています(2.2.4項参照)。
logger</code> は、<code>fmi2SetDebugLogging</code> (下記参照) の呼び出し、または <code>fmi2Instantiate</code> の <code>loggingOn = fmi2True</code> によって有効になったログカテゴリに対してのみ呼び出す必要があります。
FMUがログカテゴリを定義していない場合、<code>category`は`NULL`でなければなりません。
引数の `message</code> は、ログに記録するメッセージを含む文字列です。
改行を含んでもかまいませんが、最後に改行があってはいけませんし、関数 <code>printn</code> と同じ方法、同じフォーマット制御で提供されます。C標準ライブラリの関数`printf`と同じ方法、同じフォーマット制御で提供されます。+
<em>[通常、この関数はメッセージを印刷し、オプションでログファイルに保存します]</em>。</p>
</div>
<div class="paragraph">
<p>FMUから`logger`に渡されたすべての文字列値の引数は、関数`logger`が戻った後、FMUによって直接解放されることがあります。
<em>[そのため、シミュレーション環境では、後でこれらの文字列にアクセスする必要がある場合、これらの文字列のコピーを作成する必要があります]</em>。+</p>
</div>
<div class="paragraph">
<p>ここで，&lt;Type&gt;は`fmi2Real`の "r"，<code>fmi2Integer`の "i"，`fmi2Boolean`の "b"，`fmi2String`の "s "です．
「i "は`fmi2Integer</code>、"b "は`fmi2Boolean`、"s "は`fmi2String`となります。
文字 <code>#</code> をメッセージに含める場合は、その前に <code>#</code> を付ける必要があります。
文字`#<code>がメッセージに含まれる場合は、</code>#<code>を前置しなければならないので、</code>#`はエスケープ文字となります。
<em>[例:</em><br></p>
</div>
<div class="paragraph">
<p><em>A message of the form "#r1365# must be larger than zero (used in IO channel ##4)"</em><br>
<em>might be changed by the <code>logger</code> function to</em><br>
<em>`"body.m must be larger than zero (used in IO channel #4)"`</em><br>
<em>if <code>"body.m"</code> is the name of the <code>fmi2Real</code> variable with <code>fmi2ValueReference = 1365</code>.]</em></p>
</div>
<div class="paragraph">
<p>関数 <strong>allocateMemory</strong> です。+
メモリを割り当てる必要がある場合に FMU で呼び出される関数へのポインタです。
&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;`の属性`canNotUseMemoryManagementFunctions = true`の場合、関数`allocateMemory`はFMUで使用されません。
とすると、FMUでは関数`allocateMemory`は使用されず、ボイドポインタを提供することができます。
この属性の値が <code>false</code> (これがデフォルトです) の場合、FMU は <code>mallocateMemory</code> を使用してはいけません。
FMU は <code>malloc</code> や <code>calloc</code> などのメモリ割り当て関数を使用してはいけません。
理由の一つは、ターゲットマシンの組み込みシステムでは、これらの関数が利用できない可能性があるからです。
もう一つの理由は，環境が最適化された，あるいは特殊なメモリ割り当て関数を持っている可能性があるからです．
<code>allocateMemory</code> は，<code>nobj</code> オブジェクトのベクトルを格納する領域へのポインタを返します．
要求が満たされない場合には，サイズ <code>size</code> または <code>NULL</code> のそれぞれの <code>nobj</code> オブジェクトのベクトルの領域へのポインタを返します．
領域は0バイトに初期化されます_[(C標準ライブラリの`calloc`を使用するのが簡単な実装です)]_。</p>
</div>
<div class="paragraph">
<p>関数 <strong>freeMemory</strong> です。+
allocateMemory` で確保されたメモリを解放する際に、FMU で呼び出さなければならない関数へのポインタを指定します。
入力引数 <code>obj</code> に null ポインタが指定された場合、この関数は何も行いません。
この関数は何もしません_[(簡単な実装としては、C標準ライブラリのfreeを使用します。
ANSI C89とC99では、ヌルポインタの処理はここで定義されているものと同じです）]_.
&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;`の属性`canNotUseMemoryManagementFunctions = true`の場合、関数`freeMemory`は何もしません。
の属性 <code>canNotUseMemoryManagementFunctions = true</code> の場合、関数 <code>freeMemory</code> は FMU で使用されず、ヌルポインターを提供することができます。</p>
</div>
<div class="paragraph">
<p>関数 <strong>stepFinished</strong> です。+
オプションのコールバック関数で、Co-シミュレーションスレーブの通信ステップの計算が終了したかどうかを通知します。
null ポインタを指定することもできます。
この場合、マスターは <code>fmiGetStatus(&#8230;&#8203;)</code> を使って <code>fmi2DoStep</code> の状態を問い合わせる必要があります。
関数へのポインタが指定された場合は、通信ステップが完了した後にFMUがその関数を呼び出す必要があります。</p>
</div>
<div class="paragraph">
<p><em>[注：FMI 3.0では、メモリコールバック関数は削除されました。これは、意図された用途が実現されず、実装に問題が生じることが多かったためです。
FMI 2.0.2の新機能：メモリコールバック関数の使用は推奨されません。]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">void fmi2FreeInstance(fmi2Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>与えられたインスタンスを破棄し、ロードされたモデルをアンロードします。
そして，FMUインタフェースの関数によって割り当てられたメモリやその他のリソースをすべて解放します。
c` に null ポインタが指定された場合、その関数の呼び出しは無視されます（効果がありません）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2SetDebugLogging(fmi2Component c, fmi2Boolean loggingOn,
                               size_t nCategories,
                               const fmi2String categories[]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>この関数は、FMUがloggerコールバック関数を介して出力するデバッグロギングを制御します。</p>
</div>
<div class="paragraph">
<p>loggingOn == fmi2True`の場合、<code>categories`で指定されたログカテゴリーに対してデバッグロギングが有効になり、そうでない場合は無効になります。
nCategories</code> は、引数 <code>categories</code> の長さを定義します。
nCategories == 0` の場合、<code>loggingOn</code> はすべてのログカテゴリに適用され、categories の値は未定義です。
categories` の許容値は、<code>modelDescription.xml</code> ファイルの要素 <code>&lt;LogCategories&gt;</code> で定義されます（2.2.4 節参照）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_initialization_termination_and_resetting_an_fmu">2.1.6. Initialization, Termination, and Resetting an FMU</h4>
<div class="paragraph">
<p>This section documents functions that deal with initialization, termination, and resetting of an FMU.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2SetupExperiment(fmi2Component c,
                               fmi2Boolean   toleranceDefined,
                               fmi2Real      tolerance,
                               fmi2Real      startTime,
                               fmi2Boolean   stopTimeDefined,
                               fmi2Real      stopTime);</code></pre>
</div>
</div>
<div class="paragraph">
<p>FMU に実験の設定を通知します。
この関数は、<code>fmi2Instantiate`の後、`fmi2EnterInitializationMode`が呼ばれる前に呼ばれなければなりません。
引数の `toleranceDefined</code> と <code>tolerance</code> は FMU のタイプに依存します。</p>
</div>
<div class="paragraph second-indented">
<p><strong>fmuType = fmi2ModelExchange</strong>:<br>
toleranceDefined = fmi2True`であれば、モデルは数値積分スキームで呼び出されます。
ステップサイズは、誤差の推定に「許容範囲」を使用して制御されます（通常は相対的な「許容範囲」として）。
このような場合、モデル内部で使用されるすべての数値アルゴリズム（例えば、非線形代数方程式の解
このような場合、モデル内部で使用されるすべての数値アルゴリズム（例えば、非線形代数方程式を解くため）は、適切な小さい相対的な許容範囲の誤差推定で動作する必要があります。</p>
</div>
<div class="paragraph second-indented">
<p><strong>fmuType = fmi2CoSimulation</strong>:<br>
toleranceDefined = fmi2True`とすると，スレーブの通信間隔を誤差評価で制御することになります。
スレーブが可変ステップサイズの数値積分器を使用していて、誤差を推定する場合は、内部積分器の誤差推定に`tolerance`を使用することをお勧めします。
(通常は相対的な許容値)を使用することをお勧めします。+
コ・シミュレーション用のFMUでは、この引数を無視することがある。</p>
</div>
<div class="paragraph">
<p>引数 <code>startTime</code> と <code>stopTime</code> は、モデルが与えられた境界内で有効かどうかをチェックしたり、結果を保存するために必要なメモリを割り当てるために使用することができます。
引数 <code>startTime</code> は独立変数の固定された初期値である。
<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup>
value <em>[独立変数が`time`の場合、`startTime`は初期化の開始時間です。]</em>.
stopTimeDefined = fmi2True`の場合、`stopTime`は定義された独立変数の最終値であり[独立変数が`time`の場合、`stopTime`はシミュレーションの停止時間]、環境が`stopTime`を超えて計算しようとすると、FMUは`fmi2Status = fmi2Error`を返さなければなりません。
 stopTimeDefined = fmi2False`であれば、独立変数の最終値は定義されず、引数`stopTime`は意味を持ちません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2EnterInitializationMode(fmi2Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>FMUに初期化モードに入ることを通知します。
この関数を呼び出す前に、<code>&lt;ScalarVariable initial = exact</code> または <code>approx&gt;</code> という属性を持つすべての変数を <code>fmi2SetXXX</code> 関数で設定することができる（<code>ScalarVariable</code> 属性はモデル記述ファイルで定義されている。
fmi2SetXXX`関数で設定することができます（`ScalarVariable`属性はモデル記述ファイルで定義されています、2.2.7項参照）。
それ以外の変数を設定することはできません。
さらに，`fmi2EnterInitializationMode`を呼び出す前に，`fmi2SetupExperiment`を少なくとも一度は呼び出さなければ，`startTime`が定義されません．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2ExitInitializationMode(fmi2Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>FMUに初期化モードの終了を通知します。
fmuType = fmi2ModelExchange`の場合、この関数はすべての初期化方程式をオフにし、FMUは暗黙のうちにイベントモードに入ります。つまり、すべての連続時間およびアクティブな離散時間方程式が利用可能になります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2Terminate(fmi2Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>シミュレーションの実行が終了したことをFMUに通知します。
この関数を呼び出した後、すべての変数の最終値は <code>fmi2GetXXX(&#8230;&#8203;)</code> 関数で問い合わせることができます。
fmi2Error`や`fmi2Fatal`のステータスフラグを持つ関数の後にこの関数を呼び出すことはできません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2Reset(fmi2Component c);</code></pre>
</div>
</div>
<div class="paragraph">
<p>シミュレーションの実行後に環境から呼び出され、FMUをリセットします。
FMUは、`fmi2Instantiate`が呼ばれたときと同じ状態になります。
すべての変数はデフォルト値になります．
新しい実行を開始する前に、`fmi2SetupExperiment`と`fmi2EnterInitializationMode`を呼び出す必要があります。</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_and_setting_variable_values">2.1.7. Getting and Setting Variable Values</h4>
<div class="paragraph">
<p>FMUのすべての変数値は、「値参照」と呼ばれる変数ハンドルで識別されます。
このハンドルは <code>modelDescription.xml</code> ファイルの中で定義されています（要素 <code>ScalarVariable</code> の中の属性 <code>valueReference</code> として）。
要素 <code>valueReference</code> はすべての変数で一意ではないかもしれません。
同じ基本データ型（`fmi2Real`など）の2つ以上の変数が同じ`valueReference`を持つ場合、それらは同一の値を持ちますが、変数定義の他の部分は異なる可能性があります。
<em>[例えば、min/max属性]</em>.</p>
</div>
<div class="paragraph">
<p>modelDescription.xml`ファイルで定義されている変数の実際の値は，以下の関数を使って`fmi2EnterInitializationMode`を呼び出した後に問い合わせることができます．</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2GetReal   (fmi2Component c, const fmi2ValueReference vr[],
                          size_t nvr, fmi2Real value[]);
fmi2Status fmi2GetInteger(fmi2Component c, const fmi2ValueReference vr[],
                          size_t nvr, fmi2Integer value[]);
fmi2Status fmi2GetBoolean(fmi2Component c, const fmi2ValueReference vr[],
                          size_t nvr, fmi2Boolean value[]);
fmi2Status fmi2GetString (fmi2Component c, const fmi2ValueReference vr[],
                          size_t nvr, fmi2String value[]);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>変数の参照先を指定して、変数の実際の値を取得することができます。
<em>[これらの関数は，モデルが他のモデルと接続されている場合に，出力変数の実際の値を得るために特に使用されます．
状態導関数も`ScalarVariable`sなので，状態導関数の値を得ることができます．
これはFMU同士を接続する際に便利です。
さらに，`modelDescription.xml`ファイルで定義されたすべての変数の実際の値は，実際に定義された時間の瞬間に決定することができます（2.2.7節参照）．]</em></p>
</div>
<div class="ulist indented2">
<ul>
<li>
<p>引数の`vr`は、問い合わせを行う変数を定義する`nvr`の値ハンドルのベクトルです。</p>
</li>
<li>
<p>引数の <code>value</code> は、これらの変数の実際の値を持つベクトルです。</p>
</li>
<li>
<p>fmi2GetString` が返す文字列は、ターゲット環境でコピーする必要があります。なぜなら、これらの文字列に割り当てられたメモリは、次に fmi2 インターフェース関数が呼び出されたときに解放されたり、再利用される内部の文字列バッファであったりする可能性があるからです。</p>
</li>
<li>
<p>ModelExchangeでは、<code>fmi2Status = fmi2Discard`は、`fmi2GetReal`でのみ可能で、`fmi2GetInteger</code>、<code>fmi2GetBoolean</code>、`fmi2GetString`では不可能です。
なぜなら、これらは離散時間変数であり、その値はイベントの瞬間にしか変化しないため、`fmi2Discard`は意味をなさないからです。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>また、以下の機能を使って、[underline]#特定の#変数の値を特定の瞬間に[underline]#設定する#ことも可能です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2SetReal   (fmi2Component c, const fmi2ValueReference vr[],
                          size_t nvr, const fmi2Real value[]);
fmi2Status fmi2SetInteger(fmi2Component c, const fmi2ValueReference vr[],
                          size_t nvr, const fmi2Integer value[]);
fmi2Status fmi2SetBoolean(fmi2Component c, const fmi2ValueReference vr[],
                          size_t nvr, const fmi2Boolean value[]);
fmi2Status fmi2SetString (fmi2Component c, const fmi2ValueReference vr[],
                          size_t nvr, const fmi2String value[]);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>パラメータ、入力、開始値を設定し、これらの変数に依存する変数のキャッシングを再初期化します (どのタイプの変数 <code>fmi2SetXXX</code> を呼び出すことができるかの正確なルールについては、2.2.7節を参照してください。また、ModelExchangeの場合は3.2.3節、CoSimulationの場合は4.2.4節も参照してください)。</p>
</div>
<div class="ulist indented2">
<ul>
<li>
<p>引数 <code>vr</code> は、設定すべき変数を定義する <code>nvr</code> 値ハンドルのベクトルです。</p>
</li>
<li>
<p>引数の <code>value</code> は、これらの変数の実際の値を持つベクトルです。</p>
</li>
<li>
<p>fmi2SetString`に引数として渡された全ての文字列は、この関数内でコピーしなければなりません。なぜなら、この関数が戻ってきたときに文字列の寿命が保証されていないからです。</p>
</li>
<li>
<p>なお、`fmi2SetXXX`関数では、`fmi2Status = fmi2Discard`が可能です。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>コ・シミュレーションFMUでは、4.2.1項で、補間を可能にするために、時間に対する変数の微分を設定したり、問い合わせたりする追加関数が定義されている。</p>
</div>
</div>
<div class="sect3">
<h4 id="GetSetCompleteFMUState">2.1.8. FMU Complete Stateの取得と設定</h4>
<div class="paragraph">
<p>FMUは、シミュレーションを継続するために必要なすべての値で構成される内部状態を持っています。
この内部状態は、特に、連続時間状態の値、反復変数、パラメータ値、入力値、遅延バッファ、ファイル識別子、FMU内部のステータス情報で構成されています。
このセクションの機能により、FMUの内部状態をコピーし、このコピーへのポインタを環境に返すことができます。
コピーされたFMU状態を実際のFMU状態として設定し、そこからシミュレーションを継続することができます。</p>
</div>
<div class="paragraph">
<p><em>[本機能の使用例:</em></p>
</div>
<div class="paragraph">
<p><em>コ・シミュレーション・マスター・アルゴリズムの可変ステップ・サイズ制御（通信ステップを受け付けるごとにFMUの状態を取得する。
通信ステップごとにFMU状態を取得する。
後続のステップが受け入れられなかった場合、このFMU状態から協調シミュレーションを再開する）。)</em></p>
</div>
<div class="paragraph">
<p><em>非線形カルマンフィルターの場合（初期化の直前にFMUの状態を取得します。
サンプル期間ごとに、測定値に基づいてカルマンフィルタアルゴリズムから新しい連続状態を設定する。
次のサンプルの瞬間まで積分し、カルマンフィルターアルゴリズムで使用された予測連続状態を、新しい連続状態を設定するための基礎として照会する）。)</em></p>
</div>
<div class="paragraph">
<p><em>非線形モデル予測制御の場合（初期化の直前にFMUの状態を取得する。
サンプル期間ごとにオブザーバーから新しい連続状態を設定して初期化し、初期化後のFMU状態を取得する。
この状態から、初期化後にオプティマイザが提案する新しい入力信号で再スタートするシミュレーションを多数行う）。)]</em></p>
</div>
<div class="paragraph">
<p>さらに、FMUの状態をシリアル化し、バイトベクターでコピーすることができる:
<em>[これは、例えば、高価な定常状態の初期化を行うために使用することができます。受信したFMUの状態をバイトベクターにコピーして、このベクターをファイルに保存します。
必要に応じて、ファイルからバイトベクターをロードし、デシリアライズすることで
ファイルから読み込んでデシリアライズし、このFMUの状態からシミュレーションを再開することができます。つまり、定常状態の初期化からシミュレーションを再開することができます。]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2GetFMUstate (fmi2Component c, fmi2FMUstate* FMUstate);
fmi2Status fmi2SetFMUstate (fmi2Component c, fmi2FMUstate  FMUstate);
fmi2Status fmi2FreeFMUstate(fmi2Component c, fmi2FMUstate* FMUstate);</code></pre>
</div>
</div>
<div class="paragraph">
<p>fmi2GetFMUstate`は内部のFMUの状態のコピーを作成し、そのコピーへのポインタ(<code>FMUstate</code>)を返します。
エントリで <code>*FMUstate == NULL</code> となった場合は、新たな割り当てが必要です。
FMUstate != NULL` の場合、<code>*FMUstate</code> は以前に返された <code>FMUstate</code> を指しており、それ以降は変更されていません。
特に、<code>fmi2FreeFMUstate`はこの`FMUstate`を引数にして呼び出されていません。
<em>[関数 `fmi2GetFMUstate</code> は通常、この <code>FMUstate</code> のメモリを再利用します。この場合、同じポインタを返しますが、実際の <code>FMUstate</code> を返します。]</em></p>
</div>
<div class="paragraph">
<p>fmi2SetFMUstate`では、以前にコピーした`FMUstate`の内容を戻して、実際の新しいFMUステートとして使用します。
コピーされた`FMUstate`はまだ存在します。</p>
</div>
<div class="paragraph">
<p>fmi2FreeFMUstate`は、この`FMUstate`に対して`fmi2GetFMUstate`コールで割り当てられたすべてのメモリやその他のリソースを解放します。
この関数の入力引数には、解放する`FMUstate`を指定します。
ヌルポインターが指定された場合、その呼び出しは無視されます。
この関数は、引数 <code>FMUstate</code> に null ポインタを返します。</p>
</div>
<div class="paragraph">
<p>これらの関数がFMUでサポートされるのは、`&lt;fmiModelDescription&gt; &lt;ModelExchange / CoSimulation&gt; `のオプションのケイパビリティフラグ`canGetAndSetFMUstate`がXMLファイルで明示的に`true`に設定されている場合のみです（セクション3.3.1および4.3.1を参照）。
が明示的にtrueに設定されている場合のみサポートされます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">mi2Status fmi2SerializedFMUstateSize(fmi2Component c, fmi2FMUstate FMUstate,
                                     size_t *size);
fmi2Status fmi2SerializeFMUstate    (fmi2Component c, fmi2FMUstate FMUstate,
                                     fmi2Byte serializedState[], size_t size);
fmi2Status fmi2DeSerializeFMUstate  (fmi2Component c,
                                     const fmi2Byte serializedState[],
                                     size_t size, fmi2FMUstate* FMUstate);</code></pre>
</div>
</div>
<div class="paragraph">
<p>fmi2SerializedFMUstateSize`は、<code>FMUstate`を格納できるように、バイトベクトルの`サイズ`を返します。
この情報をもとに、環境は必要な長さ `size</code> の <code>fmi2Byte</code> ベクトルを割り当てる必要があります。</p>
</div>
<div class="paragraph">
<p>fmi2SerializeFMUstate`は、ポインタ`FMUstate`で参照されるデータをシリアライズして、環境で提供される長さ`size`のバイトベクトル`serializedState`にコピーします。</p>
</div>
<div class="paragraph">
<p>fmi2DeSerializeFMUstate`は、長さ`size`のバイトベクトル`serializedState`をデシリアライズして、FMUステートのコピーを構築し、このコピーへのポインタである`FMUstate`を返します。
<em>[FMUstate`で`fmi2SetFMUState`を呼び出すと、この状態でシミュレーションが再開されます。]</em></p>
</div>
<div class="paragraph">
<p>これらの関数は、FMUでのみサポートされています。
XMLファイルの&lt;fmiModelDescription&gt;&lt;ModelExchange / CoSimulation&gt;`にあるオプションのケイパビリティフラグ`canGetAndSetFMUstate`および`canSerializeFMUstate`が明示的に`true`に設定されている場合、これらの関数はFMUでのみサポートされます（3.3.1項および4.3.1項を参照）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_偏微分の取得">2.1.9. 偏微分の取得</h4>
<div class="paragraph">
<p>オプションとして、FMU の偏微分の評価を提供することが可能です。
モデル交換では、特定の時間の瞬間に偏微分を計算することを意味します。
コ・シミュレーションでは、特定の通信点での偏微分を計算することを意味する。
方向性のある微分を計算するための関数が1つ用意されています。
この関数は、必要な偏微分マトリクスを構築するために使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2GetDirectionalDerivative(fmi2Component c,
                      const fmi2ValueReference vUnknown_ref[], size_t nUnknown,
                      const fmi2ValueReference vKnown_ref[] , size_t nKnown,
                      const fmi2Real dvKnown[],
                            fmi2Real dvUnknown[])</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>この関数は、FMUの方向性デリバティブを計算します。
FMUには様々なモードがあり、各モードにおいてFMUは異なる方程式と異なる未知数で記述される可能性があります。
正確な定義は、モデル交換（3.1項）およびコ・シミュレーション（4.1項）の数学的な説明に記載されています。
どのモードでも、FMUの方程式の一般的な形式は次のとおりである。</p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{v}_{unknown} = \mathbf{h}(\mathbf{v}_{known}, \mathbf{v}_{rest}),\]
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\color{blue}{\mathbf{v}_{unknown}}\) は、実際のModeで計算された未知のReal変数のベクトルです。</p>
<div class="ulist">
<ul>
<li>
<p><em>Initialization Mode</em>: &lt;ModelStructure&gt;&lt;InitialUnknowns&gt;`に記載されている露出した未知数のうち、タイプがRealであるもの。</p>
</li>
<li>
<p><em>Continuous-Time Mode (ModelExchange)</em>: 連続時間の出力と状態導関数
(=<code>&lt;ModelStructure&gt;&lt;Outputs&gt;`の下にリストアップされている変数で、タイプがReal、`variability = "continuous"`であり、</code>&lt;ModelStructure&gt;&lt;Derivatives&gt;`の下に状態デリバティブとしてリストアップされている変数)。</p>
</li>
<li>
<p><em>Event Mode (ModelExchange)</em>: 連続時間モードと同じ変数に加えて、`&lt;ModelStructure&gt;&lt;Outputs&gt;`の下に、タイプがRealで、`variability = "discrete"`の変数が追加されています。</p>
</li>
<li>
<p><em>Step Mode (CoSimulation)</em>: &lt;ModelStructure&gt;&lt;Outputs&gt;` の下にリストされている変数で、タイプは Real で、<code>variability = continuous</code> または <code>discrete</code> です。
&lt;ModelStructure&gt;&lt;Derivatives&gt;`が存在する場合、ここに記載されている変数も状態デリバティブとして表示されます。</p>
</li>
</ul>
</div>
</li>
<li>
<p>\(\color{blue}{\mathbf{v}_{known}}\) は、実際のModeで値が変化する関数*h*のReal入力変数のベクトルです。
詳細は2.2.8項の要素`dependencies`の説明にあります。
<em>[例えば、連続時間モードでの連続時間の入力などです。
ScalarVariable`sで`causality = "independent"`の変数が明示的に定義されている場合、この変数に対する方向性微分を計算することができます。
このような変数が定義されていない場合，独立変数に対する方向性微分は計算できません。].</em></p>
</li>
<li>
<p>\(\color{blue}{\mathbf{v}_{rest}}\) は，関数*h*の入力変数のうち，実際のModeで値が変化するが非Real変数であるもの，あるいは，このModeでは値が変化しないが，他のModeでは値が変化するものの集合であり <em>[例えば、連続時間モードの離散時間入力]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>能力属性 <code>providesDirectionalDerivative</code> が <code>true</code> の場合、<code>fmi2GetDirectionalDerivative</code> は、選択された入力変数に対する <strong>h</strong> の偏微分の線形結合を計算します。 \(\color{blue}{\mathbf{v}_{known}}\):</p>
</div>
<div class="stemblock">
<div class="content">
\[\Delta \mathbf{v}_{unknown} = \frac{\delta \mathbf{h}}{\delta \mathbf{v}_{known}}\Delta \mathbf{v}_{known}\]
</div>
</div>
<div class="paragraph">
<p>それに伴い、方向性のある微分ベクトルを計算します。
\(\color{blue}{\Delta \mathbf{v}_{unknown}}\) (<code>dvUnknown</code>) シードベクトルから
\(\color{blue}{\Delta \mathbf{v}_{known}}\) (<code>dvKnown</code>)</p>
</div>
<div class="paragraph">
<p><em>[変数の関係は、モードによって異なる。
例えば、連続時間モードでは、連続時間出力yは離散時間入力に依存しません（イベント間で一定に保たれているため）。
しかし、イベントモードでは、yは離散時間入力に依存する。]</em><br>
<em>この関数は、方程式系の疎密を考慮した数値微分によって方向性のある微分を計算してもよいし、（望ましい）解析的な微分によってもよい。</em></p>
</div>
<div class="paragraph">
<p><em>例:</em><br>
<em>FMUには次のような出力式があります。</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{bmatrix}
y_1
\\
y_2
\end{bmatrix}
=
\begin{bmatrix}
g_1(x, u_1, u_3, u_4)
\\
g_2(x, u_1)
\end{bmatrix}\]
</div>
</div>
<div class="paragraph">
<p><em>となり、このFMUは接続されているため、\(\color{blue}{y_1, u_1, u_3}\)が代数的なループに現れます。
非線形ソルバーはヤコビアンを必要とし、このヤコビアンは、\(\color{blue}{y_1}\)の偏導関数を用いて（数値微分せずに）計算することができます。
\(\color{blue}{u_1}\) and \(\color{blue}{u_3}\) が利用できます。
FMUが接続される環境に応じて、以下のようなデリバティブが提供されます。</em></p>
</div>
<div class="paragraph">
<p>(a) <em>with one wrapper function around function fmi2GetDirectionalDerivative to compute the directional
derivatives with respect to these two variables (in other words, \(\color{blue}{v_{unknown} = y_1}\),
\(\color{blue}{v_{known} = \left \{ u_1, u_3 \right \}}\)), and then the environment calls
this wrapper function with \(\color{blue}{\Delta v_{known} = \left \{ 1, 0 \right \}}\)
to compute the partial derivative with respect to
\(\color{blue}{u_1}\) and \(\color{blue}{\Delta v_{known} = \left \{ 0, 1 \right \}}\)
to compute the partial derivative with respect to \(\color{blue}{u_3}\), or</em></p>
</div>
<div class="paragraph">
<p>(a) <em>関数 fmi2GetDirectionalDerivative を中心としたラッパー関数で、この2つの変数に対する方向性のある微分を計算し（つまり、\(\color{blue}{v_{unknown} = y_1}\)、\(\color{blue}{v_{known} = \left \{ u_1, u_3 \right \}}\)）、このラッパー関数を\(\color{blue}{\Delta v_{known} = \left \{ 1, 0 \right \}}\)で呼び出す環境です。 環境はこのラッパー関数を\(\color{blue}{u_1}\)で呼び出し、\(\color{blue}{u_1}\)と\(\color{blue}{\Delta v_{known} = \left \{ 0, 1 \right \}}\)に関する偏微分を計算します。 偏導関数を計算するには \(\color{blue}{u_3}\)が必要です。</em></p>
</div>
<div class="paragraph">
<p>(b) <em>と、fmi2GetDirectionalDerivativeの直接関数呼び出しが2回あります(言い換えれば、\(\color{blue}{v_{unknown} = y_1, v_{known} = u_1, \Delta v_{known} = 1}\)と、\(\color{blue}{v_{unknown} = y_1, v_{known} = u_3, \Delta v_{known} = 1}\)です)。</em></p>
</div>
<div class="paragraph">
<p><em>なお、この関数を解析的な導関数で直接実装すると:</em></p>
</div>
<div class="paragraph">
<p>(a) <em>すべての入力変数に対して方向性のある微分を提供します。上の例では、 \(\color{blue}{\Delta y_1 = \frac{\delta g_1}{\delta x} \cdot \Delta x + \frac{\delta g_1}{\delta u_1} \cdot \Delta u_1 + \frac{\delta g_1}{\delta u_3} \cdot \Delta u_3 + \frac{\delta g_1}{\delta u_4} \cdot \Delta u_4}\)</em></p>
</div>
<div class="paragraph">
<p>(b) <em>全てのシード値を0に初期化します。上記の例では、\(\color{blue}{\Delta x = \Delta u_1 = \Delta u_3 = \Delta u_4 = 0}\)となります。</em></p>
</div>
<div class="paragraph">
<p>(c) <em>関数の引数で指定されたシード値を用いて、方向微分を計算します。上記の例では、以下のようになります。\(\color{blue}{\Delta v_{unknown} = \Delta y_1 (\Delta x = 0, \Delta u_1 = 1, \Delta u_3 = 1, \Delta u_4 = 0)}\)]</em></p>
</div>
<div class="paragraph">
<p><em>[なお、関数fmi2GetDirectionalDerivativeは以下の目的で使用できます。:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>剛性法の数値積分には、行列 \(\color{blue}{\frac{\delta \mathbf{f}}{\delta \mathbf{x}}}\)が必要です。</em></p>
</li>
<li>
<p><em>FMUが他のFMUと接続されている場合、接続されているFMUのシステムのジャコビアンを計算するためには、連続した状態と入力に関する状態微分と出力の偏微分が必要となります。</em></p>
</li>
<li>
<p><em>FMUを線形化する場合は、前項目と同様の微分が必要です。</em></p>
</li>
<li>
<p><em>FMUを拡張カルマンフィルターのモデルとして使用した場合。
\(\color{blue}{\frac{\delta \mathbf{f}}{\delta \mathbf{x}}}\)と\(\color{blue}{\frac{\delta \mathbf{g}}{\delta \mathbf{x}}}\)が必要です。</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>密な行列を計算する場合は、fmi2GetDirectionalDerivativeを連続して呼び出すことで、行列の列を簡単に構築できます。
例えば、システムのヤコビアン\(\color{blue}{\mathbf{A} = \frac{\delta \mathbf{f}}{\delta \mathbf{x}}}\)を密な行列として構築するには、以下のような方法があります。</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">m = M_fmi2Instantiate("m", ...)  // "m" is the instance name
                                 // "M_" is the MODEL_IDENTIFIER
// from XML file
nx     = ...   // number of states
x_ref [..] = ...   // vector of value references of cont.-time states
xd_ref[..] = ...   // vector of value references of state derivatives
dvKnown[1] = {1.0}; //seed vector for fmi2GetDirectionalDerivative
...
// If required at this step, compute the Jacobian as dense matrix
   // Set time, states and inputs
   M_fmi2SetTime(m, time)
   M_fmi2SetContinuousStates(m, x, nx)
   M_fmi2SetReal/Integer/Boolean/String(m, ...)
   // Construct the Jacobian elements J[:,:] columnwise
for i in 1:nx loop
  M_fmi2GetDirectionalDerivative(m, xd_ref, nx, x_ref[i], 1, dvKnown, ci);
  J[:,i] = ci;    // ci is an auxiliary vector of nx elements
                  // (it holds the i-th column of the Jacobian)
end for;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>行列のスパース性を考慮しなければならない場合、その行列は次のようにして作られます。</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>行列の入射情報（要素がゼロかゼロでないか）は、XMLファイルの要素&lt;ModelStructure&gt;から抽出されます。</em></p>
</li>
<li>
<p><em>fmi2GetDirectionalDerivativeの1回の呼び出しで計算できる行列の列を決定するために、いわゆるグラフカラーリングアルゴリズムを採用しています。
効率的なグラフカラーリングアルゴリズムは、C/C++で書かれたライブラリColPack (<a href="https://cscapes.cs.purdue.edu/coloringpage/" class="bare">https://cscapes.cs.purdue.edu/coloringpage/</a>) (LGPL)や、Coleman, Garbow, Moréによるルーチン (Software for estimating sparse Jacobian matrices, ACM Transactions on Mathematical Software - TOMS , vol. 10, no. 3, pp. 346-347, 1984)など、自由に利用することができます。3, pp.346-347, 1984. <a href="http://www.netlib.org/toms/618" class="bare">http://www.netlib.org/toms/618</a> などを参照。</em></p>
</li>
<li>
<p><em>(2)で決定した列に対して、fmi2DirectionalDerivativeの呼び出しが1回行われます。
それぞれの呼び出しの後、結果として得られる方向性のある微分ベクトルの要素は、偏微分行列の正しい位置にコピーされます。</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>詳細や実装上の注意点は(Akesson et.al. 2012)を参照してください]。</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_description_schema">2.2. FMI Description Schema</h3>
<div class="paragraph">
<p>All static information related to an FMU is stored in the text file <code>modelDescription.xml</code>
in XML format.
Especially, the FMU variables and their attributes such as name, unit,
default initial value, etc. are stored in this file.
The structure of this XML file is defined with the schema file `"fmiModelDescription.xsd`".
This schema file utilizes the following helper schema files:</p>
</div>
<div class="paragraph indented2">
<p><code>fmi2Annotation.xsd</code><br>
<code>fmi2AttributeGroups.xsd</code><br>
<code>fmi2ScalarVariable.xsd</code><br>
<code>fmi2Type.xsd</code><br>
<code>fmi2VariableDependency.xsd</code><br>
<code>fmi2Unit.xsd</code></p>
</div>
<div class="paragraph">
<p>In this section these schema files are discussed.
The normative definition are the above mentioned schema files
<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>.
Below, optional elements are marked with a "dashed" box.
The required data types (like: xs:normalizedString) are defined in the XML-schema standard: <a href="http://www.w3.org/TR/XMLschema-2/" class="bare">http://www.w3.org/TR/XMLschema-2/</a>.
The types used in the fmi2 schema files are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XML</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description (<a href="http://www.w3.org/TR/xmlschema-2/">http://www.w3.org/TR/XMLschema-2/</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Mapping to C</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IEEE double-precision 64-bit floating point type <em>[In order to not loose precision,
a number of this type should be stored on an XML file with at least <strong>16</strong> significant digits; for example, 2/3 should be stored as <code>0.6666666666666667</code>]</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 2147483647 and minimum value -2147483648 (32 bit Integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:unsignedInt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer number with maximum value 4294967295 and minimum value 0 (unsigned 32 bit Integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unsigned int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean number. Legal literals: false, true, 0, 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any number of characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:normalizedString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String without carriage return, line feed, and tab characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xs:dateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date, time and time zone (for details see the link above).
Example: 2002-10-23T12:00:00Z (noon on October 23, 2002, Greenwich Mean Time)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tool specific</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first line of an XML file, such as <code>modelDescription.xml</code>,
must contain the encoding scheme of the XML file.
It is required that the encoding scheme is always UTF-8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The FMI schema files (*.xsd) are also stored in "UTF-8".<br>
<em>[Note that the definition of an encoding scheme is a prerequisite
in order for the XML file to contain letters outside of the 7 bit ANSI ASCII character set,
such as German umlauts, or Asian characters. Furthermore,
note the FMI calling interface requires that strings are encoded in UTF-8.
Since the XML files are also required to be encoded in UTF-8,
string variables need not to be transformed when reading from the XML files in to C string variables.].</em></p>
</div>
<div class="paragraph">
<p>The special values NAN, +INF, -INF for variables values are not allowed in the FMI XML files.</p>
</div>
<div class="paragraph">
<p><em><span class="Note that child information items">ordered lists</span> according to document order,
whereas attribute information items are <span class="underline">unordered sets</span> (see <a href="http://www.w3.org/TR/XML-infoset/#infoitem.element" class="bare">http://www.w3.org/TR/XML-infoset/#infoitem.element</a>).
The FMI schema is based on ordered lists in a sequence and therefore parsing must preserve this order.
For example, the information stored in <code>ModelVariables.Derivatives</code> is only correct if this property is fulfilled.]</em></p>
</div>
<div class="sect3">
<h4 id="_definition_of_an_fmu_fmimodeldescription">2.2.1. Definition of an FMU (fmiModelDescription)</h4>
<div class="paragraph">
<p>This is the root-level schema file and contains the following definition (the figure below contains all
elements in the schema file.
Data is defined by attributes to these elements):</p>
</div>
<div id="system_overview" class="paragraph">
<p><span class="image"><img src="images/fmiModelDescription_schema.png" alt="fmiModelDescription schema"></span></p>
</div>
<div class="paragraph">
<p>On the top level,
the schema consists of the following elements (see <a href="#system_overview">figure above</a>
<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element-Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelExchange</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present,
the FMU is based on "FMI for Model Exchange" <em>[(in other words, the FMU includes the model or the communication to a tool that provides the model,
and the environment provides the simulation engine)]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CoSimulation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present,
the FMU is based on "FMI for Co-Simulation" <em><span class="(in other words">and</span> the simulation engine,
or a communication to a tool that provides the model and the simulation engine,
and the environment provides the master algorithm to run coupled FMU co-simulation slaves together)]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UnitDefinitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of unit and display unit definitions <em>[for example, to convert display units into the units used in the model equations]</em>.
These definitions are used in the XML element `"ModelVariables`".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TypeDefinitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of type definitions that are utilized in `"ModelVariables`".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LogCategories</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A global list of log categories that can be set to define the log information that is supported from the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultExperiment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Providing default settings for the integrator,
such as stop time and relative tolerance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VendorAnnotations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional data that a vendor might want to store and that other vendors might ignore.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelVariables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The central FMU data structure defining all variables of the FMU that are visible/accessible via the FMU functions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ModelStructure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the structure of the model.
Especially, the ordered lists of all outputs,
all continuous-time states and all initial unknowns (the unknowns during Initialization Mode) must be defined here.
For more details on ModelStructure, see section <a href="#_definition_of_the_model_structure_modelstructure">Section 2.2.8</a>.
Furthermore, the dependency of the unkowns from the knowns can be optionally defined.
<em>[This information can be,
for example, used to compute efficiently a sparse Jacobian for simulation, or to utilize the input/output dependency in order to detect that in some cases there are actually no algebraic loops when connecting FMUs together]</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At least one element of <code>ModelExchange</code> or <code>CoSimulation</code> must be present to identify the type of the FMU.
If both elements are defined, different types of models are included in the FMU.
The details of these elements are defined in section 3.3.1 and section 4.3.1.</p>
</div>
<div class="paragraph">
<p>The XML attributes of <code>fmiModelDescription</code> are:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/fmiModelDescription_schema_2.png" alt="fmiModelDescription schema 2" width="80%"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute-Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmiVersion</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version of "FMI for Model Exchange or Co-Simulation" that was used to generate the XML file.
The value for this version is "2.0".<br>
<em>[Clarification for FMI 2.0.1: The version string for FMUs generated according to FMI 2.0.1 shall be “2.0” to be compatible with FMI 2.0 importers.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the model as used in the modeling environment that generated the XML file,
such as "Modelica.Mechanics.Rotational.Examples.CoupledClutches".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>guid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The "Globally Unique IDentifier" is a string that is used to check that the XML file is compatible with the C functions of the FMU.
Typically when generating the XML file,
a fingerprint of the "relevant" information is stored as guid and in the generated C function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with a brief description of the model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>author</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional string with the name and organization of the model author.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional version of the model, for example, "1.0".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>copyright</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property copyright for this FMU.<br>
<em>[Example: copyright = "© My Company 2011"]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>license</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional information on the intellectual property licensing
for this FMU.<br>
<em>[Example: license = "BSD license &lt;license text or link to license&gt;"]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional name of the tool that generated the XML file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generationDateAndTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional date and time when the XML file was generated.
The format is a subset of "xs:dateTime" and should be: "YYYY-MM-DDThh:mm:ssZ" (with one "T" between date and time; "Z" characterizes the Zulu time zone,
in other words, Greenwich meantime).<br>
<em>[Example: "2009-12-08T14:33:22Z"]</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>variableNamingConvention</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines whether the variable names in <code>ModelVariables / ScalarVariable / name</code> and in <code>TypeDefinitions / Type / name</code> follow a particular convention.
For the details, see section 2.2.9. Currently standardized are:</p>
<p class="tableblock">- <code>flat</code>: A list of strings (the default).</p>
<p class="tableblock">- <code>structured</code>: Hierarchical names with "." as hierarchy separator,
and with array elements and derivative characterization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numberOfEventIndicators</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The (fixed) number of event indicators for an FMU based on FMI for Model Exchange.<br>
For Co-Simulation, this value is ignored.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[The attribute <code>numberOfContinuousStates</code> available in FMI 1.0 has been removed for FMI 2.0,
since this information can be deduced from the remaining data in the XML file.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_units_unitdefinitions">2.2.2. Definition of Units (UnitDefinitions)</h4>
<div class="paragraph">
<p><em>[In this section, the units of the variables are (optionally) defined.
Unit support is important for technical systems since otherwise it is very easy for errors to occur.
Unit handling is a difficult topic, and there seems to be no method available that is really satisfactory for all applications, such as unit check,
unit conversion, unit propagation or dimensional analysis.
In FMI, a pragmatic approach is used that takes into account that every software system supporting units has potentially its own specific technique to describe and utilize units.
The approach used here is slightly different than FMI 1.0 to reduce the need for standardized string representations.]</em></p>
</div>
<div class="paragraph">
<p>Element "<strong>UnitDefinitions</strong>" of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/UnitDefinitions_schema.png" alt="UnitDefinitions schema">
</div>
</div>
<div class="paragraph">
<p>It consists of zero or more <code>Unit</code> definitions <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup>.
A <code>Unit</code> is defined by its <code>name</code> attribute such as "N.m" or "N*m" or "Nm",
which must be unique with respect to all other defined elements of the <code>UnitDefinitions</code> list.
If a variable is associated with a <code>Unit</code>,
then the value of the variable has to be provided with the <code>fmi2SetXXX</code> functions and is returned by the <code>fmi2GetXXX</code> functions with respect to this <code>Unit</code>.
<em>[The purpose of the name is to uniquely identify a unit and,
for example, use it to display the unit in menus or in plots.
Since there is no standard to represent units in strings,
and there are different ways how this is performed in different tools,
no specific string representation of the unit is required.]</em></p>
</div>
<div class="paragraph">
<p>Optionally, a value given in unit <code>Unit</code> can be converted to a value with respect to unit <code>BaseUnit</code> utilizing the conversion <code>factor</code> and <code>offset</code> attributes:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/BaseUnit_schema.png" alt="BaseUnit schema" width="50%">
</div>
</div>
<div class="paragraph">
<p>Besides <code>factor</code> and <code>offset</code>,
the <code>BaseUnit</code> definition consists of the exponents of the 7 SI base units "kg",
"m", "s", "A", "K", "mol", "cd", and of the exponent of the SI derived unit "rad".
<em>[Depending on the analysis/operation carried out,
the SI derived unit "rad" is or is not utilized, see discussion below.
The additional "rad" base unit helps to handle the often occurring quantities in technical systems that depend on an angle.]</em></p>
</div>
<div class="paragraph">
<p>A value with respect to <code>Unit</code> (abbreviated as "Unit_value") is converted with respect to <code>BaseUnit</code> (abbreviated as "BaseUnit_value") by the equation:</p>
</div>
<div class="paragraph">
<p>BaseUnit_value = <code>factor</code>* Unit_value +  (if <code>relativeQuantity</code> then 0 else <code>offset</code>)<br>
where <code>factor</code> and <code>offset</code> are attributes of the <code>&lt;BaseUnit&gt;</code>, and  <code>relativeQuantity</code> an attribute of the <code>TypeDefinition</code> of a variable.</p>
</div>
<div class="paragraph">
<p><em>[For example, if</em> \(\color{blue}{p_{bar}}\) <em>is a pressure value in unit "bar", and</em> \(\color{blue}{p_{Pa}}\) <em>is the pressure value in <code>BaseUnit</code>, then</em></p>
</div>
<div class="paragraph">
<p>\(\color{blue}{p_{Pa} = 10^5 p_{bar}}\)</p>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.0e5</code> and <code>offset = 0.0</code>.</em></p>
</div>
<div class="paragraph">
<p><em>[In the following table several unit examples are given
(Note that if in column <code>"exponents"</code> the definition "\(\color{blue}{kgm^2 / s^2}\)"
is present, then the attributes of <code>BaseUnit</code> are: `"kg=1, m=2, s=-2`"):</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock"><strong>Quantity</strong></p></td>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock"><strong>Unit.name</strong><br>
(examples)</p></td>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>Unit.BaseUnit</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>exponents</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>factor</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>offset</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Torque</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"N.m"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Energy</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"J"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{kg \cdot m^2 / s^2}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Pressure</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"bar"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\color{blue}{\frac{kg}{m \cdot s^2}}\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0e5</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angle</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"deg"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.01745329251994330 (= pi/180)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"rad/s"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Angular velocity</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"rpm"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.1047197551196598 (=2*pi/60)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Frequency</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"Hz"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rad/s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>6.283185307179586</code><br>
<code>(= 2*pi)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Temperature</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"°F"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>K</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.5555555555555556</code><br>
<code>(= 5/9)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>255.3722222222222</code><br>
<code>(= 273.15-32*5/9)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Per cent by length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"%/m"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1/m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.01</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Parts per million</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"ppm"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0e-6</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"km"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Length</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>"yd"</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.9144</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0.0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Note that "Hz" is typically used as <code>Unit.name</code> for a frequency quantity,
but it can also be used as <code>DisplayUnit</code> for an angular velocity quantity (since `"revolution/s`").]</em></p>
</div>
<div class="paragraph">
<p><em>The <code>BaseUnit</code> definitions can be utilized for different purposes (the following application examples are optional and a tool may also completely ignore the <code>Unit</code> definitions):</em></p>
</div>
<div class="paragraph">
<p><strong>Signal connection check</strong>:</p>
</div>
<div class="paragraph">
<p><em>When two signals v1 and v2 are connected together,
and on at least one of the signals no <code>BaseUnit</code> element is defined,
then the connection equation "v2 = v1" holds (if v1 is an output of an FMU and v2 is an input of another FMU,
with <code>fmi2GetXXX</code> the value of v1 is inquired and used as value for v2 by calling <code>fmi2SetXXX</code>).</em></p>
</div>
<div class="paragraph">
<p><em>When two signals v1 and v2 are connected together,
and for both of them <code>BaseUnit</code> elements are defined,
then they must have identical exponents of their <code>BaseUnit</code>.
If <code>factor</code> and <code>offset</code> are also identical,
again the connection equation "v2 = v1" holds.
If <code>factor</code> and <code>offset</code> are not identical,
the tool may either trigger an error or, if supported, perform a conversion;
in other words, use the connection equation (in this case the <code>relativeQuantity</code> of the <code>TypeDefinition</code>,
see below,
has to be taken into account in order to determine whether <code>offset</code> shall or shall not be utilized):</em></p>
</div>
<div class="paragraph">
<p><code>factor(v1) * v1 + (if relativeQuantity(v1) then 0 else offset(v1)) = factor(v2) * v2 + (if relativeQuantity(v2) then 0 else offset(v2))</code><br>
where <code>relativeQuantity(v1) == relativeQuantity(v2)</code> is required.</p>
</div>
<div class="paragraph">
<p>_As a result,
wrong connections can be detected (for example, connecting a force with an angle signal would trigger an error) and conversions between, say,
US and SI units can be either automatically performed or, if not supported,
an error is triggered as well.</p>
</div>
<div class="paragraph">
<p><em>[Note that this approach is not satisfactory for variables belonging to different quantities that have,
however, the same <code>BaseUnit</code>, such as quantities "Energy" and "Torque",
or "AngularVelocity" and "Frequency".
To handle such cases, quantity definitions have to be taken into account (see <code>TypeDefinitions</code>) and quantity names need to be standardized.]</em></p>
</div>
<div class="paragraph">
<p><em>This approach allows a general treatment of units,
without being forced to standardize the grammar and allowed values for units (for example, in FMI 1.0,
a unit could be defined as "N.m" in one FMU and as "N*m" in another FMU, and a tool would have to reject a connection,
since the units are not identical. In FMI 2.0, the connection would be accepted,
provided both elements have the same <code>BaseUnit</code> definition).</em></p>
</div>
<div class="paragraph">
<p><strong>Dimensional analysis of equations:</strong></p>
</div>
<div class="paragraph">
<p><em>In order to check the validity of equations in a modeling language,
the defined units can be used for dimensional analysis,
by using the <code>BaseUnit</code> definition of the respective unit.
For this purpose, the <code>BaseUnit</code> "rad" has to be treated as "1".
Example:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>J*α = τ → [kg.m2]*[rad/s2] = [kg.m2/s2]). // o.k. ("rad" is treated as "1")
J*α = f → [kg.m2]*[rad/s2] = [kg.m/s2]). // error, since dimensions do not agree</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Unit propagation:</strong></p>
</div>
<div class="paragraph">
<p><em>If unit definitions are missing for signals,
they might be deduced from the equations where the signals are used.
If no unit computation is needed, "rad" is propagated.
If a unit computation is needed and one of the involved units has "rad" as a <code>BaseUnit</code>,
then unit propagation is not possible.
Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>a = b + c, and <code>Unit</code> of c is provided, but not <code>Unit</code> of a and b:</em><br>
<em>The Unit definition of c (in other words, <code>Unit.name</code>, <code>BaseUnit</code>,
<code>DisplayUnit</code>) is also used for a and b.
For example, if BaseUnit(c) = "rad/s", then BaseUnit(a) = BaseUnit(b) = "rad/s".</em></p>
</li>
<li>
<p><em>a = b*c, and <code>Unit</code> of a and of c is provided, but not <code>Unit</code> of b:</em><br>
<em>If "rad" is either part of the <code>BaseUnit</code> of "a" and/or of "c",
then the <code>BaseUnit</code> of b cannot be deduced (otherwise it can be deduced).
Example: If BaseUnit(a)="kg.m/s2" and BaseUnit(c)="m/s2",
then the BaseUnit(b) can be deduced to be "kg".
In such a case <code>Unit.name</code> of b cannot be deduced from the <code>Unit.name</code> of a and c,
and a tool would typically construct the <code>Unit.name</code> of b from the deduced <code>BaseUnit</code>.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally to the unit definition,
optionally a set of display units can be defined that can be utilized for input/output of a value:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/DisplayUnit_schema.png" alt="DisplayUnit schema" width="80%">
</div>
</div>
<div class="paragraph">
<p>A <code>DisplayUnit</code> is defined by <code>name</code>, <code>factor</code> and <code>offset</code>.
The attribute <code>name</code> must be unique with respect to all other <code>names</code> of the <code>DisplayUnit</code> definitions of the same <code>Unit</code> [(different <code>Unit</code> elements may have the same <code>DisplayUnit</code> names)].
A value with respect to Unit (abbreviated as "Unit_value") is converted with respect to <code>DisplayUnit</code> (abbreviated as "DisplayUnit_value") by the equation:</p>
</div>
<div class="paragraph">
<p>DisplayUnit_value = <code>factor</code> * Unit_value + <code>offset</code></p>
</div>
<div class="paragraph">
<p><em>["offset" is, for example, needed for temperature units.]</em></p>
</div>
<div class="paragraph">
<p><em>[For example, if \(\color{blue}{T_K}\) is the temperature value of <code>Unit.name</code> (in "K") and \(\color{blue}{T_F}\) is the temperature value of <code>DisplayUnit</code> (in "°F"),
then</em></p>
</div>
<div class="stemblock">
<div class="content">
\[T_F = (9/5) * (T_K - 273.15) + 32\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, <code>factor = 1.8 (=9/5)</code> and <code>offset = -459.67 (= 32 - 273.15*9/5)</code>.</em></p>
</div>
<div class="paragraph">
<p><em>Both the <code>DisplayUnit.name</code> definitions as well as the <code>Unit.name</code> definitions are used in the <code>ScalarVariable</code> elements.
Example for a definition:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;Unit name="rad/s"&gt;
    &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;DisplayUnit name="deg/s" factor= "57.29577951308232"/&gt;
    &lt;DisplayUnit name="rev/min" factor= "9.549296585513721"/&gt;
&lt;/Unit&gt;
 &lt;Unit name="bar"&gt;
    &lt;BaseUnit kg="1", m="-1", s="-2", factor="1.0e5", offset="0"/&gt;
&lt;/Unit&gt;
 &lt;Unit name="Re"&gt;
    &lt;BaseUnit/&gt;    // unit = "1"
                   //(dimensionless, all exponents of BaseUnit are zero)
 &lt;/Unit&gt;
 &lt;Unit name="Euro/PersonYear"/&gt;  // no mapping to BaseUnit defined</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The schema definition is present in a separate file `"fmi2Unit.xsd`".</p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_types_typedefinitions">2.2.3. Definition of Types (TypeDefinitions)</h4>
<div class="paragraph">
<p>Element <strong>"TypeDefinitions"</strong> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/TypeDefinitions_schema.png" alt="TypeDefinitions schema" width="90%">
</div>
</div>
<div class="paragraph">
<p>This element consists of a set of <code>"SimpleType"</code> definitions according to schema <code>"fmi2SimpleType"</code> in file <code>"fmi2Type.xsd"</code>.
One <code>"SimpleType"</code> has a type <code>"name"</code> and <code>"description"</code> as attributes.
Attribute "name" must be unique with respect to all other elements of the <code>TypeDefinitions</code> list.
Furthermore,
<code>"name"</code> of a <code>"SimpleType"</code> must be different to all <code>"name"</code> attributes of <code>ScalarVariable</code>s <em>[if the same names would be used,
then this would nearly always give problems when importing the FMU in an environment such as Modelica,
where a type name cannot be used as instance name]</em>.
Additionally, one of the elements <code>Real</code>, <code>Integer</code>, <code>Boolean</code>, <code>String</code>,
or <code>Enumeration</code> must be present.
They have the following definitions:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Real_schema.png" alt="Real schema" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Integer_schema.png" alt="Integer schema" width="50%">
</div>
</div>
<div class="paragraph">
<p><em>[The attributes of "Real" and "Integer" are collected in the attribute groups "fmi2RealAttributes" and "fmi2IntegerAttributes" in file "fmi2AttributeGroups.xsd",
since these attributes are reused in the <code>ScalarVariable</code> element definitions below.]</em></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Enumeration_schema.png" alt="Enumeration schema" width="80%">
</div>
</div>
<div class="paragraph">
<p>These definitions are used as default values in element <code>ScalarVariable</code>s
<em>[in order that, say,
the definition of a "Torque" type does not have to be repeated over and over again]</em>.
The attributes and elements have the following meaning:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quantity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical quantity of the variable. <em>[For example, "Angle", or "Energy".
The quantity names are not standardized]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit of the variable defined with <code>UnitDefinitions.Unit.name</code> that is used for the model equations.
<em>[For example, "N.m": in this case a <code>Unit.name = "N.m"</code> must be present under <code>UnitDefinitions</code>.
Note that for variables that are without a unit, the element should not have a <code>unit</code> attribute.
Giving an empty string as a <code>unit</code> attribute specifies a valid unit that needs to be defined among the unit definitions.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">displayUnit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default display unit. The conversion to the <code>"unit"</code> is defined with the
element <code>"&lt;fmiModelDescription&gt;&lt;UnitDefinitions&gt;`".
If the corresponding
`"displayUnit"</code> is not defined under <code>&lt;UnitDefinitions&gt; &lt;Unit&gt; &lt;DisplayUnit&gt;</code>,
then <code>displayUnit</code> is ignored.
It is an error if <code>displayUnit</code> is defined in element <code>Real</code>,
but <code>unit</code> is not, or unit is not defined under <code>&lt;UnitDefinitions&gt;&lt;Unit&gt;</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">relativeQuantity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this attribute is <code>true</code>,
then the <code>"offset"</code> of <code>"BaseUnit"</code> and <code>"displayUnit"</code> must be ignored.
<em>[For example, 10 degree Celsius = 10 Kelvin if <code>"relativeQuantity = true"</code> and not 283.15 Kelvin.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum value of variable (variable value ≥ <code>min</code>).
If not defined, the minimum is the largest negative number that can be represented on the machine.
The <code>min</code> definition is information from the FMU to the environment defining the region in which the FMU is designed to operate,
see also comment after this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value of variable (variable value ≤ <code>max</code>).
If not defined, the maximum is the largest positive number that can be represented on the machine.
The <code>max</code> definition is information from the FMU to the environment defining the region in which the FMU is designed to operate,
see also comment after this table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nominal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nominal value of variable.
If not defined and no other information about the nominal value is available,
then nominal = 1 is assumed.<br>
<em>[The nominal value of a variable can be,
for example, used to determine the absolute tolerance for this variable as needed by numerical algorithms:</em><br>
absoluteTolerance = <code>nominal</code> * <code>tolerance</code> * 0.01<br>
<em>where <code>tolerance</code> is, for example, the relative tolerance defined in <code>&lt;DefaultExperiment&gt;</code>,
see section 2.2.5.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unbounded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true,
indicates that during time integration, the variable gets a value much larger than its nominal value <code>nominal</code>.
<em>[Typical examples are the monotonically increasing rotation angles of crank shafts and the longitudinal position of a vehicle along the track in long distance simulations.
This information can, for example,
be used to increase numerical stability and accuracy by setting the corresponding bound for the relative error to zero (relative tolerance = 0.0),
if the corresponding variable or an alias of it is a continuous state variable.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Item of an enumeration has a sequence of <code>"name"</code> and <code>"value"</code> pairs.
The values can be any integer number
but must be unique within the same enumeration (in order that the mapping between <code>"name"</code> and <code>"value"</code> is bijective).
An <code>Enumeration</code> element must have at least one Item.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Attributes <code>min</code> and <code>max</code> can be set for variables of type Real, Integer or Enumeration.
The question is how <code>fmi2SetReal</code>, <code>fmi2SetInteger</code>, <code>fmi2GetReal</code>,
<code>fmi2GetInteger</code> shall utilize this definition.
There are several conflicting requirements:</em><br>
<em>Avoiding forbidden regions
(for example, if "u" is an input and "sqrt(u)" is computed in the FMU,
min=0 on "u" shall guarantee that only values of "u" in the allowed regions are provided).</em>
<em>Numerical algorithms
(ODE-solver, optimizers. nonlinear solvers) do not guarantee constraints.
If a variable is outside of the bounds, the solver tries to bring it back into the bounds.
As a consequence,
calling fmi2GetReal during an iteration of such a solver might return values that are not in the defined min/max region.
After the iteration is finalized,
it is only guaranteed that a value is within its bounds up to a certain numerical precision.</em><br>
<em>In debug mode checks on min/max should be performed.
For maximum performance on a real-time system the checks might not be performed.</em><br>
<em>The approach in FMI is therefore that min/max definitions are an information from the FMU to the environment defining the region in which the FMU is designed to operate.
The environment is free to utilize this information
(typically, in debug mode of the environment the min/max is checked in the cases as stated above).
In any case,
it is expected that the FMU handles variables appropriately where the region definition is critical.
For example,
dividing by an input (so the input should not be in a small range of zero) or taking the square root of an input (so the input should not be negative) may either result in fmi2Error,
or the FMU is able to handle this situation in other ways.</em></p>
</div>
<div class="paragraph">
<p><em>If the FMU is generated so that min/max shall be checked whenever meaningful
(for example, for debug purposes), then the following strategy should be used:</em></p>
</div>
<div class="paragraph">
<p><em>If <code>fmi2SetReal</code> or <code>fmi2SetInteger</code> is called violating the min/max attribute settings of the corresponding variable,
the following actions are performed:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>On a fixed or tunable parameter <code>fmi2Status = fmi2Discard</code> is returned.</em></p>
</li>
<li>
<p><em>On an input, the FMU decides what to return (If no computation is possible,
it could return <code>fmi2Status =  fmi2Discard</code>,
in other situations it may return <code>fmi2Warning</code> or <code>fmi2Error</code>,
or <code>fmi2OK</code>, if it is uncritical).</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>If an FMU defines min/max values for Integer and Enumerations (local and output variables),
then the expected behavior of the FMU is that <code>fmi2GetInteger</code> returns values in the defined range.</em></p>
</div>
<div class="paragraph">
<p><em>If an FMU defines min/max values for Reals,
then the expected behavior of the FMU is that <code>fmi2GetReal</code> returns values at the solution (accepted steps of the integrators) in the defined range with a certain uncertainty related to the tolerances of the numerical algorithms.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_log_categories_logcategories">2.2.4. Definition of Log Categories (LogCategories)</h4>
<div class="paragraph">
<p>Element <code>"LogCategories"</code> of <code>"fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/LogCategories_schema.png" alt="LogCategories schema" width="70%">
</div>
</div>
<div class="paragraph">
<p><code>LogCategories</code> defines an unordered set of category strings that can be utilized to define the log output via function <code>"logger"</code>, see section 2.1.5.
A tool is free to use any <code>normalizedString</code> for a category value.
The <code>"name"</code> attribute of <code>"Category"</code> must be unique with respect to all other elements of the <code>LogCategories</code> list.</p>
</div>
<div class="paragraph">
<p>There are the following standardized names for <code>"Category"</code> and these names should be used if a tool supports the corresponding log category.
If a tool supports one of these log categories and wants to expose it,
then an element Category with this name should be added to <code>LogCategories</code> <em>[To be clear, only the Category names listed under <code>LogCategories</code> in the XML file are known to the environment in which the FMU is called.]</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Category name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all events (during initialization and simulation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logSingularLinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of linear systems of equations if the solution is singular (and the tool picked one solution of the infinitely many solutions).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logNonlinearSystems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the solution of nonlinear systems of equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logDynamicStateSelection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the dynamic selection of states.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusWarning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi2Warning status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusDiscard</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi2Discard status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi2Error status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusFatal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi2Fatal status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logStatusPending</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log messages when returning fmi2Pending status from any function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logAll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log all messages.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The optional attribute <code>description</code> shall contain a description of the respective log category.
<em>[Typically, this string can be shown by a tool if more details for a log category shall be presented.]</em></p>
</div>
<div class="paragraph">
<p><em>[This approach to define <code>LogCategories</code> has the following advantages:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>A simulation environment can present the possible log categories in a menu and the user can select the desired one (in the FMI 1.0 approach,
there was no easy way for a user to figure out from a given FMU what log categories could be provided).</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>[Note that since element <code>&lt;LogCategories&gt;</code> is optional,
an FMU does not need to expose its log categories.]</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>The log output is drastically reduced,
because via <code>fmi2SetDebugLogging</code> exactly the categories are set that shall be logged and therefore the FMU only has to print the messages with the corresponding categories to the <code>"logger"</code> function.
In FMI 1.0, it was necessary to provide all log output of the FMU to the <code>"logger"</code> and then a filter in the <code>"logger"</code> could select what to show to the end-user.
The approach introduced in FMI 2.0 is therefore much more efficient.]</em></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_a_default_experiment_defaultexperiment">2.2.5. Definition of a Default Experiment (DefaultExperiment)</h4>
<div class="paragraph">
<p>Element <code>"DefaultExperiment"</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/DefaultExperiment_schema.png" alt="DefaultExperiment schema" width="70%">
</div>
</div>
<div class="paragraph">
<p><code>DefaultExperiment</code> consists of the optional default start time,
stop time, relative tolerance, and step size for the first simulation run.
A tool may ignore this information.
However, it is convenient for a user that <code>startTime</code>, <code>stopTime</code>,
<code>tolerance</code> and <code>stepSize</code> have already a meaningful default value for the model at hand.
Furthermore, for CoSimulation the <code>stepSize</code> defines the preferred <code>communicationStepSize</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_vendor_annotations_vendorannotations">2.2.6. Definition of Vendor Annotations (VendorAnnotations)</h4>
<div class="paragraph">
<p>Element <code>"VendorAnnotations"</code> of <code>fmiModelDescription</code> is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/VendorAnnotations_schema.png" alt="VendorAnnotations schema" width="80%">
</div>
</div>
<div class="paragraph">
<p><code>VendorAnnotations</code> consist of an ordered set of annotations that are identified by the name of the tool that can interpret the <code>"any"</code> element.
The <code>"any"</code> element can be an arbitrary XML data structure defined by the tool.
Attribute <code>"name"</code> must be unique with respect to all other elements of the <code>VendorAnnotation</code> list.</p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_model_variables_modelvariables">2.2.7. Definition of Model Variables (ModelVariables)</h4>
<div class="paragraph">
<p>The <code>"ModelVariables"</code> element of <code>fmiModelDescription</code> is the central part of the model description.
It provides the static information of all exposed variables and is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ModelVariables_schema.png" alt="ModelVariables schema" width="100%">
</div>
</div>
<div class="paragraph">
<p>The <code>"ModelVariables"</code> element consists of an ordered set of <code>ScalarVariable</code> elements (see figure above).
The first element has <code>index = 1</code>,
the second <code>index=2</code>, etc.
This <code>ScalarVariable</code> <code>index</code> is used in element <code>ModelStructure</code> to uniquely and efficiently refer to <code>ScalarVariable</code> definitions.
A <code>ScalarVariable</code> represents a variable of primitive type, like a real or integer variable.
For simplicity,
only scalar variables are supported in the schema file in this version and structured entities (like arrays or records) have to be mapped to scalars.
The schema definition is present in a separate file <code>fmi2ScalarVariable.xsd</code>.
The attributes of <code>ScalarVariable</code> are:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ScalarVariable_schema.png" alt="ScalarVariable schema" width="90%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full, <span class="underline">unique name</span> of the variable.
Every variable is uniquely identified within an FMU instance by this name or by its <code>ScalarVariable index</code> (the element position in the <code>ModelVariables</code> list; the first list element has <code>index=1</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueReference</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A handle of the variable to efficiently identify the variable value in the model interface.
This handle is a secret of the tool that generated the C functions.
It is not required to be unique.
The only guarantee is that valueReference is sufficient to identify the respective variable value in the call of the C functions.
This implies that it is unique for a particular base data type
(<code>Real</code>, <code>Integer/Enumeration</code>, <code>Boolean</code>, <code>String</code>)
with exception of variables that have identical values (such variables are also called "alias" variables).
This attribute is "required".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional description string describing the meaning of the variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>causality</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumeration that defines the causality of the variable.
Allowed values of this enumeration:</p>
<p class="tableblock">- <code>"parameter"</code>: Independent parameter (a data value that is constant during the simulation and is provided by the environment and cannot be used in connections).
<code>variability</code> must be <code>"fixed"</code> or <code>"tunable"</code>.
<code>initial</code> must be <code>exact</code> or not present (meaning <code>exact</code>).</p>
<p class="tableblock">- <code>"calculatedParameter"</code>: A data value that is constant during the simulation and is computed during initialization or when tunable parameters change.
<code>variability</code> must be <code>"fixed"</code> or <code>"tunable"</code>.
initial must be <code>"approx"</code>, <code>"calculated"</code> or not present (meaning <code>calculated</code>).</p>
<p class="tableblock">- <code>"input"</code>: The variable value can be provided from another model or slave.
It is not allowed to define <code>initial</code>.</p>
<p class="tableblock">- <code>"output"</code>: The variable value can be used by another model or slave.
The algebraic relationship to the inputs is defined via the <code>dependencies</code> attribute of <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;&lt;Outputs&gt;&lt;Unknown&gt;</code>.</p>
<p class="tableblock">- <code>"local"</code>: Local variable that is calculated from other variables or is a continuous-time state (see section 2.2.8).
It is not allowed to use the variable value in another model or slave.</p>
<p class="tableblock">- <code>"independent"</code>: The independent variable (usually <code>"time"</code>).
All variables are a function of this independent variable.
<code>variability</code> must be <code>"continuous"</code>.
At most one <code>ScalarVariable</code> of an FMU can be defined as <code>"independent"</code>.
If no variable is defined as <code>"independent"</code>,
it is implicitly present with name = <code>"time"</code> and <code>unit = "s"</code>.
If one variable is defined as <code>"independent"</code>,
it must be defined as <code>"Real"</code> without a <code>"start"</code> attribute.
It is not allowed to call function <code>fmi2SetReal</code> on an <code>"independent"</code> variable.
Instead, its value is initialized with <code>fmi2SetupExperiment</code> and after initialization set by <code>fmi2SetTime</code> for ModelExchange and by arguments <code>currentCommunicationPoint</code> and <code>communicationStepSize</code> of <code>fmi2DoStep</code> for CoSimulation.
<em>[The actual value can be inquired with <code>fmi2GetReal</code>.]</em></p>
<p class="tableblock">The default of causality is <code>"local"</code>.<br>
A continuous-time state must have <code>causality = "local"</code> or <code>"output"</code>, see also section 2.2.8.</p>
<p class="tableblock"><em>[<code>causality = "calculatedParameter"</code> and <code>causality = "local"</code> with <code>variability = "fixed"</code> or <code>"tunable"</code> are similar.
The difference is that a <code>calculatedParameter</code> can be used in another model or slave,
whereas a local variable cannot.
For example, when importing an FMU in a Modelica environment,
a <code>"calculatedParameter"</code> should be imported in a <code>public</code> section as <code>final parameter</code>,
whereas a <code>"local"</code> variable should be imported in a <code>protected</code> section of the model.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>variability</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumeration that defines the time dependency of the variable,
in other words, it defines the time instants when a variable can change its value.
<em>[The purpose of this attribute is to define when a result value needs to be inquired and to be stored.
For example, discrete variables change their values only at event instants (ModelExchange) or at a communication point (CoSimulation) and it is therefore only necessary to inquire them with <code>fmi2GetXXX</code> and store them at event times.]</em>
Allowed values of this enumeration:</p>
<p class="tableblock">- <code>"constant"</code>: The value of the variable never changes.</p>
<p class="tableblock">- <code>"fixed"</code>: The value of the variable is fixed after initialization,
in other words, after <code>fmi2ExitInitializationMode</code> was called the variable value does not change anymore.</p>
<p class="tableblock">- <code>"tunable"</code>: The value of the variable is constant between <code>external events</code> (ModelExchange) and between <em>Communication Points</em> (Co-Simulation) due to changing variables with <code>causality = "parameter"</code> or <code>"input"</code> and <code>variability = "tunable"</code>.
Whenever a parameter or input signal with <code>variability = "tunable"</code> changes,
an event is triggered externally (ModelExchange), or the change is performed at the next <em>Communication Point</em> (Co-Simulation) and the variables with <code>variability = "tunable"</code> and <code>causality = "calculatedParameter"</code> or <code>"output"</code> must be newly computed.</p>
<p class="tableblock">- <code>"discrete"</code>:<br>
ModelExchange: The value of the variable is constant between <em>external</em> and <em>internal events</em> (= time,
state, step events defined implicitly in the FMU).<br>
Co-Simulation: By convention, the variable is from a "real" sampled data system and its value is only changed at Communication Points (also inside the slave).</p>
<p class="tableblock">- <code>"continuous"</code>: Only a variable of <code>type = "Real"</code> can be <code>"continuous"</code>.<br>
ModelExchange: No restrictions on value changes.<br>
Co-Simulation: By convention, the variable is from a differential</p>
<p class="tableblock">The default is <code>"continuous"</code>.</p>
<p class="tableblock"><em>[Note that the information about continuous states is defined with element
<code>fmiModelDescription.ModelStructure.Derivatives</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initial</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enumeration that defines how the variable is initialized.
It is not allowed to provide a value for <code>initial</code> if <code>causality = "input"</code> or <code>"independent"</code>:</p>
<p class="tableblock">- = <code>"exact"</code>: The variable is initialized with the start value (provided under <code>Real</code>,
<code>Integer</code>, <code>Boolean</code>, <code>String</code> or <code>Enumeration</code>).</p>
<p class="tableblock">- = <code>"approx"</code>: The variable is an iteration variable of an algebraic loop and the iteration at initialization starts with the start value.</p>
<p class="tableblock">- = <code>"calculated"</code>: The variable is calculated from other variables during initialization.
It is not allowed to provide a <code>"start"</code> value.</p>
<p class="tableblock">If <code>"initial"</code> is not present,
it is defined by the table below based on <code>"causality"</code> and <code>"variability"</code>.
If <code>initial = "exact"</code> or <code>"approx"</code>, or <code>causality = "input"</code>, a start value must be provided.
If <code>initial = "calculated"</code>,
or <code>causality = "independent"</code>, it is not allowed to provide a start value.</p>
<p class="tableblock"><em>[The environment decides when to use the start value of a variable with <code>causality = "input"</code>.
Examples: (a) automatic tests of FMUs are performed,
and the FMU is tested by providing the start value as constant input.
(b) For a ModelExchange FMU, the FMU might be part of an algebraic loop.
If the input variable is iteration variable of this algebraic loop,
then initialization starts with its start value.]</em></p>
<p class="tableblock">If <code>fmiSetXXX</code> is not called on a variable with <code>causality = "input"</code>, then the FMU must use the start value as value of this input.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>canHandleMultipleSetPerTimeInstant</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for ModelExchange (if only CoSimulation FMU, this attribute must not be present.
If both ModelExchange and CoSimulation FMU, this attribute is ignored for CoSimulation):<br>
Only for variables with <code>variability = "input"</code>:<br>
If present with <code>value = false</code>, then only one <code>fmi2SetXXX</code> call is allowed at one super dense time instant (model evaluation) on this variable.
That is, this input is not allowed to appear in a (real) algebraic loop requiring multiple calls of <code>fmi2SetXXX</code> on this variable
<em>[for example, due to a Newton iteration]</em>.<br>
<em>[This flag must be set by FMUs where (internal) discrete-time states are directly updated when assigned (xd := f(xd) instead of xd = f(previous(xd)),
and at least one output depends on this input and on discrete states.</em><br>
<em>It is strongly recommended that such an FMU checks the fulfillment of the requirement by itself during run-time,
because an environment might not be able to check it;
usually, there is a generic mechanism to import an FMU in an environment,
but the mechanism to connect FMUs together is unrelated to the import mechanism.
For example,
there is no mechanism in the Modelica language to formulate connection restrictions for C functions (the FMU) called in a Modelica model.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>fmi2SetXXX</strong> can be called on any variable with <code>variability ≠ "constant"</code> <strong>before initialization</strong> (before calling <code>fmi2EnterInitializationMode</code>)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>initial = "exact"</code> or <code>"approx"</code> <em>[in order to set the corresponding <code>start</code> value.]</em>
<em>[Note that this prevents any changes to the input before <code>fmi2EnterInitializationMode</code> is called.]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi2SetXXX</strong> can be called on any variable with <code>variability ≠ "constant"</code> <strong>during initialization</strong> (after calling <code>fmi2EnterInitializationMode</code> and before <code>fmi2ExitInitializationMode</code> is called)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>initial = "exact"</code> <em>[in order to set the corresponding <code>start</code> value]</em>, or</p>
</li>
<li>
<p>if <code>causality = "input"</code> <em>[in order to provide new values for inputs]</em>,</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi2SetXXX</strong> can be called on any variable <strong>for ModelExchange</strong> <strong>at an event instant</strong> (after calling <code>fmi2EnterEventMode</code> and before <code>fmi2EnterContinuousTimeMode</code> is called),
and <strong>for Co-Simulation at every communication point</strong>,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>causality = "parameter"</code> and <code>variability = "tunable"</code> <em>[in order to change the value of the tunable parameter at an event instant or at a communication point]</em>, or</p>
</li>
<li>
<p>if causality = "input" <em>[in order to provide new values for inputs]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>fmi2SetXXX</strong> can be called on any variable for <strong>ModelExchange in Continuous-Time Mode</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>if <code>causality = "input"</code> and <code>variability = "continuous"</code><br>
<em>[in order to provide new values for inputs during continuous integration]</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>initial</code> is not present, its value is defined by the following tables
based on the values of <code>causality</code> and <code>variability</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3" rowspan="2"></td>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong>causality</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>parameter</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>calculated</strong> <strong>parameter</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>input</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>output</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>local</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>independent</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="5"><p class="tableblock"><strong>variability</strong></p></td>
<td class="tableblock halign-center valign-top" rowspan="3"><p class="tableblock">data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>constant</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>fixed</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>tunable</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">signals</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>discrete</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>continuous</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="purple">(E)</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>with</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>initial</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>default</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>possible values</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">(A)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">exact</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="green">exact</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">(B)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">calculated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="maroon">approx,</span><br>
 <span class="maroon">calculated</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(C)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exact,<br>
approx,<br>
calculated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">(D)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">---</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="aqua">---</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">(E)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">---</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="purple">---</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Note: (1) If <code>causality = "independent"</code>,
it is neither allowed to define a value for <code>initial</code> nor a value for start.
(2) If <code>causality = "input"</code>,
it is not allowed to define a value for <code>initial</code> and a value for start must be defined.
(3) If (C) and <code>initial = "exact"</code>,
then the variable is explicitly defined by its start value in Initialization Mode (so directly after calling <code>fmi2ExitInitializationMode</code>,
the value of the variable is either the start value stored in element <code>&lt;ScalarVariable&gt;&lt;XXX start=YYY/&gt;</code>
or the value provided by <code>fmiSetXXX</code>,
if this function was called on this variable).]</em></p>
</div>
<div class="paragraph">
<p>The following combinations of variability/causality settings are allowed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3" rowspan="2"></td>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong>causality</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>parameter</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>calculated</strong> <strong>parameter</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>input</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>output</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>local</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>independent</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="5"><p class="tableblock"><strong>variability</strong></p></td>
<td class="tableblock halign-center valign-top" rowspan="3"><p class="tableblock">data</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>constant</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (a)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(7)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(10)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>fixed</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(1)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(3)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (d)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (e)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(11)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>tunable</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(2)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(4)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (d)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (e)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(12)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (c)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">signals</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>discrete</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(5)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(8)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(13)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">--(c)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>continuous</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="red">-- (b)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(6)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(9)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(14)</span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="green">(15)</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Discussion of the combinations that are <span class="underline">not allowed</span></em>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Explanation why this combination is not allowed</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(a)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <code>"constant" / "parameter"</code>,
<code>"constant" / "calculatedParameter"</code> and <code>"constant" / "input"</code> do not make sense,
since parameters and inputs are set from the environment,
whereas a constant has always a value.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(b)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>The combinations <code>"discrete / parameter"</code>,
<code>"discrete / calculatedParameter"</code>,
<code>"continuous / parameter"</code> and <code>"continuous" / "calculatedParameter"</code> do not make sense,
since <code>causality = "parameter"</code> and <code>"calculatedParameter"</code> define variables that do not depend on time,
whereas <code>"discrete"</code> and <code>"continuous"</code> define variables where the values can change during simulation.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(c)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>For an <code>"independent"</code> variable only <code>variability = "continuous"</code> makes sense.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(d)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <code>"fixed"</code> or <code>"tunable"</code> input has exactly the same properties as a <code>"fixed"</code> or <code>"tunable"</code> parameter.
For simplicity, only <code>"fixed"</code> and <code>"tunable"</code> parameters shall be defined.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em><span class="red">(e)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>A <code>"fixed"</code> or <code>"tunable"</code> output has exactly the same properties as a <code>"fixed"</code> or <code>"tunable"</code> <code>calculatedParameter</code>.
For simplicity, only <code>"fixed"</code> and <code>"tunable"</code> <code>calculatedParameters</code> shall be defined.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>Discussion of the combinations that are</em> <span class="underline">allowed</span>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 25%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><em>Setting</em></th>
<th class="tableblock halign-left valign-top"><em>Example</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(1)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fixed parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-tunable independent parameter</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(2)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tunable parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Tunable independent parameter (changing such a parameter triggers an external event (ModelExchange) or takes effect at the next Communication Point (CoSimulation),
and tunable calculatedParameter/output/local variables might change their values).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(3)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fixed dependent parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Non-tunable dependent parameter (variable that is computed directly or indirectly from constants or parameters).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(4)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tunable dependent parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Tunable dependent parameter (changing an independent parameter triggers an external event (ModelExchange) or takes effect at the next Communication Point (CoSimulation),
and tunable dependent parameters and tunable local variables might change their values).</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(5)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>discrete input</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Discrete input variable from another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(6)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous input</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Continuous input variable from another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(7)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>constant output</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes and that can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(8)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>discrete output</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Discrete variable that is computed in the FMU.
Can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(9)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous output</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Continuous variable that is computed in the FMU and can be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(10)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>constant local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Variable where the value never changes.
Cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(11)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fixed local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on fixed parameters only and is computed in the FMU.
Cannot be used in another model.
After initialization, the value of this local variable cannot change.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(12)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>tunable local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Local variable that depends on tunable parameters only and is computed in the FMU.
Cannot be used in another model.
The value of this local variable can only change during initialization and at event instants,
provided a tunable parameter was changed.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(13)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>discrete local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Discrete variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(14)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous local</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Continuous variable that is computed in the FMU and cannot be used in another model.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em><span class="green">(15)</span></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>continuous independent</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>All variables are a function of the continuous-time variable marked as <code>"independent"</code>.
Usually, this is `"time"`</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>How to treat tunable variables:</em></p>
</div>
<div class="paragraph">
<p><em>A parameter p is a variable that does not change its value during simulation,
in other words, dp/dt = 0.
If the parameter "p" is changing,
then Dirac impulses are introduced since dp/dt of a discontinuous constant variable "p" is a Dirac impulse.
Even if this Dirac impulse would be modeled correctly by the modeling environment,
it would introduce unwanted "vibrations".
Furthermore,
in many cases the model equations are derived under the assumption of a constant value (like mass or capacity),
and the model equations would be different if "p" would be time varying.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Model Exchange:</em><br>
<em>Therefore,
"tuning a parameter" during simulation does not mean to "change the parameter online" during simulation.
Instead, this is a short hand notation for:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Stop the simulation at an event instant</em>
(usually, a step event, in other words, after a successful integration step).</p>
</li>
<li>
<p><em>Change the values of the tunable parameters.</em></p>
</li>
<li>
<p><em>Compute all parameters that depend on the tunable parameters.</em></p>
</li>
<li>
<p><em>Newly start the simulation using as initial values the current values of all previous variables and the new values of the parameters.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Basically this means that a new simulation run is started from the previous FMU state with changed parameter values.
With this interpretation, changing parameters online is "clean",
as long as these changes appear at an event instant.</em></p>
</div>
<div class="paragraph">
<p><em>FMI for Co-Simulation:</em>
<em>Changing of tunable parameters is allowed before an <code>fmi2DoStep</code> call (so, whenever an input can be set with <code>fmi2SetXXX</code>) and before <code>fmi2ExitInitializationMode</code> is called (that is before and during Initialization Mode).
The FMU internally carries out event handling if necessary.]</em></p>
</div>
<div class="paragraph">
<p>Variables of the same base type (like <code>fmi2Real</code>) that have identical <code>valueReference</code> definitions are called "alias" variables.
The main purpose of "alias" variables is to enhance efficiency.
If two variables <code>a</code> and <code>b</code> are alias variables,
then this is only allowed if the behavior of the FMU would be exactly the same
if <code>a</code> and <code>b</code> were not treated as alias variables (that is,
had different <code>valueReference</code>s).
This requirement leads naturally to the following restrictions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Variables <code>a</code> and <code>b</code> that can both be set with <code>fmi2SetXXX</code>,
or variable <code>a</code> that can be set with <code>fmiSetXXX</code> and variable <code>b</code> that is defined with <code>causality = "independent"</code>,
cannot be alias variables [since these variables are <code>"independent"</code> variables and alias means that there is a constraint equation between variables (= the values are the same),
these variables are no longer <code>"independent"</code>.<br>
For example, if variables <code>a</code> and <code>b</code> have <code>causality = "parameter"</code>,
then the value references of <code>a</code> and <code>b</code> must be different.
However, if variable a has <code>causality = "parameter"</code> and <code>b</code> has <code>causality = "calculatedParameter"</code> and <code>b := a</code>,
then <code>a</code> and <code>b</code> can have the same value reference.].</p>
</li>
<li>
<p>At most one variable of the same alias set of variables with <code>variability ≠ "constant"</code> can have a start attribute.</p>
</li>
<li>
<p>A variable with <code>variability = "constant"</code> can only be aliased to another variable with <code>variability = "constant"</code>.
It is then required that the start values of all aliased (constant) variables are identical.</p>
</li>
<li>
<p>All variables of the same alias set must all have either no <code>&lt;Unit&gt;</code> element defined, or all of them must have the same <code>&lt;Unit name&gt;</code> and the same <code>&lt;Unit&gt;&lt;BaseUnit&gt;</code> definitions.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The aliasing of variables only means that the <code>"value"</code> of the variables is always identical.
However, aliased variables may have different attributes,
such as <code>min/max/nominal</code> values or description texts.
<em>[For example, if v1, v2 are two alias variables with <code>v1=v2</code> and <code>v1.max=10</code> and <code>v2.max=5</code>,
then the FMU will trigger an error if either <code>v1</code> or <code>v2</code> becomes larger than 5.]</em></p>
</div>
<div class="paragraph">
<p><em>[The dependency definition in <code>fmiModelDescription.ModelStructure</code> is completely unrelated to the alias definition.
In particular,
the "direct dependency" definition can be a superset of the "real" direct dependency definition,
even if the "alias" information shows that this is too conservative.
For example, if it is stated that the output <code>y1</code> depends on input <code>u1</code> and the output <code>y2</code> depends on input <code>u2</code>,
and <code>y1</code> is an alias to <code>y2</code>, then this definition is fine,
although it can be deduced that in reality neither <code>y1</code> nor <code>y2</code> depend on any input.].</em></p>
</div>
<div class="paragraph">
<p><em>[In case of different variability among the set of alias variables,
and if that set of aliases does not contain an input or parameter,
the variability should be the highest of the variables in the set, e.g. continuous &gt; discrete &gt; tunable &gt;fixed.
If the set includes a parameter or input the aliases will have the stated variability of that parameter or input].</em></p>
</div>
<div class="paragraph">
<p>Type specific properties are defined in the required choice element,
where exactly one of <code>"Real"</code>, <code>"Integer"</code>, <code>"Boolean"</code>, <code>"String"</code>,
<code>"Enumeration"</code> must be present in the XML file:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Real_Schema_large.png" alt="Real Schema large" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Integer_Schema_large.png" alt="Integer Schema large" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Boolean_Schema_large.png" alt="Boolean Schema large" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/String_Schema_large.png" alt="String Schema large" width="50%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Enumeration_Schema_large.png" alt="Enumeration Schema large" width="50%">
</div>
</div>
<div class="paragraph">
<p>The attributes are defined in section 2.2.3 ("`TypeDefinitions"`), except:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>declaredType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, name of type defined with <code>TypeDefinitions / SimpleType</code>.
The value defined in the corresponding <code>TypeDefinition</code> (see section 2.2.3) is used as default.
<em>[For example, if <code>min</code> is present both in <code>Real</code> (of <code>TypeDefinition</code>) and in <code>"Real"</code> (of <code>ScalarVariable</code>),
then the <code>min</code> of <code>ScalarVariable</code> is actually used.]</em>
For <code>Real</code>, <code>Integer</code>, <code>Boolean</code>, <code>String</code>, this attribute is optional.
For <code>Enumeration</code> it is required,
because the Enumeration items are defined in <code>TypeDefinitions / SimpleType</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial or guess value of variable.
<strong>This value is also stored in the C functions</strong>.</p>
<p class="tableblock"><em>[Therefore, calling <code>fmi2SetXXX</code> to set start values is only necessary, if a different value as stored
in the xml file is desired.
WARNING: It is not recommended to change the start values in the modelDescription.xml file of an FMU, as this would break the consistency with the hard-coded start values in the C-Code.
This could lead to unpredictable behaviour of the FMU in different importing tools, as it is not mandatory to call <code>fmi2SetXXX</code> to set start values during initialization. Instead it is recommended to use the SSP Standard (<a href="https://ssp-standard.org/" class="bare">https://ssp-standard.org/</a>) to handle modified parameters of FMUs or different parameter sets.]</em></p>
<p class="tableblock">The interpretation of start is defined by <code>ScalarVariable / initial</code>.
A different start value can be provided with an <code>fmi2SetXXX</code> function before <code>fmi2ExitInitializationMode</code> is called (but not for variables with <code>variability = "constant"</code>).</p>
<p class="tableblock"><em>[The standard approach is to set the start value before <code>fmi2EnterInitializationMode</code>.
However, if the initialization shall be modified in the calling environment
(for example, changing from initialization of states to steady-state initialization),
it is also possible to use the start value as iteration variable of an algebraic loop: using an additional condition in the environment,
such as</em> \(\color{blue}{\dot{x} = 0}\) <em>, the actual start value is determined.]</em></p>
<p class="tableblock">If <code>initial = "exact"</code> or <code>"approx"</code> or <code>causality = "input"</code>,
a <code>start</code> value must be provided.</p>
<p class="tableblock">If <code>initial = "calculated"</code> or <code>causality = "independent"</code>,
it is not allowed to provide a start value.</p>
<p class="tableblock">Variables with <code>causality = "parameter"</code> or <code>"input"</code>,
as well as variables with <code>variability = "constant"</code>, must have a <code>"start"</code> value.</p>
<p class="tableblock">- If <code>causality = "parameter"</code>, the start-value is the value of it.</p>
<p class="tableblock">- If <code>causality = "input"</code>, the start value is used by the model as value of the input,
if the input is not set by the environment.</p>
<p class="tableblock">- If <code>variability = "constant"</code>, the start value is the value of the constant.</p>
<p class="tableblock">- If <code>causality = "output"</code> or <code>"local"</code>, then the start value is either an <code>initial</code> or a <code>guess</code> value,
depending on the setting of attribute <code>initial</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>derivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If present, this variable is the derivative of variable with <code>ScalarVariable</code> index "derivative".
<em>[For example,
if there are 10 <code>ScalarVariable</code>s and <code>derivative = 3</code> for <code>ScalarVariable</code> 8,
then <code>ScalarVariable</code> 8 is the derivative of <code>ScalarVariable</code> 3 with respect to the independent variable (usually time).
This information might be especially used if an input or an output is the derivative of another input or output,
or to define the states.]</em></p>
<p class="tableblock">The state derivatives of an FMU are listed under element <code>&lt;ModelStructure&gt;&lt;Derivatives&gt;</code>.
All <code>ScalarVariable</code>s listed in this element must have attribute <code>derivative</code> (in order that the continuous-time states are uniquely defined).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reinit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for ModelExchange (if only CoSimulation FMU,
this attribute must not be present.
If both ModelExchange and CoSimulation FMU,
this attribute is ignored for CoSimulation):<br>
Can only be present for a continuous-time state.<br>
If true, state can be reinitialized at an event by the FMU.<br>
If false, state will not be reinitialized at an event by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min / max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional attributes <code>min</code> and <code>max</code> in element <code>Enumeration</code> restrict the allowed values of the enumeration.
The <code>min/max</code> definitions are information from the FMU to the environment defining the region in which the FMU is designed to operate,
see also comment in section 2.2.3.
<em>[If, for example, an <code>Enumeration</code> is defined with <code>name1 = -4</code>, <code>name2 = 1</code>, <code>name3 = 5</code>,
<code>name4 = 11</code> and min=-2, max = 5, then only <code>name2</code> and <code>name3</code> are allowed.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With element <code>Annotations</code> additional, tool specific data can be defined:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Annotations_schema.png" alt="Annotations schema" width="80%">
</div>
</div>
<div class="paragraph">
<p>With <code>Tool.name</code> the name of the tool is defined that can interpret the <code>any</code> element.
The <code>any</code> element can be an arbitrary XML data structure defined by the tool.
<em>[Typically, additional data is defined here how to build up the menu for the variable,
including the graphical layout and enabling/disabling an input field based on the values of other parameters.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_definition_of_the_model_structure_modelstructure">2.2.8. Definition of the Model Structure (ModelStructure)</h4>
<div class="paragraph">
<p>The structure of the model is defined in element <code>ModelStructure</code> within <code>fmiModelDescription</code>.
This structure is with respect to the underlying model equations,
independently how these model equations are solved.
<em>[For example, when exporting a model both in Model Exchange and Co-Simulation format;
then the model structure is identical in both cases.
The Co-Simulation FMU has either an integrator included that solves the model equations,
or the discretization formula of the integrator and the model equations are solved together ("inline integration").
In both cases the model has the same continuous-time states.
In the second case the internal implementation is a discrete-time system,
but from the outside this is still a continuous-time model that is solved with an integration method.]</em></p>
</div>
<div class="paragraph">
<p>The required part defines an ordering of the outputs and of the (exposed) derivatives,
and defines the unknowns that are available during Initialization
<em>[Therefore, when linearizing an FMU, every tool will use the same ordering for the outputs,
states, and derivatives for the linearized model.
The ordering of the inputs should be performed in this case according to the ordering in <code>ModelVariables</code>.]</em> A ModelExchange FMU must expose all derivatives of its continuous-time states in element <code>Derivatives</code>.
A Co- Simulation FMU does not need to expose these state derivatives.
<em>[If a Co-Simulation FMU exposes its state derivatives,
they are usually not utilized for the co-simulation,
but, for example, to linearize the FMU at a communication point.]</em></p>
</div>
<div class="paragraph">
<p>The optional part defines in which way derivatives and outputs depend on inputs,
and continuous-time states at the current super dense time instant (ModelExchange) or at the current Communication Point (CoSimulation).
<em>[A simulation environment can utilize this information to improve the efficiency,
for example, when connecting FMUs together,
or when computing the partial derivative of the derivatives with respect to the states in the simulation engine.]</em>.</p>
</div>
<div class="paragraph">
<p><code>ModelStructure</code> has the following definition:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ModelStructure_schema.png" alt="ModelStructure schema" width="80%">
</div>
</div>
<div class="paragraph">
<p><code>fmi2VariableDependency</code> is defined as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Unknown_schema.png" alt="Unknown schema" width="80%">
</div>
</div>
<div class="paragraph">
<p>Elements of the <code>InitialUnknowns</code> list:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/InitialUnknowns_schema.png" alt="InitialUnknowns schema" width="50%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Unknown_schema_2.png" alt="Unknown schema 2" width="80%">
</div>
</div>
<div class="paragraph">
<p>Note that attribute <code>dependenciesKind</code> for element <code>InitialUnknowns</code> has less enumeration values as <code>dependenciesKind</code> in the other lists.</p>
</div>
<div class="paragraph">
<p>ModelStructure consists of the following elements (see also figures above; the symbols of the mathematical equations describing the dependency are defined in section 3.1):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Element-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Outputs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered list of all outputs,
in other words, a list of <code>ScalarVariable</code> indices where every corresponding <code>ScalarVariable</code> must have <code>causality = "output"</code> (and <strong>every variable with <code>causality="output"</code> must be listed here</strong>).
<em>[Note that all output variables are listed here,
especially discrete and continuous outputs.
The ordering of the variables in this list is defined by the exporting tool.
Usually, it is best to order according to the declaration order in the source model,
since then the <code>Outputs</code> list does not change
if the declaration order of outputs in the source model is not changed.
This is for example, important for linearization,
in order that the interpretation of the output vector does not change for a re-exported FMU.]</em>
Attribute <code>dependencies</code> defines the dependencies of the outputs from the knowns at the current super dense time instant in <em>Event</em> and in <em>Continuous-Time Mode</em> (ModelExchange) and at the current <em>Communication Point</em> (CoSimulation).
The functional dependency is defined as (dependencies of variables that are fixed in <em>Event</em> and <em>Continuous-Time Mode</em> and at <em>Communication Points</em> are not shown):<br>
<span class="blue">\(\color{blue}{(\mathbf{y}_c, \mathbf{y}_d) := \mathbf{f}_{output}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p}_{tune})}\)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Derivatives</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered list of all state derivatives,
in other words, a list of <code>ScalarVariable</code> <code>indices</code> where every corresponding <code>ScalarVariable</code> must be a state derivative.
<em>[Note that only continuous Real variables are listed here.
If a state or a derivative of a state shall not be exposed from the FMU,
or if states are not statically associated with a variable (due to dynamic state selection),
then dummy <code>ScalarVariable</code>s have to be introduced,
for example, <code>x[4]</code>, or <code>xDynamicStateSet2[5]</code>.
The ordering of the variables in this list is defined by the exporting tool.
Usually,
it is best to order according to the declaration order of the states in the source model,
since then the &lt;Derivatives&gt; list does not change
if the declaration order of states in the source model is not changed.
This is for example, important for linearization,
in order that the interpretation of the state vector does not change for a re-exported FMU.</em>].
The number of Unknown elements in the Derivatives element uniquely defines the number of continuous time state variables,
as required by the corresponding Model Exchange functions (integer argument "nx" of <code>fmi2GetContinuousStates</code>, <code>fmi2SetcontinuousStates</code>, <code>fmi2GetDerivatives</code>, <code>fmi2GetNominalsOfContinuousStates</code> see hereafter) that require it.
The corresponding continuous-time states are defined by attribute <code>derivative</code> of the corresponding <code>ScalarVariable</code> state derivative element.
<em>[Note that higher order derivatives must be mapped to first order derivatives but the mapping definition can be preserved due to attribute <code>derivative</code>.
Example: if</em> \(\color{blue}{\frac{\text{ds}}{\text{dt}} = v,\ \frac{\text{dv}}{\text{dt}} =f(..)}\) <em>,then</em> \(\color{blue}{\left\{ v,\ \frac{\text{dv}}{\text{dt}} \right\}}\) _ is the vector of state derivatives and attribute <code>derivative</code> of_ \(\color{blue}{v}\) <em>references</em> \(\color{blue}{s}\) <em>,
and attribute <code>derivative</code> of</em> \(\color{blue}{\frac{\text{dv}}{\text{dt}}}\) <em>references</em> \(\color{blue}{v}\) <em>.]</em><br>
For Co-Simulation,
element <code>Derivatives</code> is ignored if capability flag <code>providesDirectionalDerivative</code> has a value of <code>false</code>,
in other words, it cannot be computed. <em>[This is the default.
If an FMU supports both ModelExchange and CoSimulation,
then the <code>Derivatives</code> element might be present,
since it is needed for ModelExchange.
If the above flag is set to false for the CoSimulation case,
then the <code>Derivatives</code> element is ignored for CoSimulation.
If "inline integration" is used for a CoSimulation slave,
then the model still has continuous-time states and just a special solver is used (internally the implementation results in a discrete-time system,
but from the outside, it is still a continuous-time system).]</em><br>
Attribute <code>dependencies</code> defines the dependencies of the state derivatives from the knowns at the current super dense time instant in <em>Event</em> and in <em>Continuous-Time Mode</em> (ModelExchange) and at the current <em>Communication Point</em> (CoSimulation).
The functional dependency is defined as (dependencies of variables that are fixed in <em>Event</em> and <em>Continuous-Time Mode</em> and at <em>Communication Points</em> are not shown):<br>
<span class="blue">\(\color{blue}{\dot{\mathbf{x}_c} := \mathbf{f}_{der}(\mathbf{x}_c, \mathbf{u}_c, \mathbf{u}_d, t, \mathbf{p}_{tune})}\)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitialUnknowns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ordered list of all exposed <code>Unknowns</code> in Initialization Mode.
This list
consists of all variables with</p>
<p class="tableblock">1. <code>causality = "output"</code> and (<code>initial = "approx"</code> or <code>"calculated"</code>), and</p>
<p class="tableblock">2. <code>causality = "calculatedParameter"</code> and</p>
<p class="tableblock">3. all continuous-time states and all state derivatives (defined with element <code>&lt;Derivatives&gt;</code> from <code>&lt;ModelStructure&gt;</code>) with <code>initial = "approx"</code> or <code>"calculated"</code> <em>[if a Co-Simulation FMU does not define the &lt;Derivatives&gt; element, (3) cannot be present]</em>.</p>
<p class="tableblock">The resulting list is not allowed to have duplicates
(for example, if a state is also an output, it is included only once in the list).
The <code>Unknowns</code> in this list must be ordered according to their <code>ScalarVariable</code> index
(for example, if for two variables A and B the <code>ScalarVariable</code> index of A is less than the index of B, then A must appear before B in <code>InitialUnknowns</code>).<br>
Attribute <code>dependencies</code> defines the dependencies of the <code>Unknowns</code> from the <code>Knowns</code> in <em>Initialization Mode</em> at the initial time.
The functional dependency is defined as:</p>
<p class="tableblock"><span class="blue">\(\color{blue}{\dot{\mathbf{v}}_{initialUnknowns} := \mathbf{f}_{init}(\mathbf{u}_c, \mathbf{u}_d, t_0, \mathbf{v}_{initial = exact})}\)</span></p>
<p class="tableblock">Since, outputs, continuous-time states and state derivatives are either present as <code>Knowns</code> (if <code>initial = "exact"</code>) or as <code>Unknowns</code> (if <code>initial = "approx"</code> or <code>"calculated"</code>),
they can be inquired with <code>fmiGetXXX</code> in InitializationMode.</p>
<p class="tableblock"><em>[Example: Assume an FMU is defined in the following way:</em></p>
<p class="tableblock">\(\color{blue}{(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{init}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_0, \mathbf{p})}\)<br></p>
<p class="tableblock">\(\color{blue}{(\mathbf{y}_{c+d}, \dot{\mathbf{x}}_c) := \mathbf{f}_{sim}(\mathbf{x}_c, \mathbf{u}_{c+d}, t_i, \mathbf{p})}\)<br></p>
<p class="tableblock"><em>Therefore, the initial state \(\color{blue}{\mathbf{x}_c(t_0)}\)
has <code>initial = "exact"</code> and the initial state derivative
\(\color{blue}{\dot{\mathbf{x}}_c(t_0)}\)
has <code>initial = "calculated"</code>.
The environment can still initialize this FMU in steady-state,
by using
\(\color{blue}{\mathbf{x}_c(t_0)}\)
as iteration variables and adding the equations \(\color{blue}{\mathbf{x}_c(t_0) = \mathbf{0}}\)
in the environment.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Unknown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An element of one of the lists above defining the unknown with a reference to the corresponding <code>ScalarVariable</code> element.
It is assumed that at a super-dense time instant \(\color{blue}{t = (t_R, t_I)}\) (ModelExchange) and at a Communication Point (CoSimulation) the following relationship holds:</p>
<p class="tableblock">\(\color{blue}{v_{unknown} = h(\mathbf{v}_{known}, \mathbf{v}_{freeze})}\)</p>
<p class="tableblock">where</p>
<p class="tableblock">- \(\color{blue}{v_{unknown}}\) is the unknown variable defined with this element <em>[for example, an output or a state derivative].</em></p>
<p class="tableblock">- \(\color{blue}{\mathbf{v}_{known}}\) is the vector of input arguments of function <em>h</em> that changes its value in the actual Mode <em>[for example, continuous-time inputs in Continuous-Time Mode]</em>.</p>
<p class="tableblock">- \(\color{blue}{\mathbf{v}_{freeze}}\) is the set of input arguments of function <em>h</em> that do not change their values in this Mode,
but change their values in other Modes <em>[for example, fixed parameters in Continuous-Time Mode]</em>.</p>
<p class="tableblock">Attribute <code>dependencies</code> of <code>Unknown</code> defines the dependency of \(\color{blue}{v_{unknown}}\) with respect to \(\color{blue}{\mathbf{v}_{known}}\).<br>
<em>[If, for example, a continuous-time output</em> \(\color{blue}{y_{2}}\) <em>is a function of the continuous-time inputs</em> \(\color{blue}{u_{3}}\) <em>and</em> \(\color{blue}{u_{5}}\), <em>and these inputs have changed, then</em> <code>fmi2SetXXX</code> <em>on</em> \(\color{blue}{u_{3}}\) <em>and</em> \(\color{blue}{u_{5}}\) <em>must always be called before calling</em> <code>fmi2GetXXX</code> <em>on</em> \(\color{blue}{y_{2}}\) <em>.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Element <code>Unknown</code> in <code>Outputs</code>,
<code>Derivatives</code> and <code>InitialUnknowns</code> has the following attributes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Attribute-Name</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>ScalarVariable</code> index of the <code>Unknown</code> \(\color{blue}{v_{\text{unknown}}}\).
<em>[For example, if there are 10 <code>ScalarVariable</code>s and index = 3,
then the third <code>ScalarVariable</code> is the unknown defined with this element.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependencies</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional attribute defining the dependencies of the unknown \(\color{blue}{v_{\text{unknown}}}\) (directly or indirectly via auxiliary variables) with respect to \(\color{blue}{\mathbf{v}_{\text{known}}}\).
If not present, it must be assumed that the <code>Unknown</code> depends on all <code>Knowns</code>.
If present as empty list, the <code>Unknown</code> depends on none of the <code>Knowns</code>.
Otherwise the <code>Unknown</code> depends on the <code>Knowns</code> defined by the given <code>ScalarVariable</code> indices.
The indices are ordered according to magnitude, starting with the smallest index.<br>
<code>Knowns</code> \(\color{blue}{\mathbf{v}_{\text{known}}}\) in <em>Event</em> and <em>Continuous-Time Mode</em> (ModelExchange) and at <em>Communication Points</em> (CoSimulation) for elements <code>Outputs</code>, <code>Derivatives</code>:</p>
<p class="tableblock">- inputs (variables with <code>causality = "input"</code>)</p>
<p class="tableblock">- continuous-time states</p>
<p class="tableblock">- independent variable (usually time; <code>causality = "independent"</code>).
If an independent variable is not explicitly defined under <code>ScalarVariable</code>s,
it is assumed that the <code>Unknown</code> depends explicitly on the independent variable.</p>
<p class="tableblock"><code>Knowns</code> \(\color{blue}{\mathbf{v}_{\text{known}}}\) in <em>Initialization Mode</em> (for elements <code>InitialUnknowns</code>):</p>
<p class="tableblock">- inputs (variables with <code>causality = "input"</code>)</p>
<p class="tableblock">- variables with <code>initial = "exact"</code><br>
<em>[for example, independent parameters or initial states.]</em></p>
<p class="tableblock">- independent variable (usually time; <code>causality = "independent"</code>).
If an independent variable is not explicitly defined under <code>ScalarVariable</code>s,
it is assumed that the <code>Unknown</code> depends explicitly on the independent variable.</p>
<p class="tableblock">For Co-Simulation, <code>dependencies</code> does not list the dependency on continuous-time,
if the capability flag <code>providesDirectionalDerivative</code> has a value of <code>"false"</code>.
In other words, the respective partial derivatives cannot be computed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dependenciesKind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If not present,
it must be assumed that the <code>Unknown</code> \(\color{blue}{v_{\text{unknown}}}\) depends on the <code>Knowns</code> \(\color{blue}{\mathbf{v}_{\text{known}}}\) without a particular structure.
Otherwise, the corresponding Known \(\color{blue}{v_{known,i}}\) enters the equation as:</p>
<p class="tableblock">If <code>dependenciesKind</code> is present, <code>dependencies</code> must be present and
must have the same number of list elements.</p>
<p class="tableblock"><code>= "dependent"</code>: no particular structure, \(\color{blue}{{h(..,\ v}_{known,i}}\),..)</p>
<p class="tableblock">Only for Real unknowns \(\color{blue}{v_{\text{unknown}}}\):</p>
<p class="tableblock"><code>= "constant"</code>: constant factor,
\(\color{blue}{c \cdot v_{known,i}}\) where \(\color{blue}{c}\) is an expression that is evaluated before <code>fmi2EnterInitializationMode</code> is called.</p>
<p class="tableblock">Only for Real unknowns \(\color{blue}{v_{\text{unknown}}}\) in Event and Continuous-Time Mode (ModelExchange) and at <em>Communication Points</em> (CoSimulation),
and not for <code>InitialUnknowns</code> for Initialization Mode:</p>
<p class="tableblock"><code>= "fixed"</code>: fixed factor,
\(\color{blue}{p \cdot v_{known,i}}\) where \(\color{blue}{p}\) is an expression that is evaluated before <code>fmi2ExitInitializationMode</code> is called.</p>
<p class="tableblock"><code>= "tunable"</code>: tunable factor,
\(\color{blue}{p \cdot v_{known,i}}\) where \(\color{blue}{p}\) is an expression that is evaluated before <code>fmi2ExitInitializationMode</code> is called and in Event Mode due to an external event (ModelExchange) or at a Communication Point (CoSimulation)</p>
<p class="tableblock"><code>= "discrete"</code>: discrete factor,
\(\color{blue}{d \cdot v_{known,i}}\) where \(\color{blue}{d}\) is an expression that is evaluated before <code>fmi2ExitInitializationMode</code> is called and in Event Mode due to an external or internal event or at a Communication Point (CoSimulation).</p>
<p class="tableblock">If <code>dependenciesKind</code> is present,
<code>dependencies</code> must be present and must have the same number of list elements.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Example 1:</em></p>
</div>
<div class="paragraph">
<p><em>An FMU is defined by the following equations:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}

\frac{d}{\text{dt}}\begin{bmatrix}
x_{1} \\
x_{2} \\
x_{3} \\
\end{bmatrix}

&amp;=

\begin{bmatrix}
f_{1}\left( x_{2} \right) \\
f_{2}\left( x_{1} \right) + 3 \cdot p^{2} \cdot x_{2} + 2 \cdot u_{1} + 3 \cdot u_{3} \\
f_{3}\left( x_{1},x_{3},u_{1},u_{2},u_{3} \right) \\
\end{bmatrix}

\\

y &amp;= g_1(x_2, x_3)

\end{align*},\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u_{1}}\) <em>is a continuous-time input (<code>variability="continuous"</code>),</em> \(\color{blue}{u_{2}}\) <em>is any type of input,</em> \(\color{blue}{u_{3}}\) <em>is a Real discrete-time input (<code>variability="discrete"</code>),
and</em> \(\color{blue}{p}\) <em>is a fixed parameter (<code>variability="fixed"</code>).
The initialization is defined by:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[x_1 = 1.1, \frac{dx_2}{dt} = 0, y = 3.3,\]
</div>
</div>
<div class="paragraph">
<p><em>and therefore, the initialization equations are:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\begin{align*}
x_{2} &amp;= \frac{1}{3 \cdot p^{2}} \cdot ( f_{2}\left( x_{1} \right) + 2 \cdot u_{1} + 3 \cdot u_{3} )
\\
x_{3} &amp;= g_{1}^{- 1}( x_{2}, y)
\end{align*}\]
</div>
</div>
<div class="paragraph">
<p><em>This equation system can be defined as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelVariables&gt;
   &lt;ScalarVariable name="p"       ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="1" --&gt;
   &lt;ScalarVariable name="u1"      ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="2" --&gt;
   &lt;ScalarVariable name="u2"      ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="3" --&gt;
   &lt;ScalarVariable name="u3"      ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="4" --&gt;
   &lt;ScalarVariable name="x1"      ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="5" --&gt;
   &lt;ScalarVariable name="x2"      ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="6" --&gt;
   &lt;ScalarVariable name="x3"      ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="7" --&gt;
   &lt;ScalarVariable name="der(x1)" ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="8" --&gt;
   &lt;ScalarVariable name="der(x2)" ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="9" --&gt;
   &lt;ScalarVariable name="der(x3)" ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="10" --&gt;
   &lt;ScalarVariable name="y"       ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="11" --&gt;
&lt;/ModelVariables&gt;

&lt;ModelStructure&gt;
   &lt;Outputs&gt;
     &lt;Unknown index="11" dependencies="6 7" /&gt;
   &lt;/Outputs&gt;
   &lt;Derivatives&gt;
     &lt;Unknown index="8"  dependencies="6" /&gt;
     &lt;Unknown index="9"  dependencies="2 4 5 6"
                         dependenciesKind="constant constant dependent fixed"/&gt;
     &lt;Unknown index="10" dependencies="2 3 4 5 6" /&gt;
   &lt;/Derivatives&gt;

   &lt;InitialUnknowns&gt;
     &lt;Unknown index="6" dependencies="2 4 5" /&gt;
     &lt;Unknown index="7" dependencies="2 4 5 11" /&gt;
     &lt;Unknown index="8" ... /&gt;
     &lt;Unknown index="10" ... /&gt;
   &lt;/InitialUnknowns&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Example 2:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[y = \left\{ \begin{matrix}
2 \cdot u \ \mathrm{if} \ u &gt; 0 \\
3 \cdot u \ \mathrm{else} \\
\end{matrix}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u}\) <em>is a continuous-time input with index="1" and</em> \(\color{blue}{y}\) <em>is a continuous-time output with index="2".
The definition of the model structure is then:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelStructure&gt;
  &lt;Outputs&gt;
    &lt;Unknown index="2" dependencies="1" dependenciesKind="discrete"/&gt;
  &lt;/Outputs&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>[Note that</em> \(\color{blue}{y = d \cdot u}\) <em>where</em> \(\color{blue}{d}\) <em>changes only during Event Mode (</em>\(\color{blue}{d = 2 \cdot u}\) <em>or</em> \(\color{blue}{3 \cdot u\ }\) <em>depending on relation</em> \(\color{blue}{u &gt; 0}\) <em>that changes only at Event Mode).
Therefore dependenciesKind="discrete".]</em></p>
</div>
<div class="paragraph">
<p><em>Example 3:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[y = \left\{ \begin{matrix}
2\ \ \mathrm{if}\ \ u &gt; 0 \\
3\ \ \mathrm{else} \\
\end{matrix}\right.\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u}\) <em>is a continuous-time input with index="1" and</em> \(\color{blue}{y}\) <em>is a continuous-time output with index="2".
The definition of the model structure is then:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelStructure&gt;
  &lt;Outputs&gt;
    &lt;Unknown index="2" dependencies="1" dependenciesKind="dependent"/&gt;
  &lt;/Outputs&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>[Note that</em> \(\color{blue}{y = c}\) <em>where</em> \(\color{blue}{c}\) <em>changes only during Event Mode (</em>\(\color{blue}{c = 2}\) <em>or</em> \(\color{blue}{3\ }\)<em>depending on relation</em> \(\color{blue}{u &gt; 0}\) <em>that changes only at Event Mode).
Therefore <code>dependenciesKind="dependent"</code> because it is not a linear relationship on</em> \(\color{blue}{u}\).]</p>
</div>
<div class="paragraph">
<p><em>Example 4:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{dx}{dt} = u, y = x\]
</div>
</div>
<div class="paragraph">
<p><em>where</em> \(\color{blue}{u}\) <em>is a continuous-time input with index="1" and</em> \(\color{blue}{y}\) <em>is a continuous-time output with index="2",</em> \(\color{blue}{x}\) <em>is a continuous-time state with index="3"  and</em> \(\color{blue}{\frac{dx}{dt}}\) <em>is a continuous-time derivative with index="4".</em>
The definition of the model structure is then:_</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;ModelVariables&gt;
   &lt;ScalarVariable name="u"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="1" --&gt;
   &lt;ScalarVariable name="y"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="2" --&gt;
   &lt;ScalarVariable name="x"     , ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="3" --&gt;
   &lt;ScalarVariable name="der(x)", ...&gt; … &lt;/ScalarVariable&gt;  &lt;!--index="4" --&gt;
&lt;/ModelVariables&gt;

&lt;ModelStructure&gt;
   &lt;Outputs&gt;
     &lt;Unknown index="2" dependencies="3"  dependenciesKind="constant"/&gt;
   &lt;/Outputs&gt;
   &lt;Derivatives&gt;
     &lt;Unknown index="4"  dependencies="1"  dependenciesKind="constant"/&gt;
   &lt;/Derivatives&gt;

   &lt;InitialUnknowns&gt;
     &lt;Unknown index="2" dependencies="3" /&gt;
     &lt;Unknown index="4" dependencies="1" /&gt;
   &lt;/InitialUnknowns&gt;
&lt;/ModelStructure&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Defining FMU features with the</em> <code>dependencies</code> <em>list:</em></p>
</div>
<div class="paragraph">
<p><em>[Note that via the <code>dependencies</code> list the supported features of the FMU can be defined.
Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>If a state derivative <code>der_x</code> is a function of a parameter p (so of a start value of a variable with <code>causality = "parameter"</code> and <code>variability = "fixed"</code>),
and the FMU does not support an iteration over <code>p</code> during <code>InitializationMode</code>
(for example, to iterate over p such that the state derivative <code>der_x</code> is zero),
then the dependencies list of <code>der_x</code> should not include <code>p</code>.
If an FMU is imported in an environment and such an iteration is set up,
then the tool can figure out that the resulting algebraic system of equations is structurally singular and therefore can reject such a definition.</em></p>
</li>
<li>
<p><em>For standard Co-Simulation FMUs, it is common that no algebraic loops over the input/output variables nor over start-values is supported.
In such a case,
all <code>dependencies</code> lists for output variables under the <code>InitialUnknowns</code> element should be defined as empty lists defining that the setting of inputs and/or of start values does not influence the outputs.
As a result,
it is not possible to formulate algebraic loops of connected FMUs during InitializationMode.]</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_variable_naming_conventions_variablenamingconvention">2.2.9. Variable Naming Conventions (variableNamingConvention)</h4>
<div class="paragraph">
<p>With attribute <code>variableNamingConvention</code> of element <code>fmiModelDescription</code>,
the convention is defined how the <code>ScalarVariable.name</code>s have been constructed.
If this information is known,
the environment may be able to represent the names in a better
way (for example, as a tree and not as a linear list).</p>
</div>
<div class="paragraph">
<p>In the following definitions,
the <a href="http://en.wikipedia.org/wiki/Extended_BNF">EBNF</a> is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=   production rule
[ ] optional
{ } repeat zero or more times
|   or</pre>
</div>
</div>
<div class="paragraph">
<p>The names must be unique, non-empty strings.<br>
<em>[It is recommended that the names are visually clearly different from each other; but it is not required.]</em></p>
</div>
<div class="paragraph">
<p>The following conventions for scalar names are defined:</p>
</div>
<div class="paragraph">
<p><strong><code>variableNamingConvention = "flat"</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>name = Unicode-char { Unicode-char } // identical to xs:normalizedString
Unicode-char = any Unicode character without carriage return (#xD),
line feed (#xA) nor tab (#x9)</pre>
</div>
</div>
<div class="paragraph">
<p><strong><code>variableNamingConvention = "structured"</code></strong></p>
</div>
<div class="paragraph">
<p>Structured names are hierarchical using "." as a separator between hierarchies.
A name consists of "_",
letters and digits or may consist of any characters enclosed in single apostrophes.
A name may identify an array element on every hierarchical level using "[&#8230;&#8203;]" to identify the respective array index.
A derivative of a variable is defined with <code>der(name)</code> for the first time derivative and <code>der(name,N)</code> for the N-th derivative.
Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.engine.speed
resistor12.u
v_min
robot.axis.'motor #234'
der(pipe[3,4].T[14],2) // second time derivative of pipe[3,4].T[14]</pre>
</div>
</div>
<div class="paragraph">
<p>The precise syntax is <sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>name            = identifier | "der(" identifier ["," unsignedInteger ] ")"
identifier      = B-name [ arrayIndices ] {"." B-name [ arrayIndices ] }
B-name          = nondigit { digit | nondigit } | Q-name
nondigit        = "pass:[_]" | letters "a" to "z" | letters "A" to "Z"
digit           = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"
Q-name          = "’" ( Q-char | escape ) { Q-char | escape } "’"
Q-char          = nondigit | digit | "!" | "#" | "$" | "%" | "&amp;" | "(" | ")" |
                                     "*" | "+" | "," | "-" | "." | "/" | ":" |
                                     ";" | "&lt;" | "&gt;" | "=" | "?" | "@" | "[" |
                                     "]" | "^" | "{" | "}" | "|" | "~" | " "
escape          = "\’" | "\"" | "\?" | "\\" | "\a" | "\b" |
                  "\f" | "\n" | "\r" | "\t" | "\v"
arrayIndices    = "[" unsignedInteger {"," unsignedInteger} "]"
unsignedInteger = digit { digit }</pre>
</div>
</div>
<div class="paragraph">
<p><span class="line-through">The tree of names is mapped to an ordered list of <code>ScalarVariable.name</code>s in <a href="http://en.wikipedia.org/wiki/Depth-first_search">depth-first</a> order.</span></p>
</div>
<div class="paragraph">
<p><em>[Clarification for FMI 2.0.1: this constraint has been removed.]</em></p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle
  transmission
    ratio
    outputSpeed
  engine
    inputSpeed
    temperature</pre>
</div>
</div>
<div class="paragraph">
<p>is mapped to the following list of <code>ScalarVariable.name</code>s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vehicle.transmission.ratio
vehicle.transmission.outputSpeed
vehicle.engine.inputSpeed
vehicle.engine.temperature</pre>
</div>
</div>
<div class="paragraph">
<p>All array elements are given in a consecutive sequence of <code>ScalarVariable</code>s.
Elements of multi-dimensional arrays are ordered
according to "row major" order that is elements of the last index are
given in sequence.</p>
</div>
<div class="paragraph">
<p><em>[For example, the vector "centerOfMass" in body "arm1" is mapped to the following <code>ScalarVariable</code>s:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>robot.arm1.centerOfMass[1]
robot.arm1.centerOfMass[2]
robot.arm1.centerOfMass[3]</pre>
</div>
</div>
<div class="paragraph">
<p><em>[For example, a controller might receive 3 rpm sensors mapped to the following variables:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>transmission.rpms[0]
transmission.rpms[1]
transmission.rpms[2]</pre>
</div>
</div>
<div class="paragraph">
<p><em>For example,
a table T[4,3,2] (first dimension 4 entries,
second dimension 3 entries,
third dimension 2 entries) is mapped to the following <code>ScalarVariable</code>s:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>T[1,1,1]
T[1,1,2]
T[1,2,1]
T[1,2,2]
T[1,3,1]
T[1,3,2]
T[2,1,1]
T[2,1,2]
T[2,3,1]
…</pre>
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>It might be that not all elements of an array are present.
If they are present, they are given in consecutive order in the XML file.</p>
</div>
<div class="paragraph">
<p><em>[Clarification for FMI 2.0.2: The <code>variableNamingConvention</code> <code>structured</code> does not define if array indices are 0- or 1-based.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmu_distribution">2.3. FMU Distribution</h3>
<div class="paragraph">
<p>An FMU description consists of several files.
An FMU implementation may be distributed in source code and/or in binary format.
All relevant files are stored in a ZIP file with a pre-defined structure.
The implementation must either implement all the functions of FMI for Model Exchange or all the functions of FMI for Co-Simulation or both.
Specifically it is required that all functions specified for Model Exchange and/or Co-Simulation are present, even if they are only needed for capabilities that the FMU does not support.
The behavior of those functions is unspecified, so while calling environments can rely on the functions being present, they cannot rely on any particular behavior for functions only needed for capabilities the FMU does not support.
The extension of the ZIP file must be "<strong>.fmu</strong>",
for example, "HybridVehicle.fmu".</p>
</div>
<div class="paragraph">
<p>The compression method for all files stored in the ZIP archive must be either 8 (<code>deflate</code>), or 0 (<code>store</code>).
Only files stored using compression method 8 (<code>deflate</code>) may be stored with general purpose bit 3 set.
The field <code>version needed to extract</code> of the archive must not be higher than 2.0, and encryption must not be employed.
The archive may not be a split or spanned ZIP archive.
 <em>[These restrictions ensure broad compatibility of the archive with common ZIP processing tools and libraries.]</em></p>
</div>
<div class="paragraph">
<p>The zip format specification can be found here <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT" class="bare">https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT</a>
<em>[Note especially section 4.4.17 states that backslashes "\" are forbidden as path separator only forward slashes "/" are allowed.]</em></p>
</div>
<div class="paragraph">
<p><em>[Note: non-ASCII directory names are not explicitly forbidden, but might pose a problem on different operating systems and are thus dicouraged.]</em></p>
</div>
<div class="paragraph">
<p>Every FMU is distributed with its own ZIP file.
This ZIP file has the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Structure of ZIP file of an FMU
modelDescription.xml      // Description of FMU (required file)
model.png                 // Optional image file of FMU icon
documentation             // Optional directory containing the FMU documentation
    index.html            // Entry point of the documentation
    externalDependencies.{txt|html}  // documentation of external resources required to load or simulate the FMU
    &lt;other documentation files&gt;
    licenses                    // Optional directory for licenses
        license.{txt,html}      // Entry point for license information
        &lt;license files&gt;         // For example BSD licenses
sources                   // Optional directory containing all C sources
   // all needed C sources and C header files to compile and link the FMU
   // with exception of: fmi2TypesPlatform.h , fmi2FunctionTypes.h and fmi2Functions.h
   // The files to be compiled (but not the files included from these files)
   // have to be reported in the XML file under the structure
   // &lt;ModelExchange&gt;&lt;SourceFiles&gt; ... and &lt;CoSimulation&gt;&lt;SourceFiles&gt;
binaries                     // Optional directory containing the binaries win32 // Optional binaries for 32-bit Windows
   win32                     // Optional binaries for 32-bit Windows
      &lt;modelIdentifier&gt;.dll  // DLL of the FMI implementation
                             // (build with option "MT" to include run-time environment)
      &lt;other DLLs&gt;           // The DLL can include other DLLs
      // Optional object Libraries for a particular compiler VisualStudio8
      VisualStudio8        // Binaries for 32-bit Windows generated with
                           // Microsoft Visual Studio 8 (2005)
         &lt;modelIdentifier&gt;.lib   // Binary libraries
      gcc3.1               // Binaries for gcc 3.1.
         ...
  win64      // Optional binaries for 64-bit Windows
     ...
  linux32    // Optional binaries for 32-bit Linux
     &lt;modelIdentifier&gt;.so    // Shared library of the FMI implementation
     ...
  linux64    // Optional binaries for 64-bit Linux
     ...
  &lt; If an FMU is run through one of its binaries all items in that binary folder is recommended to be unpacked at the same location as the binary &lt; modelIdentifier &gt;.* is unpacked.
   If not it's likely that, if the FMU has dependencies on those items, it will not be able to find them and run &gt;
resources    // Optional resources needed by the FMU
   &lt; data in FMU specific files which will be read during initialization;
     also more folders can be added under resources (tool/model specific).
     In order for the FMU to access these resource files, the resource directory
     must be available in unzipped form and the absolute path to this directory
     must be reported via argument "fmuResourceLocation" via fmi2Instantiate.
extra                         // Additional (meta-)data of the FMU (optional)
   // additional (meta-)data that is supposed to travel with the FMU;
   // see below for structure and content definition.
   &gt;</pre>
</div>
</div>
<div class="paragraph">
<p>An FMU has to implement all common functions (according to tables in sections 3.2.3 and 4.2.4).
ModelExchange FMUs have to provide additionally the respective Model Exchange function,
CoSimulation FMUs the Co-Simulation functions.</p>
</div>
<div class="paragraph">
<p>The FMU must be distributed with <span class="underline">at least</span> one implementation,
in other words, either <span class="underline">sources</span> or one of the <span class="underline">binaries</span> for a particular machine.
It is also possible to provide the sources and binaries for different target machines together in one ZIP file.
The following names are standardized: for Windows: "win32",
"win64"- for Linux: "linux32", "linux64", for Macintosh: "darwin32", "darwin64".
Furthermore, also the names "VisualStudioX" and "gccX" are standardized and define
the compiler with which the binary has been generated <em>[, for example, VisualStudio8]</em>.
Further names can be introduced by vendors.
FMUs should contain all resources that are required to load and execute a shared library, link against a static library, or compile from source.
Shared libraries should be statically linked against their dependencies <em>[e.g. the Visual Studio C Runtime on Windows]</em>.
<code>RPATH="$ORIGIN"</code> should be set when building ELF binaries to allow dynamic loading of dependencies on the target machine.
If the FMU depends on external resources <em>[e.g. shared libraries, files, or servers]</em> to be loaded or simulated <code>documentation/externalDependencies.{txt|html}</code> should be present to document these dependencies and how to provide them.</p>
</div>
<div class="paragraph">
<p>Typical scenarios are to provide binaries only for one machine type (for example, on the machine where the target simulator is running and for which licenses of run-time libraries are available) or to provide only sources (for example, for translation and download for a particular micro-processor).
If run-time libraries cannot be shipped due to licensing,
special handling is needed,
for example, by providing the run-time libraries at appropriate places by the receiver.</p>
</div>
<div class="paragraph">
<p>FMI provides the means for two kinds of implementation: <code>needsExecutionTool = "true"</code> and <code>needsExecutionTool = "false"</code>.
In the first case a tool specific wrapper DLL/SharedObject has to be provided as the binary,
in the second a compiled or source code version of the model with its solver is stored (see section 4.3.1 for details).</p>
</div>
<div class="paragraph">
<p>In an FMU both a version for ModelExchange and for CoSimulation might be present.
If in both cases the executable part is provided as DLL/SharedObject,
then two different or only one library can be provided.
The library names are defined in the <code>modelIdentifier</code> attribute of elements
<code>fmiModelDescription.ModelExchange</code> and <code>fmiModelDescription.CoSimulation</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Example for different libraries:
  binaries
     win32
        MyModel_ModelExchange.dll   // ModelExchange.modelIdentifier =
                                    //    "MyModel_ModelExchange"
        MyModel_CoSimulation.dll    // CoSimulation.modelIdentifier =
                                    //    "MyModel_CoSimulation"
]</pre>
</div>
</div>
<div class="paragraph">
<p>The usual distribution of an FMU will be with DLLs/SharedObjects because then
further automatic processing <em>[(for example, importing into another tool)]</em> is possible.<br>
If run-time libraries are needed by the FMU that have to be present on the target machine,
then automatic processing is likely impossible.
The requirements and the expected processing should be documented in the <code>documentation</code> directory in this case.<br>
A source-based distribution might require manual interaction in order that it can be utilized.
The intention is to support platforms that are not known in advance (such as HIL-platforms or micro-controllers).
Typically, in such a case the complete source code in ANSI-C is provided
(for example, one C source file that includes all other needed C files with the <code>#include</code> directive).
All C source file names that need to be defined in a compiler directive have to
be defined in the XML file under structure <code>&lt;ModelExchange&gt;&lt;SourceFiles&gt;</code>
and <code>&lt;CoSimulation&gt;&lt;SourceFiles&gt;</code>.
These files may include other files.
The <code>#include</code> directive with <code>""</code> should be used for header-files distributed
in the FMU instead of using angle brackets`&lt;&gt;`.
If default options of the compiler are sufficient,
it might then be possible to automatically process such source code FMUs.
An exporting tool should give documentation on how to build an executable,
either via a documentation file and/or via a template makefile for a particular platform,
from which a user can construct the makefile for his/her target platform.
This documentation should be stored in the <code>documentation</code> directory,
possibly with a link to the template makefile (stored in the <code>sources</code> directory).
<em>[As template makefile, CMake (<a href="http://www.cmake.org" class="bare">http://www.cmake.org</a>), a cross- platform,
open-source build system might be used.]</em><br>
The sub-directory <code>licenses</code> can be used to bundle all license files.
<em>[It is strongly recommended to include all license and copyright related
information in the licenses folder of an FMU (especially but not only
for contained open source software) - the license.{html,txt} file can serve
as an entry point for describing the contained licenses. This will help the users
to comply with license conditions when passing source or binary code
contained in an an FMU to other persons or organizations.]</em></p>
</div>
<div class="paragraph">
<p>In directory <code>resources</code>,
additional data can be provided in FMU specific formats,
typically for tables and maps used in the FMU.
This data must be read into the model at the latest during initialization
(that is, before <code>fmi2ExitInitializationMode</code> is called).
The actual file names in the ZIP file to access the data files can either
be hard-coded in the generated FMU functions,
or the file names can be provided as string parameters via the <code>fmi2SetString</code> function.
<em>[Note that the absolute file name of the resource directory
is provided by the initialization functions]</em>.
In the case of a co-simulation implementation of <code>needsExecutionTool = "true"</code> type,
the <code>resources</code> directory can contain the model file in the tool specific file format.</p>
</div>
<div class="paragraph">
<p><em>[Note that the header files <code>fmi2TypesPlatform.h</code> and <code>fmi2FunctionTypes.h/fmi2Functions.h</code>
are not included in the FMU due to the following reasons:</em></p>
</div>
<div class="paragraph">
<p><em>`fmi2TypesPlatform.h` makes no sense in the <code>sources</code> directory,
because if sources are provided,
then the target simulator defines this header file and not the FMU.<br>
This header file is not included in the <code>binaries</code> directory,
because it is implicitly defined by the platform directory
(for example, win32 for 32-bit machine or linux64 for 64-bit machine).
Furthermore, the version that was used to construct the FMU can also
be inquired via function <code>fmi2GetTypesPlatform()</code>.</em></p>
</div>
<div class="paragraph">
<p><em>`fmi2FunctionTypes.h/fmi2Functions.h` are not needed in the <code>sources</code> directory,
because they are implicitly defined by attribute <code>fmiVersion</code> in file <code>modelDescription.xml</code>.
Furthermore, in order that the C compiler can check for consistent function arguments,
the header file from the target simulator should be used when compiling the C sources.
It would therefore be counter-productive (unsafe)
if this header file was present.<br>
These header files are not included in the <code>binaries</code> directory,
since they are already utilized to build the target simulator executable.
The version number of the header file used to construct
the FMU can be deduced via attribute <code>fmiVersion</code> in file
<code>modelDescription.xml</code> or via function call <code>fmi2GetVersion()</code>.]</em></p>
</div>
<div class="paragraph">
<p><em>[New in FMI 2.0.2: Extra directory ]</em>
==== Extra Directory <a id="extra-directory"></a></p>
</div>
<div class="paragraph">
<p>The ZIP archive may contain additional entries with the prefix <code>extra/</code> that can be used to store additional data and meta-data.
In order to avoid ambiguities and conflicts, the extra files should be provided in subdirectories using a reverse domain notation of a domain that is controlled by the entity defining the semantics and content of the additional entries <em>[(for example <code>extra/com.example/SimTool/meta.xml</code> or <code>extra/org.example.stdname/data.asd</code>)]</em>.
The use of subdirectories beginning with <code>org.modelica</code> and <code>org.fmi-standard</code> is explicitly reserved for use by MAP FMI-defined layered standards, i.e. other uses must not use subdirectory names beginning with these prefixes.
It is explicitly allowed for tools and users other than the original creator of an FMU to modify, add or delete entries in the <code>extra/</code> directory without affecting the validity of the FMU in all other aspects.
Specifically all validation or digital signature schemes used to protect the content of the FMU should take the variability of extra file content into account <em>[(for example by having separate checksums or signatures for FMU core content and extra content, or not having signatures at all for extra content)]</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fmi_for_model_exchange">3. FMI for Model Exchange</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter contains the interface description to access the equations of a dynamic system from a C program.
A schematic view of a model in "FMI for Model Exchange" format is shown in Figure 2:</p>
</div>
<div class="paragraph">
<div class="title">Data flow between the environment and an FMU for Model Exchange:</div>
<p><strong class="blue">Blue</strong> arrows: Information provided by the FMU.
<strong class="red">Red</strong> arrows : Information provided to the FMU.
<strong>vstart</strong>, <strong>u</strong>, <strong>y</strong>, <strong>w</strong>, <strong>xd</strong> are of type Real, Integer, Boolean, String;
<strong>t</strong>, <strong>xc</strong>, <strong>z</strong> are of type Real.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ModelExchangeDataFlow.svg" alt="ModelExchangeDataFlow" width="60%">
</div>
</div>
<div class="sect2">
<h3 id="_mathematical_description">3.1. Mathematical description</h3>
<div class="paragraph">
<p>The goal of the Model Exchange interface is to numerically solve a system of differential,
algebraic and
discrete-time equations.
In this version of the interface,
ordinary differential equations in state-space
form with events are handled (abbreviated as "hybrid ODE").
Algebraic equation systems might be
contained inside the FMU.
Also, the FMU might consist of discrete-time equations only,
for example, describing a sampled-data controller.</p>
</div>
<div class="paragraph">
<p>The independent variable time \(t \in \mathbb{T}\) is a tuple
\(t = (t_R,t_I)\), where \(t_R \in \mathbb{R},\ t_{I} \in \mathbb{N} = \{0, 1, 2, \ldots\}\).
The real part \(t_R\) of this tuple is the independent variable of the FMU for describing the continuous-time behavior of the model between events.
In this phase \(t_I = 0\).
The integer part \(t_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).
This time definition is also called "super dense time" in literature,
see, for instance, (Lee and Zheng 2007).
An ordering is defined on \(\mathbb{\text{T}}\) leading to the following notation
<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 58.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Operation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Mathematical meaning</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 &lt; t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{R1},t_{I1}) &lt; (t_{R2}, t_{I2})\ \Leftrightarrow \ t_{R1} &lt; t_{R2}\ \textbf{or} \ t_{R1}= t_{R2} \ \textbf{and} \ t_{I1} &lt; t_{I2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is before \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t_1 = t_2\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\((t_{R1},t_{I1}) = (t_{R2},t_{I2}) \ \Leftrightarrow  t_{R1}= t_{R2}\ \textbf{and} \ t_{I1} = t_{I2}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(t_1\) is identical to \(t_2\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t^{+}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\({{(t}_{R},t_{I})}^{+} \Leftrightarrow (\lim_{\epsilon \rightarrow 0}{\left(t_{R} + \varepsilon \right),t_{Imax})}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">right limit at \(t\).
\(t_{Imax}\) is the largest occurring Integer index of super dense time</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^-t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{-}{{(t}_{R},t_{I})} \Leftrightarrow (\lim_{\epsilon \rightarrow 0}{\left( t_{R} - \varepsilon \right),0)}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left limit at \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(^{\bullet}{\left( t_{R},t_{I} \right)\ } \Leftrightarrow \left\{ \begin{matrix} ^-t \ &amp; \mathbf{if} \ t_I = 0 \\ (t_R, t_I - 1) \ &amp; \mathbf{if} \ t_I &gt; 0 \\ \end{matrix} \right.\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous time instant (= either left limit or previous event instant).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v^+\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(t^+)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the right limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{-}v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^-t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value at the left limit of \(t\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(^{\bullet}v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(v(^{\bullet}t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">previous value (= either left limit or value from the previous event)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Assume that an FMU has an event at \(t_R=2.1s\) and here a signal changes discontinuously.
If no event
iteration occurs,
the time instant when the event occurs is defined as (2.1, 0),
and the time instant whenthe integration is restarted is defined as (2.1, 1).]</em></p>
</div>
<div class="paragraph">
<p>The hybrid ODEs supported by FMI are described as <span class="underline">piecewise continuous-time systems</span>.
Discontinuities
can occur at time instants \(t_0, t_1, \ldots, t_n\) where \(t_i &lt; t_{i+1}\).
These time instants are called "events".
Events can
be known before hand (= time event),
or are defined implicitly (= state and step events), see below.
Between events, variables are either continuous or do not change their value.
A variable is called
discrete-time, if it changes its value only at an event instant.
Otherwise the variable is called continuoustime.
Only real variables can be continuous-time.
The following variable indices are used to describe the timing behavior of the corresponding variable
(for example, 𝑣𝑑 is a discrete-time variable).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Index</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>continuous-time</strong> variable,
that is, a variable that is a continuous function of time inside each interval \(t_i^+ &lt; \ ^-t_{i+1}\)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <strong>discrete-time</strong> variable,
that is, a variable that changes its value only at an event instant \(t_i\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c+d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of <strong>continuous-time</strong> and <strong>discrete-time</strong> variables</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At every event instant \(t_i\), variables might be discontinuous (see Figure 3).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/PieceWiseContinuousVariables.svg" alt="PieceWiseContinuousVariables" width="60%">
</div>
<div class="title">Figure 3: Piecewise-continuous variables of an FMU: continuous-time (\(v_c\)) and discrete-time (\(v_d\)).</div>
</div>
<div class="paragraph">
<p>An <span class="underline">event instant</span> \(t_i\) is defined by one of the following conditions that give the smallest time instant:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The environment of the FMU triggers an event at the current time instant because at least one discrete-time input changes its value,
a continuous-time input has a discontinuous change,
or a tunable parameter changes its value.
Such an event is called <span class="underline">external event</span>.
 <em>[Note that if an FMU A is connected to an FMU B, and an event is triggered for A,
 then potentially all outputs of A will be discontinuous at this time instant.
 It is therefore adviceable to trigger an external event for B at this time instant too,
 if an output of A is connected to B.
 This means to call <code>fmi2EnterEventMode</code> on B.]</em><br>
All the following events are internal events.</p>
</li>
<li>
<p>At a predefined time instant \(t_i=(T_{next}(t_{i-1}, 0)\)
that was defined at the previous event instant ti-1 by the FMU.
Such an event is called <span class="underline">time event</span>.</p>
</li>
<li>
<p>At a time instant,
where an <span class="underline">event indicator</span> \(z_j(t)\) changes its domain from \(z_j &gt; 0\) to \(z_j \leq 0\) or from \(z_j \leq 0\) to \(z_j &gt; 0\) (see Figure 4 below).
More precisely: An event \(t = t_i\) occurs at the smallest time instant "min t" with \(t&gt;t_{i-1}\) where "\((z_j(t)&gt;0) \ne (z_j(t_{i-1}) &gt;0)\)".
Such an event is called <span class="underline">state event</span>
<sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup>.
All event indicators are piecewise continuous and are collected together in one vector of real numbers \(\mathbf{z(t)}\).<br></p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/Event.svg" alt="Event" width="60%">
</div>
<div class="title">Figure 4: An event occurs when the event indicator changes its domain from \(z&gt;0\) to \(z\leq 0\) or vice versa.</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>At every completed step of an integrator,
<code>fmi2CompletedIntegratorStep</code> must be called (provided the capability flag <code>ModelDescription.completedIntegratorStepNotNeeded = false</code>).
An event occurs at this time instant,
if indicated by the return argument <code>enterEventMode = fmi2True</code>.
Such an event is called <span class="underline">step event</span>.
<em>[Step events are,
for example, used to dynamically change the (continuous) states of a model internally in the FMU,
because the previous states are no longer suited numerically.]</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An FMI Model-Exchange model is described by the following variables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>Variable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Independent variable time \(\in \mathbb{T}\).
(Variable defined with <code>causality = "independent"</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(v\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of all exposed variables (all variables defined in element <code>&lt;ModelVariables&gt;</code>,
see section 2.2.7).
A subset of the variables is selected via a subscript.
Example: \(\mathbf{v}_{initial=exact}\) are variables defined with attribute <code>initial ="exact"</code> (see section 2.2.7).
These are independent parameters and startvalues of other variables,
such as initial values for states, state derivatives or outputs.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters that are constant during simulation.
The symbol without a subscript references independent parameters (variables with <code>causality = "parameter"</code>).
Dependent parameters (variables with <code>causality = "calculatedParameter"</code>) are denoted as \(\mathbf{p}_{calculated}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{u}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <code>causality = "input"</code>.
Whether the input is a discrete-time or continuous-time variable is defined
via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> (see section 2.2.7).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{y}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU and they are designed to be used in a model connection.
For instance, output variables might be used in the environment as input values to other FMUs or other submodels.
Variables of this type are defined with attribute <code>causality = "output"</code>.
Whether the output is a discrete-time or continuous-time variable is defined
via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> (see section 2.2.7).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{w}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that cannot be used for FMU connections.
Variables of this type are defined with attribute <code>causality = "local"</code>, see section 2.2.7.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{z}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of real continuous-time variables utilized to define state events, see below.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_c(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of real continuous-time variables representing the continuous-time states.
For notational convenience,
a continuous-time state is conceptually treated as a different type of variable as an output or a local variable for the mathematical description below.
In reality, a continuous-time state is however part of the outputs \(\mathbf{y}\) or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\)<br>
\(^{\bullet}\mathbf{x}_d(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\) is a vector of (internal) discrete-time variables (of any type) representing the discrete states.<br>
\({}^{\bullet}\mathbf{x}_d(t)\) a is the value of \(\mathbf{x}_d(t)\) at the previous super dense time instant,
so \({}^{\bullet}\mathbf{x}_d(t)=\mathbf{x}_d({}^{\bullet}t)\).
Given the previous values of the discrete-time states,
\({}^{\bullet}\mathbf{x}_d(t)\), at the actual time instant \(t\),
all other discrete-time variables,
especially the discrete states \(\mathbf{x}_d(t)\), can be computed.<br>
Discrete states are not visible in the interface of an FMU and are only introduced here to clarify the mathematical description.
Formally, a discrete state is part of the outputs \(\mathbf{y}\) or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(T_{next}(t_{i})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At initialization or at an event insant,
an FMU can define the next time instant \(T_{next}\),
at which the next event occurs (see also the definition of events above).
Every event removes automatically a previous definition of \(T_{next}\),
and it must be explicitly defined again,
if a previously defined \(T_{next}\) was not triggered at the current event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{r}(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of Boolean variables with \(r_{i} := z_{i} &gt; 0\).
When entering Continuous-Time Mode all relations reported via the event indicators \(\mathbf{z}\) are fixed and during this Mode these relations are replaced by \(\mathbf{r}\).
Only during Initialization or Event Mode the domains \(z_{i} &gt; 0\) can be changed.
For notational convenience,
\(\mathbf{r} := \mathbf{z} &gt; 0\)is an abbreviation for \(\mathbf{r}:=\{z_1&gt;0, z_2&gt;0, \ldots \}\).
<em>[For more details, see "Remark 3" below.]</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Computing the solution of an FMI model means to split the solution process in different phases, and in
every phase different equations and solution methods are utilized.
The phases can be categorized
according to the following modes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Initialization Mode:</strong><br>
This mode is used to compute at the start time stem[t_0] initial values for continuous-time states,
\(\mathbf{x}_c(t_0)\),
and for the previous (internal) discrete-time states,
\(\mathbf{x}_d(t_0)\),
by utilizing extra equations not present in the other modes (for example, equations to define the start value for a state or for the derivative of a state).</p>
</li>
<li>
<p><strong>Continuous-Time Mode:</strong><br>
This mode is used to compute the values of all (real) continuous-time variables between events by numerically solving ordinary differential and algebraic equations.
All discrete-time variables are fixed during this phase and the corresponding discrete-time equations are not evaluated.</p>
</li>
<li>
<p><strong>Event Mode:</strong><br>
This mode is used to compute new values for all continuous-time variables,
as well as for all discrete-time variables that are activated at the current event instant \(t\),
given the values of the variables from the previous instant \({}^{\bullet}t\).
This is performed by solving algebraic equations consisting
of all continuous-time and all active discrete-time equations.
In FMI 2.0 there is no mechanism that the FMU can provide the information whether a discrete-time variable is active or is not active (is not computed) at an event instant.
Therefore, the environment has to assume that at an event instant always all discrete-time variables are computed,
although internally in the FMU only a subset might be newly computed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When connecting FMUs together,
loop structures can occur that lead to particular difficulties because
linear or non-linear algebraic systems of equations in Real variables but also in Boolean or Integer
variables might be present.
In order to solve such systems of equations over FMUs efficiently,
the dependency information is needed stating,
for example, which outputs depend directly on inputs.
This data is optionally provided in the XML file under element <code>&lt;ModelStructure&gt;</code>.
If this data is not provided,
the worst case must be assumed
(for example, all output variables depend algebraically on all input variables).</p>
</div>
<div class="paragraph">
<p><em>[Example: In Figure 5 two different types of connected FMUs are shown (the "dotted lines" characterize the dependency information):</em></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ArtificialAlgebraicLoop.svg" alt="ArtificialAlgebraicLoop" width="80%">
</div>
<div class="title">Figure 5: Calling sequences for FMUs that are connected in a loop.</div>
</div>
<div class="paragraph">
<p><em>In the upper diagram, FMU1 and FMU2 are connected in such a way that by an appropriate sequence of <code>fmi2SetXXX</code> and <code>fmi2GetXXX</code> calls, the FMU variables can be computed.
In the lower diagram, FMU3 and FMU4 are connected in such a way that a "real" algebraic loop is present.
This loop might be solved iteratively with a Newton method.
In every iteration the iteration variable u<sub>4</sub> is
provided by the solver, and via the shown sequence of <code>fmi2SetXXX</code> and <code>fmi2GetXXX</code> calls, the residue is computed and is provided back to the solver.
Based on the residue a new value of u<sub>4</sub> is provided.
The iteration is terminated when the residue is close to zero.
These types of artifical or real algebraic loops can occur in all the different modes,
such as Initialization Mode,
Event Mode, and Continuous-Time Mode.
Since different variables are computed in every Mode and the causality of variable computation can be different in Initialization Mode as with respect to the other two
Modes, it might be necessary to solve different kinds of loops in the different Modes.]</em></p>
</div>
<div class="paragraph">
<p>In Table 1 the equations are defined that can be evaluated in the respective Mode.
The following color coding is used in the table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><span class="silver"><strong>grey</strong></span>: If a variable in an argument list is marked in <span class="silver">grey</span>,
then this variable is not changing in this mode and just the last calculated value from the previous mode is internally used.
For an input argument, it is not allowed to call <code>fmi2SetXXX</code>.
For an output argument,
calling <code>fmi2GetXXX</code> on such a variable returns always the same value in this mode.</p>
</li>
<li>
<p><span class="lime"><strong>green</strong></span>: Functions marked in <span class="lime">green</span> are special functions to enter or leave a mode.</p>
</li>
<li>
<p><span class="blue"><strong>blue</strong></span>: Equations and functions marked in <span class="blue">blue</span> define the actual computations to be performed in the respective mode.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Function <code>fmi2SetXXX</code> is an abbreviation for functions <code>fmi2SetReal</code>, <code>fmi2SetBoolean</code>,
<code>fmi2SetInteger</code> and <code>fmi2SetString</code> respectively.
Function <code>fmi2GetXXX</code> is an abbreviation for functions <code>fmi2GetReal</code>, <code>fmi2GetBoolean</code>,
<code>fmi2GetInteger</code> and <code>fmi2GetString</code> respectively.</p>
</div>
<div class="paragraph">
<p><em>[In the following table the setting of the super dense time, (t<sub>R</sub>, t<sub>I</sub>),
is precisely described.
Tools will usually not have such a representation of time.
However, super-dense time defines precisely when a new "model evaluation" starts
and therefore which variable values belong to the same "model evaluation" at
the same (super dense) time instant and should be stored together.]</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1: Mathematical description of an FMU for Model Exchange.</caption>
<colgroup>
<col style="width: 62.5%;">
<col style="width: 37.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Equations</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FMI functions</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations before Initialization Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(T_{R0}\) and define \(t_0 := (t_{R0},0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetupExperiment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{initial=exact}\) and \(\mathbf{v}_{initial=approx}\)  that have a start value (<code>initial</code> = <code>"exact"</code> or `"approx`")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Initialization Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Initialization Mode at \(t=t_0\) (activate initialization,
discrete-time and continuous-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2EnterInitializationMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(\mathbf{v}_{initial=exact}\) that have a start value with
<code>initial="exact"</code> (independent parameters \(\mathbf{p}\) and
continuous-time states with start values \(\mathbf{x_c}\),
initial=exact_~ are included here)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}(\color{grey}t_{\color{grey} 0})\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\mathbf{v}_{initialUnknowns}:=f_{init}(\mathbf{u_c}, \mathbf{u_d}, \color{grey}t_{\color{grey} 0}, \mathbf{v}_{initial=exact}\))</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi2GetXXX</span></code>, <code><span class="blue">fmi2GetContinuousStates</span></code>,
<code><span class="blue">fmi2GetEventIndicators</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Exit Initialization Mode (de-activate initialization equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2ExitInitializationMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Event Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Event Mode at \(t = t_{i}\) with \({t_{i}\ : = (t}_{R},t_{I} + 1)\) <strong>if</strong>  <em>externalEvent</em> <strong>or</strong> <em>nextMode</em> \(\equiv\) <em>EventMode</em> <strong>or</strong> \(t_i=(T_{next}(t_{i-1}), 0)\) <strong>or</strong>  \(\min_{t&gt;t_{i-1}} t:\left\lbrack z_{j}\left( t \right) &gt; 0\  \neq \ z_{j}\left( t_{i - 1} \right) &gt; 0 \right\rbrack\)<br>
(activate discrete-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2EnterInitializationMode</span></code> <span class="lime">(only from Continuous-Time Mode or after calling</span> <code><span class="lime">fmi2SetTime</span></code>
<span class="lime">if FMU has no continuous-time equations)</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent tunable parameters \(\mathbf{p}_{tune}\)<br>
(and do not set other parameters \(\mathbf{p}_{other}\))</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}(t_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\((\mathbf{y}_{c+d}, \mathbf{\dot{x}}_c, \mathbf{w}_{c+d}, \mathbf{z}, \mathbf{x}_{c, reinit})=\mathbf{f}_{sim}(\mathbf{x_c}, \mathbf{u_{c+d}}, \color{grey}t_{\color{grey} i}, \mathbf{p}_{tune}, \color{grey}{\mathbf{p}_{other})}\)</span> <br>
\(\mathbf{f}_{sim}\)is also a function of the internal variables  \({}^\bullet\mathbf{x}_d\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi2GetXXX</span></code>,
<code><span class="blue">fmi2GetContinuousStates</span></code>,
<code><span class="blue">fmi2GetDerivatives</span></code>,
<code><span class="blue">fmi2GetEventIndicators</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Increment super dense time and define with</span>
<code><span class="lime">newDiscreteStatesNeeded</span></code> <span class="lime">whether a new event iteration is required.</span><br>
<span class="blue">\(\qquad\)<strong>if not</strong></span> <code><span class="blue">newDiscreteStatesNeeded</span></code><span class="blue"><strong>then</strong><br>
\(\qquad \qquad T_{next}=T_{next}(\mathbf{x}_c,{}^\bullet\mathbf{x}_d, \mathbf{u_{c+d}}, \color{grey}t_{\color{grey} i}, \mathbf{p}_{tune}, \color{grey}{\mathbf{p}_{other})}\)</span><br>
<span class="blue">\(\qquad\)<strong>end if</strong></span><br>
<span class="blue">\(\qquad t:=t(t_R, t_i+1)\)</span><br>
<span class="blue">\(\qquad {}^\bullet\mathbf{x}_d:=\mathbf{x}_d\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2NewDiscreteState</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(t_i := (T_{next},0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetTime</code><br>
(if no continuous-time equations)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong><em>Equations during Continuous-Time Mode</em></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Continuous-Time Mode:</span><br>
<span class="lime">\(\qquad \textrm{// de-activate discrete-time equations}\)</span><br>
<span class="lime">\(\qquad \textrm{// "freeze" variables:}\)</span><br>
<span class="lime">\(\qquad \mathbf{r} := \mathbf{z}&gt;0 \qquad \textrm{//all relations}\)</span><br>
<span class="lime">\(\qquad \textbf{x}_d, \textbf{w}_d \qquad \textrm{//all discrete-time variables}\)</span><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2EnterContinuousTimeMode</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent variable time \(t(&gt;t_{enter  mode}): t:=(t_R, 0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetTime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time inputs \(\mathbf{u}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time states \(\mathbf{x}_{c}(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code>,
<code>fmi2SetContinuousStates</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="blue">\((\mathbf{y}_{c}\mathbf{,} \color{grey}{\mathbf{y}_{d}}\mathbf{,\ }{\dot{\mathbf{x}}}_{c}\mathbf{,}_{}\mathbf{w}_{c}\mathbf{,}\color{grey}{\mathbf{w}_{d}}\mathbf{,z,}\color{grey}{\mathbf{x}_{c,reinit}}):=\mathbf{f}_{sim}(\mathbf{x}_{c},\ \mathbf{u}_{c}\mathbf{,} \color{grey}{\mathbf{\ u}_{d}}, t,\color{grey}{\mathbf{p}_{tune},\mathbf{p}_{other}})\)</span><br>
<span class="blue">\(\qquad \mathbf{f}_{sim}\) is also a function of the internal variables</span> <span class="silver">\({}^\bullet\mathbf{x}_{d},\mathbf{r}\).</span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code><span class="blue">fmi2GetXXX,</span></code>
<code><span class="blue">fmi2GetDerivatives,</span></code>
<code><span class="blue">fmi2GetEventIndicators</span></code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Complete integrator step and return <em>enterEventMode</em></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="lime">fmi2CompletedIntegratorStep</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Data types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">\(t \in \mathbb{R}, \mathbf{p} \in \mathbb{P}^{np},  \mathbf{u}(t) \in \mathbb{P}^{nu},\mathbf{y}(t) \in \mathbb{P}^{ny}, \mathbf{x}_c(t) \in \mathbb{R}^{nxc}, \mathbf{x}_d(t) \in \mathbb{P}^{nxd}, \mathbf{w}(t) \in \mathbb{P}^{nw}, \mathbf{z}(t) \in \mathbb{R}^{nz}\)<br>
\(\qquad \mathbb{R}\): Real variable, \(\mathbb{P}\): real <strong>or</strong> boolean <strong>or</strong> integer <strong>or</strong> enumeration <strong>or</strong> string variable<br>
\(\mathbf{f}_{init}, \mathbf{f}_{sim} \in C^0\) (=continuous functions with respect to all input arguments inside the respective mode).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Remark 1 - Calling Sequences:</em></p>
</div>
<div class="paragraph">
<p><em>In the table above, for notational convenience in every Mode one function call is defined to compute all output arguments from all inputs arguments.
In reality, every scalar output argument is computed by one
<code>fmi2GetXXX</code> function call.
Additionally, the output argument need not be a function of all input arguments,
but of only a subset from it, as defined in the XML file under</em> <code>&lt;ModelStructure&gt;</code>.
<em>This is essential when FMUs are connected in a loop,
as shown in</em> Figure 6: <em>For example, since</em> \(y_{2a}\) <em>depends only on</em>
\(u_{1a}\) <em>, but not on</em> \(u_{1b}\)<em>, it is
possible to call</em> <code>fmi2SetXXX</code> <em>to set</em> \(u_{1a}\) <em>,
and then inquire</em> \(y_{2a}\) <em>with</em> <code>fmi2GetXXX</code> <em>without setting</em> \(u_{1b}\) <em>beforehand.</em></p>
</div>
<div class="paragraph">
<p><em>It is non-trivial to provide code for <code>fmi2SetXXX</code>, <code>fmi2GetXXX</code>,
if the environment can call</em> <code>fmi2SetXXX</code> <em>on the inputs in quite different orders.
A simple remedy is to provide the <span class="underline">dependency information</span>, not according to the "real" functional dependency,
but according to the <span class="underline">sorted equations in the generated code</span>.
Example:</em></p>
</div>
<div class="paragraph">
<p>Assume an FMU is described by the following equations
(<code>u1</code>, <code>u2</code> are inputs, <code>y1</code>, <code>y2</code> are outputs,<code>w1</code>, <code>w2</code> are internal variables):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w1 = w2 + u1
w2 = u2
y1 = w1
y2 = w2</pre>
</div>
</div>
<div class="paragraph">
<p>Sorting of the equations might result in (this ordering is not unique):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w2 := u2
y2 := w2
w1 := w2 + u1
y1 := w1</pre>
</div>
</div>
<div class="paragraph">
<p>With this ordering, the dependency should be defined as <code>y2 = f(u2), y1 = f(u1,u2)</code>.
When <code>y2</code> is called first with <code>fmi2GetXXX</code>,
then only <code>u2</code> must be set first (since <code>y2 = f(u2)</code>),
and the first two equations are evaluated.
If later <code>y1</code> is inquired as well,
then the first two equations are not evaluated
again and only the last two equations are evaluated.
On the other hand,
if <code>y1</code> is inquired first,
then <code>u1</code> and <code>u2</code> must be set first (since <code>y1 = f(u1,u2)</code>) and then all equations are computed.
When <code>y2</code> is inquired afterwards,
the cached value is returned.</p>
</div>
<div class="paragraph">
<p>If sorting of the equations in this example would instead result in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>w2 := u2
w1 := w2 + u1
y1 := w1
y2 := w2</pre>
</div>
</div>
<div class="paragraph">
<p>then the dependency should be defined as <code>y2 = f(u1,u2)</code>,
<code>y1 = f(u1,u2)</code>, because <code>u1</code> and <code>u2</code> must be first set,
before <code>y2</code> can be inquired with <code>fmi2GetXXX</code> when executing this code.</p>
</div>
<div class="paragraph">
<p><em>Remark 2 - Mathematical Model of Discrete-Time FMUs:</em></p>
</div>
<div class="paragraph">
<p><em>There are many different ways discrete-time systems are described.
For FMI, the following basic mathematical model for discrete-time systems is used
(other description forms must be mapped, as sketched below):</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/remark_2_source.png" alt="remark 2 source" width="70%">
</div>
</div>
<div class="paragraph">
<p><em>At an event instant,
the discrete system is described by algebraic equations as function of the previous (internal) discrete-time states</em> \(_{‍}^{\bullet}\mathbf{x}_{d}\) <em>and the discrete-time inputs</em> \(\mathbf{u}_{d}\)<em>.
If FMUs are connected in a loop, these algebraic equations are called iteratively,
until the solution is found.
If the actual discrete-time states</em> \(\mathbf{x}_{d}\) <em>and the previous discrete-time states</em> \(_{‍}^{\bullet}\mathbf{x}_{d}\) <em>are not identical,
the discrete-time states are updated,
the Integer part of the time is incremented and a new event iteration is performed.
Other discrete-time models must be mapped to this description form.
Examples:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Synchronous systems:</em><br>
<em>A synchronous system,
such as Lucid Synchrone (Pouzet 2006) or Modelica 3.3 (Modelica 2012),
is called periodically, and at every sample instant the discrete-time equations are evaluated exactly once.
An FMU of this type can be implemented by activating the model equations only at the first event iteration and returning always <code>newDiscreteStatesNeeded = false</code> from <code>fmi2NewDiscreteStates</code>.
Furthermore, the discrete-time states are not updated by <code>fmi2NewDiscreteStates</code>,
but as first action before the discrete-time equations are evaluated,
in order that</em> \(^{\bullet}\mathbf{x}_d\) <em>(= value at the previous clock tick) and</em> \(\mathbf{x}_d\) <em>(value at the latest clock tick) have reasonable values between clock ticks.</em></p>
</li>
<li>
<p><em>State machines with one memory location for a state:</em><br>
<em>In such a system there is only one memory location for a discrete-time state and not two,
and therefore a discrete-time state is updated in the statement where it is assigned (and not in <code>fmi2NewDiscreteStates</code>).
As a result,
<code>fmi2NewDiscreteStates</code> is basically just used to start a new (super dense) time instant.
This is unproblematic, as long as no algebraic loops occur.
FMUs of this type can therefore not be used in "real" algebraic loops if the involved variables depend on a discrete-time state.
This restriction is communicated to the environment of the FMU by the <code>ScalarVariable</code> definition of the corresponding input with flag <code>canHandleMultipleSetPerTimeInstant = false</code> (so an input with this flag is not allowed to be called in an algebraic loop).</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Remark 3 - Event Indicators / Freezing Relations:</em></p>
</div>
<div class="paragraph">
<p><em>In the above table, vector</em> <strong>r</strong> <em>is used to collect all relations together that are utilized in the event indicators</em> <strong>z</strong> <em>.
In Continuous-Time Mode all these relations are "frozen" and do not change during the evaluations in the respective Mode.
This is indicated in the table above by computing_</em> <strong>r</strong> <em>when entering the Continuous-Time Mode and providing</em> <strong>r</strong> <em>as (internal) input argument to the evaluation functions.
Example:</em></p>
</div>
<div class="paragraph">
<p><em>An equation of the form</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = if x1 &gt; x2 or x1 &lt; x3 then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>can be implemented in the FMU as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>z1 := x1 - x2;
z2 := x3 - x1;
if InitializationMode or EventMode then
  r1 := z1 &gt; 0;
  r2 := z2 &gt; 0;
end if;
y = if r1 or r2 then +1 else -1</pre>
</div>
</div>
<div class="paragraph">
<p><em>Therefore,
the original if-clause is evaluated in this form only during Initialization and Event Mode.
In Continuous-Time Mode this equation is evaluated as:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>z1 = x1 - x2;
z2 = x3 - x1
y = if r1 or r2 then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>and when entering Continuous-Time Mode r1 and r2 are computed as</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>r1 = z1 &gt; 0
r2 = z2 &gt; 0</pre>
</div>
</div>
<div class="paragraph">
<p><em>When z1 changes from z1 &gt; 0 to z1 &#8656; 0 or vice versa, or z2 correspondingly,
the integration is halted, and the environment must call <code>fmi2EnterEventMode</code>.</em></p>
</div>
<div class="paragraph">
<p><em>An actual implementation will pack the code in an impure function,
say Greater(&#8230;&#8203;), resulting in:</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>y = if Greater(x1-x2,...) or Greater(x3-x1,...) then +1 else -1;</pre>
</div>
</div>
<div class="paragraph">
<p><em>Furthermore, a hysteresis should be added for the event indicators.</em></p>
</div>
<div class="paragraph">
<p><em>Remark 4 - Pure Discrete-Time FMUs:</em></p>
</div>
<div class="paragraph">
<p><em>If an FMU has only discrete-time equations (and no variables with <code>variability = "continuous"</code>),
then the environment need not call <code>fmi2EnterContinuousTimeMode</code> but can directly call
<code>fmi2SetTime</code> to set the value of the next event instant,
before <code>fmi2EnterEventMode</code> is called.
<strong>This is an optional optimization for the master, the FMU must support all functions that are required for a continuous time FMU and should run in a master that treats it as such.</strong>
If a Pure Discrete time FMU has state events and uses crossing functions, it has to enter continuousTimeMode to evaluate these.
In fact it is no longer a Pure Discrete time FMU but this was not clearly defined in 2.0 so this clarification is needed for 2.0.1]</em></p>
</div>
<div class="paragraph">
<p>An FMU is initialized in Initialization Mode with \(\mathbf{f}_{init}(\ldots)\).
The input arguments to this function consist of the input variables (= variables with <code>causality = "input"</code>),
of the independent variable (= variable with <code>causality = "independent"</code>; usually the default value <code>"time"</code>), and of all variables that have a start value with (explicitly or implicitly) <code>initial = "exact"</code> in order to compute the continuous-time states and the output variables at the initial time \(t_0\).
In the above table,
the variables with <code>initial = "exact"</code> are collected together in variable \(\mathbf{v}_{initial=exact}\).
For example, initialization might be defined by providing initial start values for the states,
\(\mathbf{x}_{c0}\),
or by stating that the state derivatives are zero (\(\dot{\mathbf{x}}_{c} = \mathbf{0}\)).
Initialization is a difficult topic by itself, and it is required that an FMU solves a well-defined initialization problem inside the FMU in Initialization Mode.<br>
After calling <code>fmi2ExitInitializationMode</code>, the FMU is implicitly in Event Mode, and all discrete-time and continuous-time variables at the initial time instant \((t_R, 0)\) can be calculated.
If these variables are present in an algebraic loop,
iteration can be used to compute them.
Once finalized, <code>fmi2NewDiscreteStates</code> must be called,
and depending on the value of the return argument,
the FMU either continues the event iteration at the initial time instant or switches to Continuous-Time Mode.<br>
After switching to Continuous-Time Mode, the integration is started.
Basically, in this phase the derivatives of the continuous states are computed.
If FMUs and/or submodels are connected together,
then the inputs of these models are the outputs of other models, and therefore, the corresponding FMU outputs must be computed.
Whenever result values shall be stored,
usually at output points defined before the start of the simulation,
the <code>fmi2GetXXX</code> function with respect to the desired variables must be called.<br>
Continuous integration is stopped at an event instant.
An event instant is determined by a time,
state or step event, or by an external event triggered by the environment.
In order to determine a state event,
the event indicators <strong>z</strong> have to be inquired at every completed integrator step.
Once the event indicators signal a change of their domain,
an iteration over time is performed between the previous and the actual completed integrator step,
in order to determine the time instant of the domain change up to a certain precision.<br>
After an event is triggered,
the FMU needs to be switched to Event Mode.
In this mode, systems of equations over connected FMUs might be solved (similarily as in Continuous-Time Mode).
Once convergence is reached,
<code>fmi2NewDiscreteStates(..)</code> must be called to increment super dense time (and conceptually update the discrete-time states defined internally in the FMU by \(^{\bullet}\mathbf{x}_d := \mathbf{x}_d\)).
Depending on the discrete-time model,
a new event iteration might be needed
(for example, because the FMU describes internally a state machine
and transitions are still able to fire,
but new inputs shall be taken into account).<br>
The function calls in the table above describe precisely
which input arguments are needed to compute the desired output argument(s).
There is no 1:1 mapping of these mathematical functions to C functions.
Instead, all input arguments are set with <code>fmi2SetXXX(..)</code> C function calls, and then the result argument(s) can be determined with the C functions defined in the right column of the above table.
This technique is discussed in detail in section 3.2.1.
<em><span class="In short:
For efficiency reasons">one</span> (internal) C function.
With the C functions described in the next sections,
input arguments are copied into the internal model data structure only when their value has changed in the environment.
With the C functions in the right column of the table above,
the internal function is called in such a way
that only the minimum needed equations are evaluated.
Hereby, variable values calculated from previous calls can be reused.
This technique is called "caching" and can significantly enhance the simulation efficiency of real-world models.]</em></p>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_application_programming_interface">3.2. FMI Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the interface description to evaluate different model parts from a C program.</p>
</div>
<div class="sect3">
<h4 id="_providing_independent_variables_and_re_initialization_of_caching">3.2.1. Providing Independent Variables and Re-initialization of Caching</h4>
<div class="paragraph">
<p>Depending on the situation,
different variables need to be computed.
In order to be <span class="underline">efficient</span>,
it is important that the interface requires only the <span class="underline">computation</span> of variables that are needed in the <span class="underline">present  context</span>.
For example, during the iteration of an integrator step,
only the state derivatives need to be computed,
provided the output of a model is not connected.
It might be that at the same time instant other variables are needed.
For example, if an integrator step is completed,
the event indicator functions need to be computed as well.
If the state derivatives have already been computed at the present time instant,
then it is important for efficiency that they are not newly computed
in the call to compute the event indicator functions.
This means, the state derivatives shall be reused from the previous call.
This feature is called "<span class="underline">caching of variables</span>" in the sequel.<br>
Caching requires that the model evaluation can detect when the input arguments,
like time or states, have changed.
This is achieved by setting them explicitly with a function call,
since every such function call signals precisely a change of the corresponding variables.
For this reason,
this section contains functions to set the input arguments of the equation evaluation functions.
This is unproblematic for time and states,
but is more involved for parameters and inputs,
since the latter may have different data types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2SetTime(fmi2Component c, fmi2Real time);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Set a new time instant and re-initialize caching of variables that depend on time,
provided the newly provided time value is different to the previously set time value (variables that depend solely on constants or parameters need not to be newly computed in the sequel,
but the previously computed values can be reused).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2SetContinuousStates(fmi2Component c, const fmi2Real x[], size_t nx);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Set a new (continuous) state vector and re-initialize caching of variables that depend on the states.
Argument nx is the length of vector x and is provided for checking purposes (variables that depend solely on constants,
parameters, time, and inputs do not need to be newly computed in the sequel,
but the previously computed values can be reused).
Note that the continuous states might also be changed in Event Mode.
Note that <code>fmi2Status = fmi2Discard</code> is possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2SetXXX(..);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Set new values for (independent) parameters,
start values and inputs and re-initialize caching of variables that depend on these variables.
The details of these functions are defined in section 2.1.7.</p>
</div>
<div class="paragraph">
<p><em>[The functions above have the slight drawback that values must always be copied.
For example, a call to</em> <code>"fmi2SetContinuousStates"</code> <em>will provide the actual states in a vector, and this function has to copy the values in to the internal model data structure "</em> <code>c</code> <em>" so that subsequent evaluation calls can utilize these values.
If this turns out to be an efficiency issue,
a future release of FMI might provide additional functions to provide the address of a memory area where the variable values are present.]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_evaluation_of_model_equations">3.2.2. Evaluation of Model Equations</h4>
<div class="paragraph">
<p>This section contains the core functions to evaluate the model equations.
Before one of these functions can be called,
the appropriate functions from the previous section have to be used,
to set the input arguments to the current model evaluation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2EnterEventMode(fmi2Component c);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>The model enters Event Mode from the Continuous-Time Mode and discrete-time equations may become active (and relations are not "frozen").</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2NewDiscreteStates(fmi2Component  c, fmi2EventInfo* fmi2eventInfo);

typedef struct{
  fmi2Boolean newDiscreteStatesNeeded;
  fmi2Boolean terminateSimulation;
  fmi2Boolean nominalsOfContinuousStatesChanged;
  fmi2Boolean valuesOfContinuousStatesChanged;
  fmi2Boolean nextEventTimeDefined;
  fmi2Real nextEventTime; // next event if nextEventTimeDefined=fmi2True
} fmi2EventInfo;</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>The FMU is in Event Mode and the super dense time is incremented by this call.<br>
If the super dense time before a call to <code>fmi2NewDiscreteStates</code> was \((t_R,t_I)\), then the time instant after the call is \((t_R,t_I)\).<br>
If return argument <code>fmi2eventInfo->newDiscreteStatesNeeded</code> = <code>fmi2True</code>,
the FMU should stay in Event Mode, and the FMU requires to set new inputs to the FMU (<code>fmi2SetXXX</code> on inputs)
to compute and get the outputs (<code>fmi2GetXXX</code> on outputs) and to call <code>fmi2NewDiscreteStates</code> again.
Depending on the connection with other FMUs,
the environment shall</p>
</div>
<div class="ulist indented2">
<ul>
<li>
<p>call <code>fmi2Terminate</code>, if <code>terminateSimulation</code> = <code>fmi2True</code> is returned by at least one FMU,</p>
</li>
<li>
<p>call <code>fmi2EnterContinuousTimeMode</code> if all FMUs return <code>newDiscreteStatesNeeded</code> = <code>fmi2False</code>, and</p>
</li>
<li>
<p>stay in Event Mode otherwise.</p>
</li>
</ul>
</div>
<div class="paragraph indented2">
<p>When the FMU is terminated,
it is assumed that an appropriate message is printed by the logger function (see section 2.1.5) to explain the reason for the termination.<br>
If <code>nominalsOfContinuousStatesChanged = fmi2True</code>, then the nominal values of the states have changed due to the function call and can be inquired with <code>fmi2GetNominalsOfContinuousStates</code>.<br>
If <code>valuesOfContinuousStatesChanged = fmi2True</code>, then at least one element of the continuous state vector has changed its value due to the function call.
The new values of the states can be retrieved with <code>fmi2GetContinuousStates</code> or individually for each state for which <code>reinit="true"</code> by calling <code>getReal</code>.
If no element of the continuous state vector has changed its value,
<code>valuesOfContinuousStatesChanged</code> must return <code>fmi2False</code>.
<em>[If <code>fmi2True</code> would be returned in this case,
an infinite event loop may occur.]</em><br>
If <code>nextEventTimeDefined = fmi2True</code>,
then the simulation shall integrate at most until <code>time = nextEventTime</code>,
and shall call <code>fmi2EnterEventMode</code> at this time instant.
If integration is stopped before nextEventTime,
for example, due to a state event,
the definition of <code>nextEventTime</code> becomes obsolete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2EnterContinuousTimeMode(fmi2Component c);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>The model enters Continuous-Time Mode and all discrete-time equations become inactive and all relations are "frozen".<br>
This function has to be called when changing from Event Mode (after the global event iteration in Event Mode over all involved FMUs and other models has converged) into Continuous-Time Mode.<br></p>
</div>
<div class="paragraph">
<p><em>[This function might be used for the following purposes:</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>If the FMU stores results internally on file,
then the results after the initialization and/or the event has been processed can be stored.</em></p>
</li>
<li>
<p><em>If the FMU contains dynamically changing states,
then a new state selection might be performed with this function.]</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2CompletedIntegratorStep(fmi2Component c,
                                 fmi2Boolean  noSetFMUStatePriorToCurrentPoint,
                                 fmi2Boolean* enterEventMode,
                                 fmi2Boolean* terminateSimulation);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>This function must be called by the environment after every completed step of the integrator provided the capability flag completedIntegratorStepNotNeeded = false.
Argument noSetFMUStatePriorToCurrentPoint is <code>fmi2True</code> if <code>fmi2SetFMUState</code> will no longer be called for time instants prior to current time in this simulation run [the FMU can use this flag to flush a result buffer].<br>
The function returns enterEventMode to signal to the environment if the FMU shall call <code>fmi2EnterEventMode</code>,
and it returns terminateSimulation to signal if the simulation shall be terminated.
If <code>enterEventMode</code> = <code>fmi2False</code> and <code>terminateSimulation</code> = <code>fmi2False</code> the FMU stays in Continuous-Time Mode without calling <code>fmi2EnterContinuousTimeMode</code> again.
When the integrator step is completed and the states are <span class="underline">modified</span> by the integrator <span class="underline">afterwards</span> (for example, correction by a BDF method),
then <code>fmi2SetContinuousStates(..)</code> has to be called with the updated states <span class="underline">before</span> <code>fmi2CompletedIntegratorStep(..)</code> is called.<br>
When the integrator step is completed and one or more event indicators change sign (with respect to the previously completed integrator step),
then the integrator or the environment has to determine the time instant of the sign change that is closest to the previous completed step up to a certain precision (usually a small multiple of the machine epsilon).
This is usually performed by an iteration where time is varied and state variables needed during the iteration are determined by interpolation.
Function <code>fmi2CompletedIntegratorStep</code> must be called after this state event location procedure and not after the successful computation of the time step by the integration algorithm.
The intended purpose of the function call is to indicate to the FMU that at this stage all inputs and state variables have valid (accepted) values.
After <code>fmi2CompletedIntegratorStep</code> is called,
it is still allowed to go back in time (calling <code>fmi2SetTime</code>) and inquire values of variables at previous time instants with <code>fmi2GetXXX</code> <em>[for example, to determine values of non-state variables at output points]</em>. However,
it is not allowed to go back in time over the previous <code>fmi2CompletedIntegratorStep</code> or the previous <code>fmi2EnterEventMode</code> call.</p>
</div>
<div class="paragraph">
<p><em>[This function might be used, for example, for the following purposes:</em></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Delays:</em><br>
<em>All variables that are used in a "delay(..)" operator are stored in an appropriate buffer and the function returns with <code>enterEventMode</code> = <code>fmi2False</code>, and <code>terminateSimulation</code> = <code>fmi2False</code>.</em></p>
</li>
<li>
<p><em>Dynamic state selection:<br>
It is checked whether the dynamically selected states are still numerically appropriate.
If yes,
the function returns with <code>enterEventMode</code> = <code>fmi2False</code>  otherwise with <code>enterEventMode</code> = <code>fmi2True</code>.</em>
<em>In the latter case, <code>fmi2EnterEventMode(..)</code> has to be called and the states are dynamically changed by a subsequent <code>fmi2NewDiscreteStates(..)</code>.</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Note that this function is not used to detect time or state events,
for example, by comparing event indicators of the previous with the current call of <code>fmi2CompletedIntegratorStep(..)</code>.
These types of events are detected in the environment, and the environment has to call <code>fmi2EnterEventMode(..)</code> independently in these cases,
whether the return argument <code>enterEventMode</code> of <code>fmi2CompletedIntegratorStep(..)</code> is <code>fmi2True</code> or <code>fmi2False</code>.]</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2GetDerivatives    (fmi2Component c, fmi2Real derivatives[],
                                  size_t nx);
fmi2Status fmi2GetEventIndicators(fmi2Component c, fmi2Real eventIndicators[],
                                  size_t ni);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Compute state derivatives and event indicators at the current time instant and for the current states.
The derivatives are returned as a vector with <code>"nx"</code> elements.
A state event is triggered when the domain of an event indicator changes from \(z_j &gt; 0\) to \(z_j \leq 0\) or vice versa.
The FMU must guarantee that at an event restart \(z_j \neq 0\),
for example, by shifting \(z_j\) with a small value.
Furthermore, \(z_j\) should be scaled in the FMU with its nominal value (so all elements of the returned vector <code>"eventIndicators"</code> should be in the order of "one").
The event indicators are returned as a vector with <code>"ni"</code> elements.<br>
The ordering of the elements of the derivatives vector is identical to the ordering of the state vector (for example, <code>derivatives[2]</code> is the derivative of <code>x[2]</code>).
Event indicators are not necessarily related to variables on the Model Description File.<br>
Note that <code>fmi2Status</code> = <code>fmi2Discard</code> is possible for both functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2GetContinuousStates(fmi2Component c, fmi2Real x[], size_t nx);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Return the new (continuous) state vector x.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2GetNominalsOfContinuousStates(fmi2Component c,
                                             fmi2Real x_nominal[], size_t nx);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Return the nominal values of the continuous states.
This function should always be called after calling function <code>fmi2NewDiscreteStates</code> if it returns with <code>eventInfo&#8594;nominalsOfContinuousStatesChanged = fmi2True</code>, since then the nominal values of the continuous states have changed
<em>[for example, because the association of the continuous states to variables has changed due to internal dynamic state selection]</em>.
If the FMU does not have information about the nominal value of a continuous state i,
a nominal value <code>x_nominal[i] = 1.0</code> should be returned.
Note that it is required that <code>x_nominal[i] &gt; 0.0</code>.
<em>[Typically, the nominal values of the continuous states are used to compute the absolute tolerance required by the integrator.
Example:<br>
<code>absoluteTolerance[i] = 0.01*tolerance*x_nominal[i];</code>]</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_state_machine_of_calling_sequence">3.2.3. State Machine of Calling Sequence</h4>
<div class="paragraph">
<p>Every implementation of the FMI must support calling sequences of the functions according to the following state chart:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/CallingSequenceME.png" alt="CallingSequenceME" width="100%">
</div>
<div class="title">Figure 1. Calling sequence of Model Exchange C functions in form of an UML 2.0 state machine.</div>
</div>
<div class="paragraph">
<p>The objective of the start chart is to define the allowed calling sequences for functions of the FMI: Calling sequences not accepted by the state chart are not supported by the FMI.
The behavior of an FMU is undefined for such a calling sequence.
For example, the state chart indicates that when an FMU for Model Exchange is in state "Continuous-Time Mode",
a call to <code>fmi2SetReal</code> for a discrete input is not supported.
The state chart is given here as UML 2.0 state machine.
If a transition is labelled with one or more function names (for example, <code>fmi2GetReal</code>,
<code>fmi2GetInteger</code>), this means that the transition is taken if any of these functions is successfully called.
Note that the FMU can always determine in which state it is since every state is entered by a particular function call (such as <code>fmi2EnterEventMode</code>),
or a particular return value (such as <code>fmi2Fatal</code>).
<em>[Bugfix in FMI 2.0.1: Note that there was an inconsistency in FMI 2.0 in the state graph and the table regarding if <code>fmi2GetEventIndicators</code> is allowed to be called in <code>initializationMode</code>.
The table (see further down) is correct and <code>fmi2GetEventIndicators</code> can be called in <code>initializationMode</code>.  Additionally the function fmi2GetDerivatives may by called in <code>initializationMode</code>.]</em></p>
</div>
<div class="paragraph">
<p>The transition conditions <code>external event</code>, <code>time event</code>, and <code>state event</code> are defined in section 3.1.
Each state of the state machine corresponds to a certain phase of a simulation as follows:</p>
</div>
<div class="paragraph">
<p><strong>Instantiated:</strong><br>
In this state,
start and guess values of variables that have <code>initial = "exact"</code> or <code>"approx"</code> and <code>variability</code> ≠ <code>"constant"</code> can be set,
this does not include inputs as they do not have an <code>initial</code> attribute.</p>
</div>
<div class="paragraph">
<p><strong>Initialization Mode:</strong><br>
In this state, equations are active to determine all continuous-time states,
as well as all outputs (and optionally other variables exposed by the exporting tool).
The variables that can be retrieved by <code>fmi2GetXXX</code> calls are (1) defined in the XML file under <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code> and (2) variables with <code>causality</code> = <code>"output"</code>.
Variables with <code>initial</code> = <code>"exact"</code> and <code>variability</code> ≠ <code>"constant"</code>,
as well as variables with <code>causality</code> = <code>"input"</code> can be set.</p>
</div>
<div class="paragraph">
<p><strong>Continuous-Time Mode:</strong><br>
In this state, the continuous-time model equations are active and integrator steps are performed.
The event time of a state event may be determined if a domain change of at least one event indicator is detected at the end of a completed integrator step.</p>
</div>
<div class="paragraph">
<p><strong>Event Mode:</strong><br>
If an event is triggered in Continuous-Time Mode,
then Event Mode is entered by calling <code>fmi2EnterEventMode</code>.
In this mode all continuous-time and discrete-time equations are active and the unknowns at an event can be computed and retrieved.
After an event is completely processed,
<code>fmi2NewDiscreteStates</code> must be called and depending on the return argument,
<code>newDiscreteStatesNeeded</code>,
the state chart stays in Event Mode or switches to Continuous-Time Mode.
When the Initialization Mode is terminated with <code>fmi2ExitInitializationMode</code>,
then Event Mode is directly entered,
and the continuous-time and discrete-time variables at the initial time are computed based on the initial continuous-time states determined in the Initialization Mode</p>
</div>
<div class="paragraph">
<p><strong>terminated:</strong><br>
In this state, the solution at the final time of a simulation can be retrieved.</p>
</div>
<div class="paragraph">
<p>Note that simulation backward in time is only allowed over continuous time intervals.
As soon as an event occurred (<code>fmi2EnterEventMode</code> was called), going back in time is forbidden,
because <code>fmi2EnterEventMode</code> / <code>fmi2NewDiscreteStates</code> can only compute the next discrete state,
not the previous one.</p>
</div>
<div class="paragraph">
<p>Note that during Initialization, Event, and Continuous-Time Mode input variables can be set with <code>fmi2SetXXX</code>
and output variables can be retrieved with <code>fmi2GetXXX</code> interchangeably according to the model structure defined under element <code>&lt;ModelStructure&gt;</code> in the XML file.
<em>[For example, if one output <code>y1</code> depends on two inputs <code>u1</code>, <code>u2</code>,
then these two inputs must be set, before <code>y1</code> can be retrieved.
If additionally an output <code>y2</code> depends on an input <code>u3</code>,
then <code>u3</code> can be set and <code>y2</code> can be retrieved afterwards.
As a result, artificial or "real" algebraic loops over connected FMUs in any of these three modes can be handled by using appropriate numerical algorithms.]</em></p>
</div>
<div class="paragraph">
<p>The allowed function calls in the respective states are summarized in the following table
(functions marked in "<span class="yellow-background">yellow</span>" are only available for "Model Exchange",
the other functions are available both for "Model Exchange" and "Co-Simulation"):</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<colgroup>
<col style="width: 55.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.5555%;">
<col style="width: 5.556%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom" rowspan="2"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock"><strong>FMI 2.0 for Model Exchange</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">start, end</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">instantiated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Initialization Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Event Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Continuous-Time Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">terminated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">error</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">fatal</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetTypesPlatform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetDebugLogging</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2Instantiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2FreeInstance</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetupExperiment</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2EnterInitializationMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2ExitInitializationMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2Terminate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2Reset</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2FreeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SerializedFMUstateSize</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SerializeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2DeSerializeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetDirectionalDerivative</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2EnterEventMode               </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2NewDiscreteStates             </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2EnterContinuousTimeMode       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2CompletedIntegratorStep       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2SetTime                       </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2SetContinuousStates           </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetEventIndicators            </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetContinuousStates           </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetDerivatives                </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetNominalsOfContinuousStates </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>x</strong> means: call is allowed in the corresponding state<br>
<strong>number</strong> means: call is allowed if the indicated condition holds:<br>
<strong>1</strong> for a variable with <code>variability</code> \(\neq\) <code>"constant"</code> that has <code>initial</code> =
<code>"exact"</code> or <code>"approx"</code><br>
<strong>2</strong> for a variable with <code>causality = "output"</code>, or continuous-time states or state derivatives<br>
<strong>3</strong> for a variable with <code>variability</code> \(\neq\) <code>"constant"</code> that has <code>initial</code> = <code>"exact"</code>,
or <code>causality</code> = <code>"input"</code><br>
<strong>4</strong> for a variable with <code>causality</code> = <code>"input"</code>,
or (<code>causality</code> = <code>"parameter"</code> and <code>variability</code> = <code>"tunable"</code>)<br>
<strong>5</strong> for a variable with <code>causality</code> = <code>"input"</code> and <code>variability</code> = <code>"continuous"</code>, and for a continuous-time state variable<br>
<em>[Clarification in FMI 2.0.1: This rule regarding a continuous-time state variable is not shown in the state machine diagram above but shall be applied.]</em><br>
<strong>7</strong> always, but retrieved values are usable for debugging only<br>
<strong>8</strong> only for a Pure Discrete-Time FMU. This exits the current event mode and sets the time for the next event instant. <code>fmi2NewDiscreteStates</code> must have been called with <code>newDiscreteStatesNeeded</code> = <code>fmi2False</code> at least once before this can be done:</p>
</div>
</div>
<div class="sect3">
<h4 id="_pseudocode_example">3.2.4. Pseudocode Example</h4>
<div class="paragraph">
<p>In the following example,
the usage of the <code>fmi2XXX</code> functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
The example is given in a mix of pseudocode and C,
in order to keep it small and understandable.
Furthermore, it is assumed that one FMU is directly integrated in a simulation environment.
If the FMU would be used inside another model,
additional code is needed,
especially initialization and event iteration has to be adapted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">m = M_fmi2Instantiate("m", ...)  // "m" is the instance name
                                 // "M_" is the MODEL_IDENTIFIER
nx = ...         // number of states, from XML file
nz = ...         // number of event indicators, from XML file
Tstart = 0       // could also be retrieved from XML file
Tend = 10        // could also be retrieved from XML file
dt = 0.01        // fixed step size of 10 milli-seconds

// set the start time
time = TStart

// set all variable start values (of "ScalarVariable / &lt;type&gt; / start") and
// set the start values at time = Tstart
M_fmi2SetReal/Integer/Boolean/String(m, ...)

// initialize
// determine continuous and discrete states
M_fmi2SetupExperiment(m, fmi2False, 0.0, Tstart, fmi2True, Tend)
M_fmi2EnterInitializationMode(m)
M_fmi2ExitInitializationMode(m)

initialEventMode = fmi2True
enterEventMode = fmi2False
timeEvent = fmi2False
stateEvent = fmi2False
previous_z = zeros(nz)


// retrieve initial state x and
// nominal values of x (if absolute tolerance is needed)
M_fmi2GetContinuousStates(m, x, nx)
M_fmi2GetNominalsOfContinuousStates(m, x_nominal, nx)

// retrieve solution at t=Tstart, for example, for outputs
M_fmi2GetReal/Integer/Boolean/String(m, ...)


do
  // handle events
  if initialEventMode or enterEventMode or timeEvent or stateEvent then
    if not initialEventMode then
      M_fmi2EnterEventMode(m)
    end if
    // event iteration
    eventInfo.newDiscreteStatesNeeded = fmi2True;
    valuesOfContinuousStatesChanged   = fmi2False;
    nominalsOfContinuousStatesChanged = fmi2False
    while eventInfo.newDiscreteStatesNeeded loop
      // set inputs at super dense time point
      M_fmi2SetReal/Integer/Boolean/String(m, ...)
      // update discrete states
      M_fmi2NewDiscreteStates(m, &amp;eventInfo)
      // getOutput at super dense time point
      M_fmi2GetReal/Integer/Boolean/String(m, ...)
      valuesOfContinuousStatesChanged =
      valuesOfContinuousStatesChanged or eventInfo.valuesOfContinuousStatesChanged;
      nominalsOfContinuousStatesChanged =
      nominalsOfContinuousStatesChanged or eventInfo.nominalsOfContinuousStatesChanged;
      if eventInfo.terminateSimulation then goto TERMINATE_MODEL
    end while

    // enter Continuous-Time Mode
    M_fmi2EnterContinuousTimeMode(m)
    // retrieve solution at simulation (re)start
    M_fmi2GetReal/Integer/Boolean/String(m, ...)
    if initialEventMode or valuesOfContinuousStatesChanged then
      // the model signals a value change of states, retrieve them
      M_fmi2GetContinuousStates(m, x, nx)
    end if

    if initialEventMode or nominalsOfContinuousStatesChanged then
      // the meaning of states has changed; retrieve new nominal values
      M_fmi2GetNominalsOfContinuousStates(m, x_nominal, nx)
    end if

    if eventInfo.nextEventTimeDefined then
      tNext = min(eventInfo.nextEventTime, Tend)
    else
      tNext = Tend
    end if
    initialEventMode = fmi2False
  end if

  if time &gt;= Tend then
   goto TERMINATE_MODEL
  end if

  // compute derivatives
  M_fmi2GetDerivatives(m, der_x, nx)

  // advance time
  h    = min(dt, tNext-time)
  time = time + h
  M_fmi2SetTime(m, time)

  // set continuous inputs at t = time
  M_fmi2SetReal(m, ...)

  // set states at t = time and perform one step
  x = x + h * der_x // forward Euler method
  M_fmi2SetContinuousStates(m, x, nx)

  // get event indicators at t = time
  M_fmi2GetEventIndicators(m, z, nz)

  // detect  events, if any
  timeEvent = time &gt;= tNext
  stateEvent = sign(z) &lt;&gt; sign(previous_z) or previous_z != 0 &amp;&amp; z == 0
  previous_z = z

  // inform the model about an accepted step
  M_fmi2CompletedIntegratorStep(m, fmi2True, &amp;enterEventMode, &amp;terminateSimulation)
  // get continuous output
  M_fmi2GetReal(m, ...)
until terminateSimulation

// terminate simulation and retrieve final values
TERMINATE_MODEL:
M_fmi2Terminate(m)
M_fmi2GetReal/Integer/Boolean/String(m, ...)

// cleanup
M_fmi2FreeInstance(m)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above, errors are not handled. Typically, <code>fmi2XXX</code> function calls are performed in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">status = M_fmi2GetDerivatives(m, der_x, nx);
switch ( status ) { case fmi2Discard: ....; break; // reduce step size and try again
                    case fmi2Error  : ....; break; // cleanup and stop simulation
                    case fmi2Fatal  : ....; }      // stop using the model</code></pre>
</div>
</div>
<div class="paragraph">
<p>The switch statement could also be stored in a macro to simplify the code.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_description_schema_2">3.3. FMI Description Schema</h3>
<div class="paragraph">
<p>This is defined in 2.2.
Additionally, the Model Exchange-specific element "ModelExchange" is defined in the next section.</p>
</div>
<div class="sect3">
<h4 id="_model_exchange_fmu_modelexchange">3.3.1. Model Exchange FMU (ModelExchange)</h4>
<div class="paragraph">
<p>If the XML file defines an FMU for Model Exchange, element "ModelExchange" must be present.
It is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/model_exchange_schema_1.png" alt="model exchange schema 1" width="80%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/model_exchange_schema_2.png" alt="model exchange schema 2" width="70%">
</div>
</div>
<div class="paragraph">
<p>The following attributes are defined (all of them are optional,
with exception of <code>"modelIdentifier"</code>):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax,
for example, "A_B_C".
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries,
but not if the functions are provided by a DLL/SharedObject.
<code>modelIdentifier</code> is also used as name of the static library or DLL/SharedObject.
See also section 2.1.1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsExecutionTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>,
a tool is needed to execute the model and the FMU just contains the communication to this tool.
<em>[Typically, this information is only utilized for information purposes.
For example, when loading an FMU with <code>needsExecutionTool = "true"</code>,
the environment can inform the user that a tool has to be available on the computer where the model is instantiated.
The name of the tool can be taken from attribute generationTool of fmiModelDescription.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>completedIntegratorStepNotNeeded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>,
function <code>fmi2CompletedIntegratorStep</code> need not be called (this gives a slightly more efficient integration).
If it is called, it has no effect.<br>
If <code>false</code> (the default),
the function must be called after every completed integrator step,
see section 3.2.2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeInstantiatedOnlyOncePerProcess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag indicates cases (especially for embedded code),
where only one instance per FMU is possible
(multiple instantiation is default = <code>false</code>;
if multiple instances are needed and the flag <code>canBeInstantiatedOnlyOncePerProcess = "true"</code>,
the FMUs must be instantiated in different processes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canNotUseMemoryManagementFunctions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the FMU uses its own functions for memory allocation and freeing only.
The callback functions <code>allocateMemory</code> and <code>freeMemory</code> given in <code>fmi2Instantiate</code> are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canGetAndSetFMUstate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can inquire the internal FMU state and can restore it.
That is, functions <code>fmi2GetFMUstate</code>, <code>fmi2SetFMUstate</code>,
and <code>fmi2FreeFMUstate</code> are supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canSerializeFMUstate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the environment can serialize the internal FMU state,
in other words, functions <code>fmi2SerializedFMUstateSize</code>, <code>fmi2SerializeFMUstate</code>,
<code>fmi2DeSerializeFMUstate</code> are supported by the FMU.
If this is the case, then flag <code>canGetAndSetFMUstate</code> must be true as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesDirectionalDerivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>true</code>, the directional derivative of the equations can be computed with <code>fmi2GetDirectionalDerivative(..)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The flags have the following default values.</p>
</div>
<div class="paragraph">
<p>boolean: false<br>
unsignedInt: 0</p>
</div>
</div>
<div class="sect3">
<h4 id="_example_xml_description_file">3.3.2. Example XML Description File</h4>
<div class="paragraph">
<p>When generating an FMU from the hypothetical model "MyLibrary.SpringMassDamper",
the XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="2.0"
  modelName="MyLibrary.SpringMassDamper"
  guid="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"
  numberOfEventIndicators="2"&gt;
  &lt;ModelExchange modelIdentifier="MyLibrary_SpringMassDamper"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="N.m"&gt;
      &lt;BaseUnit kg="1" m="2" s="-2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;SimpleType name="Modelica.SIunits.Inertia"&gt;
      &lt;Real quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.Torque"&gt;
      &lt;Real quantity="Torque" unit="N.m"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.AngularVelocity"&gt;
      &lt;Real quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.Angle"&gt;
      &lt;Real quantity="Angle" unit="rad"/&gt;
    &lt;/SimpleType&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;ScalarVariable name="inertia1.J" valueReference="1073741824" description="Moment of load inertia" causality="parameter" variability="fixed"&gt;
      &lt;Real declaredType="Modelica.SIunits.Inertia" start="1"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;!--index="1" --&gt;
    &lt;ScalarVariable name="torque.tau" valueReference="536870912" description="Accelerating torque acting at flange (= -flange.tau)" causality="input"&gt;
      &lt;Real declaredType="Modelica.SIunits.Torque" start="0"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;!--index="2" --&gt;
    &lt;ScalarVariable name="inertia1.phi" valueReference="805306368" description="Absolute rotation angle of component" causality="output"&gt;
      &lt;Real declaredType="Modelica.SIunits.Angle"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;!--index="3" --&gt;
    &lt;ScalarVariable name="inertia1.w" valueReference="805306369" description="Absolute angular velocity of component (= der(phi))" causality="output"&gt;
      &lt;Real declaredType="Modelica.SIunits.AngularVelocity"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;!--index="4" --&gt;
    &lt;ScalarVariable name="x[1]" valueReference="0" ,="," initial = "exact"&gt;
      &lt;Real start="0"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;!--index="5" --&gt;
    &lt;ScalarVariable name="x[2]" valueReference="1" ,="," initial = "exact"&gt;
      &lt;Real start="0"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;!--index="6" --&gt;
    &lt;ScalarVariable name="der(x[1])" valueReference="2"&gt;
      &lt;Real derivative="5"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;!--index="7" --&gt;
    &lt;ScalarVariable name="der(x[2])" valueReference="3"&gt;
      &lt;Real derivative="6"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;!--index="8" --&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Outputs&gt;
      &lt;Unknown index="3"/&gt;
      &lt;Unknown index="4"/&gt;
    &lt;/Outputs&gt;
    &lt;Derivatives&gt;
      &lt;Unknown index="7"/&gt;
      &lt;Unknown index="8"/&gt;
    &lt;/Derivatives&gt;
    &lt;InitialUnknowns&gt;
      &lt;Unknown index="3"/&gt;
      &lt;Unknown index="4"/&gt;
      &lt;Unknown index="7" dependencies="5 2"/&gt;
      &lt;Unknown index="8" dependencies="5 6"/&gt;
    &lt;/InitialUnknowns&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fmi_for_cosimulation">4. FMI for Co‑Simulation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the Functional Mock-up Interface (FMI) for the coupling of two or more simulation models in a co-simulation environment (FMI for Co-Simulation).
Co-simulation is a rather general approach to the simulation of coupled technical systems and coupled physical phenomena in engineering with focus on instationary (time-dependent) problems.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation is designed both for coupling with subsystem models,
which have been exported by their simulators together with its solvers as runnable code (Figure 7),
and for coupling of simulation tools (simulator coupling,
tool coupling (Figure 8 and Figure 7)).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/figure7.png" alt="figure7" width="50%">
</div>
<div class="title">Figure 7: Co-simulation with generated code on a single computer (for simplicity shown for one slave only).</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/figure8.png" alt="figure8" width="70%">
</div>
<div class="title">Figure 8: Co-simulation with tool coupling on a single computer (for simplicity shown for one slave only).</div>
</div>
<div class="paragraph">
<p>In the tool coupling case the FMU implementation wraps the FMI function calls to API calls which are provided by the simulation tool (for example, a COM or CORBA API).
Additionally to the FMU the simulation tool is needed to run a co-simulation.</p>
</div>
<div class="paragraph">
<p>In its most general form,
a tool coupling based co-simulation is implemented on distributed hardware with subsystems being handled by different computers with different OS
(cluster computer, computer farm, computers at different locations).
The data exchange and communication between the subsystems is typically done using one of the network communication technologies (for example, MPI, TCP/IP).
The definition of this communication layer is not part of the FMI standard.
However, distributed co-simulation scenarios can be implemented using FMI as shown in Figure 9.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/figure9.png" alt="figure9" width="90%">
</div>
<div class="title">Figure 9: Distributed co-simulation infrastructure (for simplicity shown for one slave only).</div>
</div>
<div class="paragraph">
<p>The master has to implement the communication layer.
Additional parameters for establishing the network communication (for example, identification of the remote computer, port numbers, user account) are to be set via the GUI of the master.
These data are not transferred via the FMI API.</p>
</div>
<div class="sect2">
<h3 id="_mathematical_description_2">4.1. Mathematical Description</h3>
<div class="sect3">
<h4 id="_basics">4.1.1. Basics</h4>
<div class="paragraph">
<p>Co-simulation exploits the modular structure of coupled problems in all stages of the simulation process beginning with the separate model setup and preprocessing for the individual <em>subsystems</em> in different <em>simulation tools</em> (which can be powerful simulators as well as simple C programs).
During time integration,
the simulation is again performed independently for all subsystems restricting the data exchange between subsystems to discrete <em>communication points</em> \(tc_i\).
For simulator coupling,
also the visualization and post-processing of simulation data is done individually for each subsystem in its own native simulation tool.
In different contexts, the communication points \(tc_i\),
the <em>communication steps</em> \(tc_i \rightarrow tc_{i+1}\) and the <em>communication step sizes</em> \(hc_i := tc_{i+1} - tc_i\) are also known as sampling points (synchronization points),
macro steps and sampling rates, respectively.
The term "communication point" in FMI for Co-Simulation refers to the communication between subsystems in a co-simulation environment and should not be mixed with the output points for saving simulation results to file.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation provides an interface standard for the solution of time dependent <em>coupled systems</em> consisting of subsystems that are continuous in time
(model components that are described by instationary differential equations)
or time-discrete (model components that are described by difference equations such as discrete controllers).
In a block representation of the coupled system,
the subsystems are represented by blocks with (internal) <em>state variables</em> \(x(t)\) that are connected to other subsystems (blocks) of the coupled problem by <em>subsystem inputs</em> \(u(t)\) and <em>subsystem outputs</em>  \(y(t)\).
In this framework,
the physical connections between subsystems are represented by mathematical coupling conditions between the inputs \(u(t)\) and the outputs \(y(t)\) of all subsystems,
<em>Kübler and Schiehlen (2000)</em>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/figure10.svg" alt="figure10" width="80%">
</div>
<div class="title">Figure 10: Data flow at communication points.</div>
</div>
<div class="paragraph">
<p>For co-simulation two basic groups of functions have to be realized:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>functions for the data exchange between subsystems</p>
</li>
<li>
<p>functions for algorithmic issues to synchronize the simulation of <em>all</em> subsystems and to proceed in communication steps \(tc_i \rightarrow tc_{i+1}\) from initial time \(tc_0 := t_{start}\) to end time \(tc_N := t_{stop}\)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In FMI for Co-Simulation, both functions are implemented in one software component,
the co-simulation <em>master</em>.
The data exchange between the subsystems (<em>slaves</em>) is handled via the master only.
There is no direct communication between the slaves.
The master functionality can be implemented by a special software tool (a separate simulation backplane) or by one of the involved simulation tools.
In its most general form,
the coupled system may be simulated in <em>nested</em> co-simulation environments and FMI for Co-Simulation applies to each level of the hierarchy.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation defines interface routines for the communication between the master and all slaves (subsystems) in a co-simulation environment.
The most common master algorithm stops at each communication point \(tc_i\) the simulation
(time integration) of all slaves,
collects the outputs \(y(tc_i)\) from all subsystems,
evaluates the subsystem inputs \(u(tc_i)\),
distributes these subsystem inputs to the slaves and continues the (co-)simulation with the next communication step \(tc_i \rightarrow tc_{i+1} = tc_i + hc\) with fixed communication step size \(hc\).
In each slave,
an appropriate solver is used to integrate one of the subsystems for a given communication step \(tc_i \rightarrow tc_{i+1}\).
The most simple co-simulation algorithms approximate the (unknown) subsystem inputs \(u(t),
(t &gt; tc_i))\) by frozen data \(u(tc_i)\) for \(tc_i \leq t &lt; tc_{i+1}\).
FMI for Co-Simulation supports this classical brute force approach as well as more sophisticated master algorithms.
FMI for Co-Simulation is designed to support a very general class of master algorithms but it does <em>not</em> define the master algorithm itself.</p>
</div>
<div class="paragraph">
<p>The ability of slaves to support more sophisticated master algorithms is characterized by a set of <em>capability flags</em> inside the XML description of the slave (see section 4.3.1).
Typical examples are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the ability to handle variable communication step sizes \(hc_i\),</p>
</li>
<li>
<p>the ability to repeat a rejected communication step \(tc_i \rightarrow tc_{i+1}\) with reduced communication step size,</p>
</li>
<li>
<p>the ability to provide derivatives w.r.t. time of outputs to allow interpolation (section 4.2.1),</p>
</li>
<li>
<p>or the ability to provide Jacobians.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation is restricted to slaves with the following
properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All calculated values are time dependent functions within an a priori defined time interval \(t_{start} \leq t \leq t_{stop}\) (provided <code>stopTimeDefined = fmi2True</code> when calling <code>fmi2SetupExperiment</code>).</p>
</li>
<li>
<p>All calculations (simulations) are carried out with increasing time in general.
The current time \(t\) is running step by step from \(t_{start}\) to \(t_{stop}\).
The algorithm of the slave may have the property to be able to repeat the simulation of parts of \([t_{start}, t_{stop}\)] or the whole time interval \([t_{start}, t_{stop}\)].</p>
</li>
<li>
<p>The slave can be given a time value \(tc_i, t_{start} \leq tc_i \leq t_{stop}\).</p>
</li>
<li>
<p>The slave is able to interrupt the simulation when \(tc_i\) is reached.</p>
</li>
<li>
<p>During the interrupted simulation the slave (and its individual solver) can receive values for inputs \(u(tc_i)\) and send values of outputs \(y(tc_i)\).</p>
</li>
<li>
<p>Whenever the simulation in a slave is interrupted, a new time value \(tc_{i+1},
tc_i \leq tc_{i+1} \leq t_{stop}\),
can be given to simulate the time subinterval \(tc_i &lt; t \leq tc_{i+1}\)</p>
</li>
<li>
<p>The subinterval length \(hc_i\) is the communication step size of the \(i^{th}\) communication step, \(hc_i = tc_{i+1} - tc_i\).
The communication step size has to be greater than zero.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation allows a co-simulation flow which starts with instantiation and initialization (all slaves are prepared for computation,
the communication links are established),
followed by simulation (the slaves are forced to simulate a communication step),
and finishes with shutdown.
The details of the flow are given in the state machine of the calling sequences from master to slave (see section 4.2.4).</p>
</div>
</div>
<div class="sect3">
<h4 id="_mathematical_model">4.1.2. Mathematical Model</h4>
<div class="paragraph">
<p>This section contains a formal mathematical model of a Co-Simulation FMU.
The following fundamental assumptions are made:</p>
</div>
<div class="paragraph">
<p>The slave simulators are seen by the master simulator as purely sampled-data systems.
Such a sampled-data system can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A "real" sampled-data system (so a sampled discrete controller; the inputs and outputs can be of type Real, Integer, Boolean, String, or enumeration.
Variables of this type are defined with <code>variability = "discrete"</code>; the smallest sample period as accessible by the outside of the FMU is defined by attribute <code>stepSize</code> in element <code>DefaultExperiment</code>).</p>
</li>
<li>
<p>A hybrid ODE that is integrated between communication points (known as "sampled access to time continuous systems") where internal events may occur and be handled,
but events are not visible from the outside of the FMU.
It is assumed here that all inputs and all outputs of this hybrid ODE are Real signals (defined with <code>variability = "continuous"</code>),</p>
</li>
<li>
<p>A combination of the systems above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The communication between the master and a slave takes only place at a discrete set of time instants,
called <em>communication points</em>.</p>
</div>
<div class="paragraph">
<p>An FMI Co-Simulation model is described by the following variables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 87.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><em>Variable</em></th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(t\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Independent variable time \(\in \mathbb{R}\).
(Variable defined with <code>causality = "independent"</code>).<br>
The i-th communication point is denoted as \(t = tc_i\)<br>
The communication step size is denoted as \(hc_i = tc_{i+1} - tc_i\)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{v}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of all exposed variables (all variables defined in element <code>&lt;ModelVariables&gt;</code>, see section 2.2.7).
A subset of the variables is selected via a subscript.
Example:<br>
\(\mathbf{v}_{initial=exact}\) are variables defined with attribute <code>initial = "exact"</code>,
see section 2.2.7.
These are independent parameters and start values of other variables,
such as initial values for states, state derivatives or outputs.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{p}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameters that are constant during simulation.
The symbol without a subscript references independent parameters (variables with <code>causality = "parameter"</code>).
Dependent parameters (variables with <code>causality = "calculatedParameter"</code>) are denoted as \(\mathbf{p}_{calculated}\) and tunable parameters (variables with <code>causality = "parameter"</code> and <code>variability = "tunable"</code>) are denoted as \(\mathbf{p}_{tune}\).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{u}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input variables.
The values of these variables are defined outside of the model.
Variables of this type are defined with attribute <code>causality = "input"</code>.
Whether the input is a discrete-time or
continuous-time variable is defined via attribute <code>variability = "discrete"</code> or
<code>"continuous"</code> (see section 2.2.7).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{y}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output variables.
The values of these variables are computed in the FMU
and they are designed to be used in a model connection.
So output variables might be used in the environment as
input values to other FMUs or other submodels.
Variables of this type are defined with attribute <code>causality = "output"</code>.
Via attribute <code>variability = "discrete"</code> or <code>"continuous"</code> it is defined whether the
output is a discrete-time or continuous-time variable,
see section 2.2.7.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{w}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local variables of the FMU that cannot be used for FMU connections.
Variables of this type are defined with attribute <code>causality = "local"</code> (see section 2.2.7).</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_c(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A vector of real continuous-time variables representing the continuous-time states.
For notational convenience, a continuous-time state is conceptually
treated as a different type of variable as an output or a local variable
for the mathematical description below.
However, at a communication point, a continuous-time state is part of
the outputs or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\)<br>
\(^{\bullet}\mathbf{x}_d(t)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\(\mathbf{x}_d(t)\) is a vector of (internal) discrete-time variables (of any type) representing the (internal) discrete states.<br>
\(^{\bullet}\mathbf{x}_d(t)\) is the value of \(\mathbf{x}_d(t)\) at the previous sample time instant,
so \(^{\bullet}\mathbf{x}_d(t) = \mathbf{x}_d(^{\bullet}t)\).<br>
Given the previous values of the discrete-time states,
\(^{\bullet}\mathbf{x}_d(t)\),
at the actual time instant \(t\),
all other discrete-time variables,
especially the discrete states \(\mathbf{x}_d(t)\),
can be computed.<br>
Discrete states are not visible in the interface of an FMU and are only introduced here to clarify the mathematical description.
Formally, a discrete state is part of the outputs \(\mathbf{y}\) or the local variables \(\mathbf{w}\) of an FMU.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the transient simulation of the coupled system through co-simulation is completed,
the sequence of evaluations is the following (here \(\mathbf{x} = {\lbrack \mathbf{x}_c; \mathbf{x}_d \rbrack}^T\) is the combined vector of continuous-time and discrete-time states,
and \(\mathbf{y} = {\lbrack \mathbf{y}_c; \mathbf{y}_d \rbrack}^T\)) is the combined vector of continuous-time and discrete-time outputs):</p>
</div>
<div class="stemblock">
<div class="title">(4.1)</div>
<div class="content">
\[\mathrm{\text{for}}\ i = 0, \cdots, n-1

\begin{Bmatrix}

\mathbf{x}_{i+1} = \Phi_i \left( \mathbf{x}_i \left\{ \mathbf{u}_i^{(j)} \right\}_{j=0,\cdots,m_{ido}}, \mathbf{p}_{tune,i}, hc_i  \right)

\\

\left( \left\{ \mathbf{y}^{(j)}_{i+1} \right\}_{j=0,\cdots,m_{odo}}, \mathbf{w}_{i+1}\right) = \Gamma_i \left( \mathbf{x}_i, \left\{ \mathbf{u}^{(j)}_i \right\}_{j=0,\cdots,m_{ido}}, \mathbf{p}_{tune}, hc_i \right)

\end{Bmatrix}\]
</div>
</div>
<div class="paragraph">
<p>where \(\mathbf{\Phi}_i\) and \(\mathbf{\Gamma}_i\) define the system behavior for the time interval \(tc_i \leq t &lt; tc_{i+1}\),
with \(tc_i = tc_0 + \sum_{k=0}^{i-1}hc_k\).</p>
</div>
<div class="paragraph">
<p><em>[For the part of the co-simulation slave that is based on an ODE,
a differential equation is solved between communication points:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\dot{\mathbf{x}}_c = \mathbf{\varphi} \left( \mathbf{x}_c(t), \mathbf{u}_c(t),
\mathbf{p}_{tune} \right)\]
</div>
</div>
<div class="paragraph">
<p><em>In this case,
the following relationship should hold (note the use of</em> \(\mathbf{x}_{i+1}\) <em>here):</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{\partial\mathbf{\Phi_i}}{\partial hc_i}
=
\boldsymbol{\varphi} \left( \mathbf{x}_{c,i+1},
\sum^{m_{ido}}_{j=0} \mathbf{u}^{(j)}_{c,i} \frac{hc^j_i}{j!},
\mathbf{p}_{tune,i}  \right)\]
</div>
</div>
<div class="paragraph">
<p><em>This relation is in practice inexact due to using finite precision on machines and stopping iterations early.
The slave simulators are responsible for implementing</em> \(\mathbf{\Phi}_i\) <em>and</em> \(\mathbf{\Gamma}_i\)<em>;
for example, to handle stiff differential equations as:</em></p>
</div>
<div class="stemblock">
<div class="content">
\[\mathbf{\Phi}_i \left( \mathbf{x}_{c,i}, \left\{ \mathbf{u}_{c,i}^{(j)} \right\}_{= 0,\cdots,m_{ido}},\ \mathbf{p}_{tune,i}, tc_i \right)
=
\mathbf{x}_{ci} + \left( \mathbf{I} -
hc_i \frac{\partial \mathbf{\varphi}}{\partial \mathbf{x}_c} \right)^{- 1}  hc_i \mathbf{\phi} \left( \mathbf{x}_{c,i}, \mathbf{u}_{c,i}, \mathbf{p}_{tune,i} \right) +
O(hc_i^{2}).\]
</div>
</div>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>Definition (4.1) is consistent with the definition of co-simulation by
(Kübler, Schiehlen 2000).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the communication points, the master provides generalized inputs to the slave, which can be:</p>
<div class="ulist">
<ul>
<li>
<p>The current input variables \(\mathbf{u}_i^{(0)}\) of the subsystem
(in other words, the input variables of the model contained in the slave simulator,
in the sense of system-level simulation),
along with some of their successive derivatives \(\left\{ \mathbf{u}_i^{(j)} \right\}_{j=1,\cdots,m_{ido}}\) (in case of continuous-time variables), where \(m_{ido}\) stands for the model input derivative order.</p>
</li>
<li>
<p>Varying parameters \(\mathbf{p}_{tune,i}\), also known as tunable parameters.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The slave provides generalized outputs to the master, which are:</p>
<div class="ulist">
<ul>
<li>
<p>The current output variables \(\mathbf{y}_{i+1}^{(0)}\)of the subsystem (same remark as above),
along with some of their successive derivatives \(\left\{ \mathbf{y}_{i+1}^{(j)} \right\}_{j=1,\cdots,m_{odo}}\)(in case of continuous-time variables).</p>
</li>
<li>
<p>Observation variables and "calculated" varying parameters \(\mathbf{w}_{i+1}\),
along with directional derivatives estimated at \(t = tc_{i+1}\) (in case of continuous-time variables).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Initialization: The slave being a sampled-data system,
its internal states (which can be either continuous-time or discrete-time)
need to be initialized at \(t = tc_0\).
This is performed through an auxiliary function <em>[this relationship is defined in the XML file under <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code>]</em>:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Computing the solution of an FMI Co-Simulation model means to split the
solution process in two phases and in every phase different equations
and solution methods are utilized.
The phases can be categorized according to the following modes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Initialization Mode:</strong><br>
This mode is used to compute at the start time \(t_0\) initial values for internal variables of the Co-Simulation slave,
especially for continuous-time states,
\(\mathbf{x}_d(t_0)\),
and for the previous discrete-time states,
\(^{\bullet}\mathbf{x}_d(t_0)\),
by utilizing extra equations not present in the other mode <em>[for example, equations to set all derivatives to zero, that is, to initialize in steady-state]</em>.
If the slave is connected in loops with other models,
iterations over the FMU equations are possible.
Algebraic equations are solved in this mode.</p>
</li>
<li>
<p><strong>Step</strong> <strong>Mode:</strong><br>
This mode is used to compute the values of all (real) continuous-time and discrete-time variables at communication points by numerically solving ordinary differential,
algebraic and discrete equations.
If the slave is connected in loops with other models,
no iterations over the FMU equations are possible.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>[Note that for a Co-Simulation FMU,
no super dense time description is used at communication points.]</em></p>
</div>
<div class="paragraph">
<p>The equations are defined in Table 2 can be evaluated in the respective Mode.
The following color coding is used in the table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 88.8889%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="silver"><strong>grey</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a variable in an argument list is marked in grey,
then this variable is not changing in this mode and just the last calculated value from the previous mode is internally used.
For an input argument it is not allowed to call <code>fmi2SetXXX</code>.
For an output argument,
calling <code>fmi2GetXXX</code> on such a variable returns always the same value in this mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime"><strong>green</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functions marked in <span class="lime">green</span> are special functions to enter or leave a mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue"><strong>blue</strong></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equations and functions marked in <span class="blue">blue</span> define the actual computations to be performed in the respective mode.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Function <code>fmi2SetXXX</code> used in the table below,
is an abbreviation for functions <code>fmi2SetReal</code>, <code>fmi2SetBoolean</code>,
<code>fmi2SetInteger</code> and <code>fmi2SetString</code> respectively.
Function <code>fmi2GetXXX</code> is an abbreviation for functions <code>fmi2GetReal</code>,
<code>fmi2GetBoolean</code>, <code>fmi2GetInteger</code> and <code>fmi2GetString</code> respectively.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Mathematical description of an FMU for Co-Simulation.</caption>
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Equations</strong></th>
<th class="tableblock halign-left valign-top"><strong>FMI functions</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations before Initialization Mode</strong> ("instantiated" in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set and set start value of independent variable \(tc_{i=0}\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetupExperiment</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables and that have a start value (<code>initial</code> = <code>"exact"</code> or <code>"approx"</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations during Initialization Mode</strong> ("InitializationMode" in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Enter Initialization Mode at (activate initialization,
discrete-time and continuous-time equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">fmi2EnterInitializationMode</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set variables \(v_{initial=exact}\) and \(v_{initial=approx}\) that have a start value with <code>initial</code> = <code>"exact"</code> (independent parameters \(\mathbf{p}\) and continuous-time states with start values \(\mathbf{x}_{c,initial=exact}\) are included here)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}_{c+d}(tc_0)\) and optionally the derivatives of continuous-time inputs \(\mathbf{u}_{c}^{(j)}(tc_0)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code><br>
<code>fmi2SetRealInputDerivatives</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\mathbf{v}_{InitialUnknowns} := \mathbf{f}_{init}(\mathbf{u}_c, \mathbf{u}_d, t_0, \mathbf{v}_{initial=exact})\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi2GetXXX</span></code><br>
<code><span class="blue">fmi2GetDirectionalDerivative</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">Exit Initialization Mode (de-activate initialization equations)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="lime">fmi2ExitInitializationMode</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Equations during Step Mode</strong> ("stepComplete", "stepInProgress" in state machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set independent tunable parameters \(\mathbf{p}_{tune}\) (and do not set other parameters \(\mathbf{p}_{other}\))</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set continuous-time and discrete-time inputs \(\mathbf{u}_{d+c}(tc_i)\) and optionally the derivatives of continuous-time inputs \(\mathbf{u}_{c}^{(j)}(tc_i)\)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2SetXXX</code><br>
<code>fmi2SetRealInputDerivatives</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="blue">\(\begin{matrix} tc_{i+1} := tc_i + hc_i \\ (\mathbf{y}_{c+d}, \mathbf{y}_c^{(j)}, \mathbf{w}_{c+d}) := \mathbf{f}_{doStep}(\mathbf{u}_{c+d}, \mathbf{u}_{c}^{(j)}, tc_i, hc_i, \mathbf{p}_{tune}, \mathbf{p}_{other})_{tc_i} \\ tc_i := tc_{i+1} \end{matrix}\)</span><br>
<span class="blue">\(\mathbf{f}_{doStep}\) is also a function of the internal variables \(\mathbf{x}_c\), \(^{\bullet}\mathbf{x}_d\)</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><span class="blue">fmi2DoStep</span></code><br>
<code>fmi2GetXXX</code><br>
<code><span class="blue">fmi2GetRealOutputDerivatives</span></code><br>
<code><span class="blue">fmi2GetDirectionalDerivative</span></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Data types</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">\(t, tc, hc \in \mathbb{R}, \mathbf{p} \in \mathbb{P}^{np}, \mathbf{u}(tc) \in \mathbb{P}^{nu}, \mathbf{y}(tc) \in \mathbb{P}^{ny}, \mathbf{x}_c(t) \in \mathbb{R}^{nxc}, \mathbf{x}_d(t) \in \mathbb{P}^{nxd}, \mathbf{w}(tc) \in \mathbb{P}^{nw}\)<br>
\(\mathbb{R}\): Real variable, \(\mathbb{R}\): real <strong>or</strong> boolean <strong>or</strong> integer <strong>or</strong> enumeration <strong>or</strong> string variable<br>
\(\mathbf{f}_{init}, \mathbf{f}_{out} \in C^0\) (=continuous functions with respect to all input arguments inside the respective mode).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>[Remark - Calling Sequences:</em></p>
</div>
<div class="paragraph">
<p><em>In the table above,
for notational convenience in Initialization Mode one function call is defined to compute all output arguments from all inputs arguments.
In reality, every scalar output argument is computed by one</em> <code>fmi2GetXXX</code> <em>function call.</em></p>
</div>
<div class="paragraph">
<p><em>In</em> <em>Step Mode the input arguments to</em> \(\mathbf{f}_{doStep}\) <em>are defined by calls to</em> <code>fmi2SetXXX</code> <em>and</em> <code>fmi2SetRealInputDerivatives</code> <em>functions.
The variables computed by</em> \(\mathbf{f}_{doStep}\) <em>can be inquired by</em>  <code>fmi2GetXXX</code> <em>function calls.]</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_application_programming_interface_2">4.2. FMI Application Programming Interface</h3>
<div class="paragraph">
<p>This section contains the interface description to access the in/output
data and status information of a co-simulation slave from a C program.</p>
</div>
<div class="sect3">
<h4 id="_transfer_of_input_output_values_and_parameters">4.2.1. Transfer of Input / Output Values and Parameters</h4>
<div class="paragraph">
<p>Input and output variables and variables are transferred via the
<code>fmi2GetXXX</code> and <code>fmi2SetXXX</code> functions, defined in section 2.1.7.</p>
</div>
<div class="paragraph">
<p>In order to enable the slave to interpolate the continuous real inputs
between communication steps, the derivatives of the inputs with respect
to time can be provided.
Also, higher derivatives can be set to allow higher order interpolation.
Whether a slave is able to interpolate and
therefore needs this information is provided by the capability attribute <code>canInterpolateInputs</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2SetRealInputDerivatives(fmi2Component c,
          const fmi2ValueReference vr[], size_t nvr,
          const fmi2Integer order[],
          const fmi2Real value[]);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Sets the n-th time derivative of real input variables.
Argument <code>"vr"</code> is a vector of value references that define the variables whose derivatives shall be set.
The array <code>"order"</code> contains the orders of the respective derivative (1 means the first derivative,
0 is not allowed).
Argument "value" is a vector with the values of the derivatives.
<code>"nvr"</code> is the dimension of the vectors.<br>
Different input variables may have different interpolation order.<br>
Restrictions on using the function are the same as for the <code>fmi2SetReal</code> function.</p>
</div>
<div class="paragraph indented2">
<p>Inputs and their derivatives are set with respect to the beginning of a
communication time step.</p>
</div>
<div class="paragraph indented2">
<p>To allow interpolation/approximation of the real output variables between communication steps (if they are used as inputs for other slaves), the derivatives of the outputs with respect to time can be read.
Whether the slave is able to provide the derivatives of outputs is given by the unsigned integer capability flag <code>MaxOutputDerivativeOrder</code>.
It delivers the maximum order of the output derivative.
If the actual order is lower (because the order of integration algorithm is low),
the retrieved value is 0.</p>
</div>
<div class="paragraph indented2">
<p><em>[Example: If the internal polynomial is of order 1 and the master
inquires the second derivative of an output, the slave will return zero.]</em></p>
</div>
<div class="paragraph">
<p>The derivatives can be retrieved by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2GetRealOutputDerivatives (fmi2Component c, +
          const fmi2ValueReference vr[], size_t nvr, +
          const fmi2Integer order[], +
          fmi2Real value[]);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Retrieves the n-th derivative of output values.
Argument <code>"vr"</code> is a vector of <code>"nvr"</code> value references that define the variables whose derivatives shall be retrieved.
The array <code>order</code> contains the order of the respective derivative (1 means the first derivative,
0 is not allowed).
Argument <code>"value"</code> is a vector with the actual values of the derivatives.<br>
Restrictions on using the function are the same as for the <code>fmi2GetReal</code> function.</p>
</div>
<div class="paragraph indented2">
<p>The returned outputs correspond to the current slave time.
E.g. after a successful <code>fmi2DoStep(..)</code> the returned values are related to the end of the communication time step.</p>
</div>
<div class="paragraph">
<p>This standard supports polynomial interpolation and extrapolation as well as more sophisticated signal extrapolation schemes like rational extrapolation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_computation">4.2.2. Computation</h4>
<div class="paragraph">
<p>The computation of time steps is controlled by the following function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2DoStep(fmi2Component c,
          fmi2Real currentCommunicationPoint,
          fmi2Real communicationStepSize,
          fmi2Boolean noSetFMUStatePriorToCurrentPoint);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>The computation of a time step is started.<br>
Argument <code>currentCommunicationPoint</code> is the current communication point of the master (\(tc_i\)) and argument <code>communicationStepSize</code> is the communication step size (\(hc_i\)).
The latter must be \(&gt; 0.0\).
The slave must integrate until time instant \(tc_{i+1} = tc_i + hc_i\).
<em>[The calling environment defines the communication points and <code>fmi2DoStep</code> must
synchronize to these points by always integrating exactly to \(tc_i + hc_i\).
It is up to <code>fmi2DoStep</code> how to achieve this.]</em>
At the first call to <code>fmiDoStep</code> after <code>fmi2ExitInitializationMode</code> was called
<code>currentCommunicationPoint</code> must be equal to <code>startTime</code> as set with <code>fmi2SetupExperiment</code>.
<em>[Formally, argument <code>currentCommunicationPoint</code> is not needed.
It is present in order to handle a mismatch between the master and the FMU state of the slave: The <code>currentCommunicationPoint</code> and the FMU state of the slaves defined by former</em> <code>fmi2DoStep</code> <em>or</em>
<code>fmi2SetFMUState</code> <em>calls have to be consistent with respect to each other.
For example, if the slave does not use the update formula for the independent variable as required above,</em> \(tc_{i+1} = tc_i + hc_i\) <em>(using argument</em> \(tc_i\) = <code>currentCommunicationPoint</code> <em>of</em> <code>fmi2DoStep</code>) <em>but uses internally an own update formula,
such as</em> \(tc_{s,i+1} = tc_{s,i} + hc_{s,i}\) <em>then the slave could use as time increment</em> \(\text{hc}_{s,i} := (tc_i - tc_{s,i}) + hc_i\) <em>(instead of</em> \(\text{hc}_{s,i} := hc_i\) <em>) to avoid a mismatch between the master time</em> \(tc_{i+1}\) <em>and the slave internal time</em> \(tc_{s,i+1}\) <em>for large i.]</em></p>
</div>
<div class="paragraph indented2">
<p>Argument <code>noSetFMUStatePriorToCurrentPoint</code> is <code>fmi2True</code> if <code>fmi2SetFMUState</code> will no longer be called for time instants prior to <code>currentCommunicationPoint</code> in this simulation run <em>[the slave can use this flag to flush a result buffer]</em>.</p>
</div>
<div class="paragraph indented2">
<p>The function returns:<br>
<code>fmi2OK</code> - if the communication step was computed successfully until its end.<br>
<code>fmi2Discard</code> - if the slave computed successfully only a subinterval of the communication step.
The master can call the appropriate <code>fmi2GetXXXStatus</code> functions to get further information.
If possible, the master should retry the simulation with a shorter communication step size.
<em>[Redoing a step is only possible if the FMU state has been recorded at the beginning of the current (failed) step with <code>fmi2GetFMUState</code>.
Redoing a step is performed by calling <code>fmi2SetFMUState</code> and afterwards calling <code>fmi2DoStep</code> with the new communicationStepSize.
Note that it is not possible to change <code>currentCommunicationPoint</code> in such a call.]</em><br>
<code>fmi2Error</code> - the communication step could not be carried out at all.
The master can try to repeat the step with other input values and/or a different communication step size in the same way as described in the <code>fmi2Discard</code> case above.<br>
<code>fmi2Fatal</code> - if an error occurred which corrupted the FMU irreparably.
<em>[The master should stop the simulation run immediatlely.]</em> See section 2.1.3 for details.<br>
<code>fmi2Pending</code> - this status is returned if the slave executes the function asynchronously.
That means the slave starts the computation but returns immediately.
The master has to call <code>fmi2GetStatus(&#8230;&#8203;,fmi2DoStep,&#8230;&#8203;)</code> to find out if the slave is done.
An alternative is to wait until the callback function fmi2StepFinished is called by the slave.
<code>fmi2CancelStep</code> can be called to cancel the current computation.
It is not allowed to call any other function during a pending <code>fmi2DoStep</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2CancelStep(fmi2Component c);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Can be called if <code>fmi2DoStep</code> returned <code>fmi2Pending</code> in order to stop the current asynchronous execution.
The master calls this function if, for example, the co-simulation run is stopped by the user or one of the slaves.
Afterwards only calls to <code>fmi2Reset</code>, <code>fmi2FreeInstance</code>, or <code>fmi2SetFMUstate</code> are valid to exit the <strong>step Canceled</strong> state.
Refer to section 4.2.4 for all other valid functions in this state.</p>
</div>
<div class="paragraph">
<p>It depends on the capabilities of the slave which parameter constellations and calling sequences are allowed (see 4.3.1)</p>
</div>
</div>
<div class="sect3">
<h4 id="_retrieving_status_information_from_the_slave">4.2.3. Retrieving Status Information from the Slave</h4>
<div class="paragraph">
<p>Status information is retrieved from the slave by the following
functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">fmi2Status fmi2GetStatus       (fmi2Component c, const fmi2StatusKind s,
                                fmi2Status* value);
fmi2Status fmi2GetRealStatus   (fmi2Component c, const fmi2StatusKind s,
                                fmi2Real* value);
fmi2Status fmi2GetIntegerStatus(fmi2Component c, const fmi2StatusKind s,
                                fmi2Integer* value);
fmi2Status fmi2GetBooleanStatus(fmi2Component c, const fmi2StatusKind s,
                                fmi2Boolean* value);
fmi2Status fmi2GetStringStatus (fmi2Component c, const fmi2StatusKind s,
                                fmi2String* value);</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Informs the master about the actual status of the simulation run.
Which status information is to be returned is specified by the argument <code>fmi2StatusKind</code>.
It depends on the capabilities of the slave which status information can be given by the slave (see 4.3.1).
If a status is required which cannot be retrieved by the slave it returns <code>fmi2Discard</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">typedef enum {fmi2DoStepStatus,
              fmi2PendingStatus,
              fmi2LastSuccessfulTime,
              fmi2Terminated
             } fmi2StatusKind;</code></pre>
</div>
</div>
<div class="paragraph indented2">
<p>Defines which status is inquired.</p>
</div>
<div class="paragraph">
<p>The following status information can be retrieved from a slave:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 16.6666%;">
<col style="width: 58.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Type of retrieved value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2DoStepStatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2Status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be called when the <code>fmi2DoStep</code> function returned <code>fmi2Pending</code>.
The function delivers <code>fmi2Pending</code> if the computation is not finished.
Otherwise the function returns the result of the asynchronously executed <code>fmi2DoStep</code> call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2PendingStatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be called when the <code>fmi2DoStep</code> function returned <code>fmi2Pending</code>.
The function delivers a string which informs about the status of the currently running asynchronous <code>fmi2DoStep</code> computation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2LastSuccessfulTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2Real</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the end time of the last successfully completed communication step.
Can be called after <code>fmi2DoStep(..)</code> returned <code>fmi2Discard</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2Terminated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fmi2Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns <code>fmi2True</code>, if the slave wants to terminate the simulation.
Can be called after <code>fmi2DoStep(..)</code> returned <code>fmi2Discard</code>.
Use <code>fmi2LastSuccessfulTime</code> to determine the time instant at which the slave terminated.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_state_machine_of_calling_sequence_from_master_to_slave">4.2.4. State Machine of Calling Sequence from Master to Slave</h4>
<div class="paragraph">
<p>The following state machine defines the supported calling sequences.</p>
</div>
<div class="paragraph">
<div class="title">Calling sequence of Co-Simulation C functions in form of an UML 2.0 state machine.</div>
<p><span class="image"><img src="images/figure11.png" alt="figure11"></span></p>
</div>
<div class="paragraph">
<p>Each state of the state machine corresponds to a certain phase of a
simulation as follows:</p>
</div>
<div class="paragraph">
<p><strong>instantiated</strong>:<br>
In this state,
start and guess values of variables that have <code>initial</code> = <code>"exact"</code> or <code>"approx"</code> and <code>variability</code> ≠ <code>"constant"</code> can be set,
this does not include inputs as they do not have an <code>initial</code> attribute but one can set input derivatives with the function <code>fmi2SetRealInputDerivatives</code>.</p>
</div>
<div class="paragraph">
<p><strong>Initialization Mode:</strong><br>
In this state, equations are active to determine all outputs (and optionally other variables exposed by the exporting tool).
The variables that can be retrieved by <code>fmi2GetXXX</code> calls are (1) defined in the XML file
under <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code>, and (2) variables with <code>causality</code> = <code>"output"</code>.
Variables with <code>initial</code> = <code>"exact"</code> and <code>variability</code> ≠ <code>"constant"</code>,
as well as variables with <code>causality</code> = <code>"input"</code> can be set.</p>
</div>
<div class="paragraph">
<p><strong>slaveInitialized</strong>:<br>
In this state, the slave is initialized and the co-simulation computation is performed. The calculation until the next communication point is performed with function <code>fmi2DoStep</code>. Depending on the return value, the slave is in a different state (<code>step Complete</code>, <code>step Failed</code>, <code>step Canceled</code>).</p>
</div>
<div class="paragraph">
<p><strong>terminated</strong>:<br>
In this state, the solution at the final time of the simulation can be retrieved.</p>
</div>
<div class="paragraph">
<p>Note that in Initialization Mode input variables can be set with <code>fmi2SetXXX</code> and output variables can be retrieved
with <code>fmi2GetXXX</code> interchangeably according to the model structure defined
under element <code>&lt;ModelStructure&gt;&lt;InitialUnknowns&gt;</code> in the XML file.
<em>[For example, if one output <code>y1</code> depends on two inputs <code>u1</code>, <code>u2</code>,
then these two inputs must be set, before <code>y1</code> can be retrieved.
If additionally an output <code>y2</code> depends on an input <code>u3</code>, then <code>u3</code> can be set and <code>y2</code> can be retrieved afterwards.
As a result, artificial or "real" algebraic loops over connected FMUs in
Initialization Mode can be handled by using appropriate numerical algorithms.]</em></p>
</div>
<div class="paragraph">
<p>There is the additional restriction in <code>slaveInitialized</code> state that it is not allowed to call <code>fmi2GetXXX</code> functions after <code>fmi2SetXXX</code> functions without an <code>fmi2DoStep</code> call in between.</p>
</div>
<div class="paragraph">
<p>_[The reason is to avoid different interpretations of the caching, since contrary to FMI for Model Exchange, <code>fmi2DoStep</code> will perform the actual calculation instead of <code>fmi2GetXXX</code>, and therefore, dummy algebraic loops at communication points cannot be handeled by an appropriate sequence of <code>fmi2GetXXX</code> and, <code>fmi2SetXXX</code> calls as for ModelExchange.</p>
</div>
<div class="paragraph">
<p>Examples:_</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><em>Correct calling sequence</em></th>
<th class="tableblock halign-left valign-top"><em>Wrong calling sequence</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi2SetXXX on inputs</em><br>
<em>fmi2DoStep</em><br>
<em>fmi2GetXXX on outputs</em><br>
<em>fmi2SetXXX on inputs</em><br>
<em>fmi2DoStep</em><br>
<em>fmi2GetXXX on outputs</em><br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>fmi2SetXXX on inputs</em><br>
<em>fmi2DoStep</em><br>
<em>fmi2GetXXX on outputs</em><br>
<em>fmi2SetXXX on inputs</em><br>
<em>fmi2GetXXX on outputs // not allowed</em><br>
<em>fmi2DoStep</em><br>
<em>fmi2GetXXX on outputs</em><br></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>]</em></p>
</div>
<div class="paragraph">
<p>The allowed function calls in the respective states are summarized in the following table (functions marked in <span class="yellow-background">"yellow"</span> are only available for "Co-Simulation", the other functions are available both for "Model Exchange" and "Co-Simulation"):</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-bottom" rowspan="2"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="10"><p class="tableblock"><strong>FMI 2.0 for Co-Simulation</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">start, end</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">instantiated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">Initialization Mode</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepComplete</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepInProgress</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepFailed</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">stepCanceled</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">terminated</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">error</span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="vertical-text">fatal</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetTypesPlatform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetDebugLogging</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2Instantiate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2FreeInstance</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetupExperiment</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2EnterInitializationMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2ExitInitializationMode</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2Terminate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2Reset</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetReal</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetInteger</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetBoolean</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetString</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SetFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2FreeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SerializedFMUstateSize</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2SerializeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2DeSerializeFMUstate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fmi2GetDirectionalDerivative</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2SetRealInputDerivatives  </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetRealOutputDerivatives </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2DoStep                   </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2CancelStep               </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetStatus                </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetRealStatus            </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetIntegerStatus         </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetBooleanStatus         </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: yellow;"><p class="tableblock">fmi2GetStringStatus          </p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>x</strong> means: call is allowed in the corresponding state<br>
<strong>number</strong> means: call is allowed if the indicated condition holds:<br>
<strong>1</strong> for a variable with <code>variability ≠ "constant"</code> that has <code>initial = "exact"</code> or <code>"approx"</code><br>
<strong>2</strong> for a variable with <code>causality = "output"</code> or continuous-time states or state derivatives
(if element <code>&lt;Derivatives&gt;</code> is present)<br>
<strong>3</strong> for a variable with <code>variability ≠ "constant"</code> that has <code>initial = "exact"</code>,
or <code>causality</code> = <code>"input"</code><br>
<strong>6</strong> for a variable with <code>causality</code> = <code>"input"</code> or (<code>causality</code> = <code>"parameter"</code> and <code>variability</code> = <code>"tunable"</code>)<br>
<strong>7</strong> always, but retrieved values are usable for debugging only<br>
<strong>8</strong> always, but if status is other than <code>fmi2Terminated</code>,
retrieved values are useable for debugging only</p>
</div>
</div>
<div class="sect3">
<h4 id="_pseudocode_example_2">4.2.5. Pseudocode Example</h4>
<div class="paragraph">
<p>In the following example,
the usage of the FMI functions is sketched in order to clarify the typical calling sequence of the functions in a simulation environment.
The example is given in a mix of pseudocode and C,
in order to keep it small and understandable.
We consider two slaves,
where both have one continuous real input and one continuous real output which are connected in the following way:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/figure12.png" alt="figure12" width="30%">
</div>
<div class="title">Figure 12: Connection graph of the slaves.</div>
</div>
<div class="paragraph">
<p>We assume no algebraic dependency between input and output of each slave.
The code demonstrates the simplest master algorithm as shown in section 4.1:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="8">
<li>
<p>Constant communication step size.</p>
</li>
<li>
<p>No repeating of communication steps.</p>
</li>
<li>
<p>The slaves do not support asynchronous execution of <code>fmi2DoStep</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The error handling is implemented in a very rudimentary way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C hljs" data-lang="C">//////////////////////////
//Initialization sub-phase
//Set callback functions,
fmi2CallbackFunctions cbf;
cbf.logger = loggerFunction;  //logger function
cbf.allocateMemory = calloc;
cbf.freeMemory = free;
cbf.stepFinished = NULL;      //synchronous execution
cbf.componentEnvironment = NULL;

//Instantiate both slaves
fmi2Component s1 = s1_fmi2Instantiate("Tool1" , fmi2CoSimulation, GUID1, "",
                                    fmi2False, fmi2False, &amp;cbf, fmi2True);
fmi2Component s2 = s2_fmi2Instantiate("Tool2" , fmi2CoSimulation, GUID2, "",
                                    fmi2False, fmi2False, &amp;cbf, fmi2True);

if ((s1 == NULL) || (s2 == NULL))
      return FAILURE;

// Start and stop time
startTime = 0;
stopTime = 10;

//communication step size
h = 0.01;

// set all variable start values (of "ScalarVariable / &lt;type&gt; / start")
s1_fmi2SetReal/Integer/Boolean/String(s1, ...);
s2_fmi2SetReal/Integer/Boolean/String(s2, ...);

//Initialize slaves
s1_fmi2SetupExperiment(s1, fmi2False, 0.0, startTime, fmi2True, stopTime);
s2_fmi2SetupExperiment(s1, fmi2False, 0.0, startTime, fmi2True, stopTime);
s1_fmi2EnterInitializationMode(s1);
s2_fmi2EnterInitializationMode(s2);

// set the input values at time = startTime
s1_fmi2SetReal/Integer/Boolean/String(s1, ...);
s2_fmi2SetReal/Integer/Boolean/String(s2, ...);
s1_fmi2ExitInitializationMode(s1);
s2_fmi2ExitInitializationMode(s2);

//////////////////////////
//Simulation sub-phase
tc = startTime; //Current master time

while ((tc &lt; stopTime) &amp;&amp; (status == fmi2OK))
{

    //retrieve outputs
    s1_fmi2GetReal(s1, ..., 1, &amp;y1);
    s2_fmi2GetReal(s2, ..., 1, &amp;y2);

    //set inputs
    s1_fmi2SetReal(s1, ..., 1, &amp;y2);
    s2_fmi2SetReal(s2, ..., 1, &amp;y1);

    //call slave s1 and check status
    status = s1_fmi2DoStep(s1, tc, h, fmi2True);
    switch (status) {
    case fmi2Discard:
      fmi2GetBooleanStatus(s1, fmi2Terminated, &amp;boolVal);
      if (boolVal == fmi2True)
            printf("Slave s1 wants to terminate simulation.");
    case fmi2Error:
    case fmi2Fatal:
      terminateSimulation = true;
      break;
    }
    if (terminateSimulation)
      break;

    //call slave s2 and check status as above
    status = s2_fmi2DoStep(s2, tc, h, fmi2True);
    ...

    //increment master time
    tc += h;
}

//////////////////////////
//Shutdown sub-phase
if ((status != fmi2Error) &amp;&amp; (status != fmi2Fatal))
{
    s1_fmi2Terminate(s1);
    s2_fmi2Terminate(s2);
}

if (status != fmi2Fatal)
{
    s1_fmi2FreeInstance(s1);
    s2_fmi2FreeInstance(s2);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fmi_description_schema_3">4.3. FMI Description Schema</h3>
<div class="paragraph">
<p>This is defined in section 2.2.
Additionally, the co-simulation specific element "Implementation" is defined in the next section.</p>
</div>
<div class="sect3">
<h4 id="_co_simulation_fmu_cosimulation">4.3.1. Co-Simulation FMU (CoSimulation)</h4>
<div class="paragraph">
<p>If the XML file defines an FMU for Co-Simulation,
element "CoSimulation" must be present.
It is defined as:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cs_xml_1.png" alt="cs xml 1" width="80%">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cs_xml_2.png" alt="cs xml 2" width="70%">
</div>
</div>
<div class="paragraph">
<p>These attributes have the following meaning (all attributes are optional with exception of `"modelIdentifier`"):</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top"><em>Description</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modelIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short class name according to C syntax, for example, "A_B_C".
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries,
but not if the functions are provided by a DLL/SharedObject.
<code>modelIdentifier</code> is also used as name of the static library or DLL/SharedObject.
See also section 2.1.1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>needsExecutionTool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, a tool is needed to execute the model.
The FMU just contains the communication to this tool (see Figure 8).
<em>[Typically, this information is only utilized for information purposes.
For example, a co-simulation master can inform the user that a tool has to be available on the computer where the slave is instantiated.
The name of the tool can be taken from attribute <code>generationTool</code> of <code>fmiModelDescription</code>.]</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canHandleVariableCommunicationStepSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave can handle variable communication step size.
The communication step size (parameter communicationStepSize of <code>fmi2DoStep(..)</code>) has not to be constant for each call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canInterpolateInputs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave is able to interpolate continuous inputs.
Calling of <code>fmi2SetRealInputDerivatives(..)</code> has an effect for the slave.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxOutputDerivativeOrder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The slave is able to provide derivatives of outputs with maximum order.
Calling of <code>fmi2GetRealOutputDerivatives(..)</code> is allowed up to the order defined by <code>maxOutputDerivativeOrder</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canRunAsynchronuously</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag describes the ability to carry out the <code>fmi2DoStep(..)</code> call asynchronously.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canBeInstantiatedOnlyOncePerProcess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This flag indicates cases (especially for embedded code),
where only one instance per FMU is possible. (For multiple instantiation the default is <code>false</code>;
if multiple instances are needed,
the FMUs must be instantiated in different processes.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canNotUseMemoryManagementFunctions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the slave uses its own functions for memory allocation and freeing only.
The callback functions <code>allocateMemory</code> and <code>freeMemory</code> given in <code>fmi2Instantiate</code> are ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canGetAndSetFMUstate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the environment can inquire the internal FMU state and restore it.
That is, <code>fmi2GetFMUstate</code>, <code>fmi2SetFMUstate</code>, and <code>fmi2FreeFMUstate</code> are supported by the FMU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>canSerializeFMUstate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the environment can serialize the internal FMU state,
in other words, <code>fmi2SerializedFMUstateSize</code>, <code>fmi2SerializeFMUstate</code>,
<code>fmi2DeSerializeFMUstate</code> are supported by the FMU.
If this is the case, then flag <code>canGetAndSetFMUstate</code> must be true as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providesDirectionalDerivative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the directional derivative of the equations at communication points can be computed with <code>fmi2GetDirectionalDerivative</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The flags have the following default values.<br>
boolean: false<br>
unsignedInt: 0<br></p>
</div>
<div class="paragraph">
<p>Note that if <code>needsExecutionTool = true</code>,
then it is required that the original tool is available to be executed in co-simulation mode.
If <code>needsExecutionTool = false</code>,
the slave is completely contained inside the FMU in source code or binary format (DLL/SharedObject).</p>
</div>
</div>
<div class="sect3">
<h4 id="_example_xml_description_file_2">4.3.2. Example XML Description File</h4>
<div class="paragraph">
<p>The example below is the same one as shown in section 3.3.2 for a ModelExchange FMU.
The only difference is the replacement of element ModelExchange by element CoSimulation (with additional attributes) and the removal of local variables, which are associated with continuous states and their derivatives.
The XML file may have the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fmiModelDescription
  fmiVersion="2.0"
  modelName="MyLibrary.SpringMassDamper"
  guid="{8c4e810f-3df3-4a00-8276-176fa3c9f9e0}"
  description="Rotational Spring Mass Damper System"
  version="1.0"
  generationDateAndTime="2011-09-23T16:57:33Z"
  variableNamingConvention="structured"&gt;
  &lt;CoSimulation modelIdentifier="MyLibrary_SpringMassDamper" canHandleVariableCommunicationStepSize="true" canInterpolateInputs="true"/&gt;
  &lt;UnitDefinitions&gt;
    &lt;Unit name="rad"&gt;
      &lt;BaseUnit rad="1"/&gt;
      &lt;DisplayUnit name="deg" factor="57.2957795130823"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="rad/s"&gt;
      &lt;BaseUnit s="-1" rad="1"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="kg.m2"&gt;
      &lt;BaseUnit kg="1" m="2"/&gt;
    &lt;/Unit&gt;
    &lt;Unit name="N.m"&gt;
      &lt;BaseUnit kg="1" m="2" s="-2"/&gt;
    &lt;/Unit&gt;
  &lt;/UnitDefinitions&gt;
  &lt;TypeDefinitions&gt;
    &lt;SimpleType name="Modelica.SIunits.Inertia"&gt;
      &lt;Real quantity="MomentOfInertia" unit="kg.m2" min="0.0"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.Torque"&gt;
      &lt;Real quantity="Torque" unit="N.m"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.AngularVelocity"&gt;
      &lt;Real quantity="AngularVelocity" unit="rad/s"/&gt;
    &lt;/SimpleType&gt;
    &lt;SimpleType name="Modelica.SIunits.Angle"&gt;
      &lt;Real quantity="Angle" unit="rad"/&gt;
    &lt;/SimpleType&gt;
  &lt;/TypeDefinitions&gt;
  &lt;DefaultExperiment startTime="0.0" stopTime="3.0" tolerance="0.0001"/&gt;
  &lt;ModelVariables&gt;
    &lt;ScalarVariable name="inertia1.J" valueReference="1073741824" description="Moment of load inertia" causality="parameter" variability="fixed"&gt;
      &lt;Real declaredType="Modelica.SIunits.Inertia" start="1"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;ScalarVariable name="torque.tau" valueReference="536870912" description="Accelerating torque acting at flange (= -flange.tau)" causality="input"&gt;
      &lt;Real declaredType="Modelica.SIunits.Torque" start="0"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;ScalarVariable name="inertia1.phi" valueReference="805306368" description="Absolute rotation angle of component" causality="output"&gt;
      &lt;Real declaredType="Modelica.SIunits.Angle"/&gt;
    &lt;/ScalarVariable&gt;
    &lt;ScalarVariable name="inertia1.w" valueReference="805306369" description="Absolute angular velocity of component (= der(phi))" causality="output"&gt;
      &lt;Real declaredType="Modelica.SIunits.AngularVelocity"/&gt;
    &lt;/ScalarVariable&gt;
  &lt;/ModelVariables&gt;
  &lt;ModelStructure&gt;
    &lt;Outputs&gt;
      &lt;Unknown index="3"/&gt;
      &lt;Unknown index="4"/&gt;
    &lt;/Outputs&gt;
    &lt;InitialUnknowns&gt;
      &lt;Unknown index="3"/&gt;
      &lt;Unknown index="4"/&gt;
    &lt;/InitialUnknowns&gt;
  &lt;/ModelStructure&gt;
&lt;/fmiModelDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_literature">5. Literature</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Åkesson J., Braun W., Lindholm P., and Bachmann B. (2012): <strong>Generation of Sparse Jacobians for the Functional Mockup Interface 2.0</strong>. 9th International Modelica Conference, Munich, 2012. <a href="http://www.ep.liu.se/ecp/076/018/ecp12076018.pdf" class="bare">http://www.ep.liu.se/ecp/076/018/ecp12076018.pdf</a></p>
</li>
<li>
<p>Benveniste A., Caillaud B., Pouzet M. (2010): <strong>The Fundamentals of Hybrid Systems Modelers</strong>. In 49th IEEE International Conference on Decision and Control (CDC), Atlanta, Georgia, USA, December 15-17. <a href="http://www.di.ens.fr/~pouzet/bib/cdc10.pdf" class="bare">http://www.di.ens.fr/~pouzet/bib/cdc10.pdf</a></p>
</li>
<li>
<p>Blochwitz T., Otter M., Arnold M., Bausch C., Clauß C., Elmqvist H., Junghanns A., Mauss J., Monteiro M., Neidhold T., Neumerkel D., Olsson H., Peetz J.-V., Wolf S. (2011): <strong>The Functional Mockup Interface for Tool independent Exchange of Simulation Models</strong>. 8th International Modelica Conference, Dresden 2011. <a href="http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf" class="bare">http://www.ep.liu.se/ecp/063/013/ecp11063013.pdf</a></p>
</li>
<li>
<p>Blochwitz T., Otter M., Akesson J., Arnold M., Clauß C., Elmqvist H., Friedrich M., Junghanns A., Mauss J,, Neumerkel D., Olsson H., Viel A. (2012): <strong>Functional Mockup Interface 2.0: The Standard for Tool independent Exchange of Simulation Models</strong>. 9th International Modelica Conference, Munich, 2012. <a href="http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf" class="bare">http://www.ep.liu.se/ecp/076/017/ecp12076017.pdf</a></p>
</li>
<li>
<p>Kübler R., Schiehlen, W. (2000): <strong>Two methods of simulator coupling</strong>. Mathematical and Computer Modeling of Dynamical Systems 6 pp. 93-113.
Lee E.A., Zheng H. (2007): Leveraging Synchronous Language Principles for Heterogeneous Modeling and Design of Embedded Systems. EMSOFT’07, Sept. 30 - Oct. 3, 2007, Salzburg, Austria. <a href="https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf" class="bare">https://ptolemy.berkeley.edu/publications/papers/07/unifying/LeeZheng_SRUnifying.pdf</a></p>
</li>
<li>
<p>Lee E.A., Zheng H. (2007): <strong>Leveraging Synchronous Language Principles for Heterogeneous Modeling and Design of Embedded Systems</strong>. EMSOFT’07, September 30–October 3, Salzburg, Austria. <a href="https://dl.acm.org/citation.cfm?id=1289949" class="bare">https://dl.acm.org/citation.cfm?id=1289949</a></p>
</li>
<li>
<p>Modelica (2012): <strong>Modelica, A Unified Object-Oriented Language for Systems Modeling</strong>. Language Specification, Version 3.3, May 9, 2012. <a href="https://www.modelica.org/documents/ModelicaSpec33.pdf" class="bare">https://www.modelica.org/documents/ModelicaSpec33.pdf</a></p>
</li>
<li>
<p>MODELISAR Glossary (2009): <strong>MODELISAR WP2 Glossary and Abbreviations</strong>. Version 1.0, June 9, 2009. Pouzet M. (2006): Lucid Synchrone, Version 3.0, Tutorial and Reference Manual.
<a href="http://www.di.ens.fr/~pouzet/lucid-synchrone/" class="bare">http://www.di.ens.fr/~pouzet/lucid-synchrone/</a></p>
</li>
<li>
<p>XML: www.w3.org/XML, en.wikipedia.org/wiki/XML</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fmi_revision_history">Appendix A: FMI Revision History</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix describes the history of the FMI design and its
contributors. The current version of this document is available from
<a href="https://fmi-standard.org/" class="bare">https://fmi-standard.org/</a>.</p>
</div>
<div class="paragraph">
<p>The Functional Mock-up Interface development was initiated and organized
by Daimler AG (from Bernd Relovsky and others) as subproject inside the
<a href="http://www.itea2.org/">ITEA2</a> MODELISAR project.</p>
</div>
<div class="paragraph">
<p>The development of versions 1.0 and 2.0 was performed within WP200 of
MODELISAR, organized by the WP200 work package leader Dietmar Neumerkel
from Daimler.</p>
</div>
<div class="sect2">
<h3 id="_a_1_version_1_0_fmi_for_model_exchange">A.1 Version 1.0 – FMI for Model Exchange</h3>
<div class="paragraph">
<p>Version 1.0 of FMI for Model Exchange was released on Jan. 26, 2010.</p>
</div>
<div class="paragraph">
<p>The subgroup "FMI for Model Exchange" was headed by Martin Otter
(DLR-RM). The essential part of the design of this version was performed
by (alphabetical list):</p>
</div>
<div class="paragraph indented2">
<p>Torsten Blochwitz, ITI, Germany<br>
Hilding Elmqvist, Dassault Systèmes, Sweden<br>
Andreas Junghanns, QTronic, Germany<br>
Jakob Mauss, QTronic, Germany<br>
Hans Olsson, Dassault Systèmes, Sweden<br>
Martin Otter, DLR-RM, Germany.<br></p>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical
list):</p>
</div>
<div class="paragraph indented2">
<p>Dymola by Peter Nilsson, Dan Henriksson, Carl Fredrik Abelson, and Sven Erik Mattson, Dassault Systèmes,<br>
JModelica.org by Tove Bergdahl, Modelon AB,<br>
Silver by Andreas Junghanns, and Jakob Mauss, QTronic.</p>
</div>
<div class="paragraph">
<p>These prototypes have been used to refine the design of "FMI for Model
Exchange".</p>
</div>
<div class="paragraph">
<p>The following MODELISAR partners participated at FMI design meetings and
contributed to the discussion (alphabetical list):</p>
</div>
<div class="paragraph indented2">
<p>Ingrid Bausch-Gall, Bausch-Gall GmbH, Munich, Germany<br>
Torsten Blochwitz, ITI GmbH, Dresden, Germany<br>
Alex Eichberger, SIMPACK AG, Gilching, Germany<br>
Hilding Elmqvist, Dassault Systèmes, Lund, Sweden<br>
Andreas Junghanns, QTronic GmbH, Berlin, Germany<br>
Rainer Keppler, SIMPACK AG, Gilching, Germany<br>
Gerd Kurzbach, ITI GmbH, Dresden, Germany<br>
Carsten Kübler, TWT, Germany<br>
Jakob Mauss, QTronic GmbH, Berlin, Germany<br>
Johannes Mezger, TWT, Germany<br>
Thomas Neidhold, ITI GmbH, Dresden, Germany<br>
Dietmar Neumerkel, Daimler AG, Stuttgart, Germany<br>
Peter Nilsson, Dassault Systèmes, Lund, Sweden<br>
Hans Olsson, Dassault Systèmes, Lund, Sweden<br>
Martin Otter, German Aerospace Center (DLR), Oberpfaffenhofen, Germany<br>
Antoine Viel, LMS International (Imagine), Roanne, France<br>
Daniel Weil, Dassault Systèmes, Grenoble, France</p>
</div>
<div class="paragraph">
<p>The following people outside of the MODELISAR consortium contributed
with comments:</p>
</div>
<div class="paragraph indented2">
<p>Johan Akesson, Lund University, Lund, Sweden<br>
Joel Andersson, KU Leuven, The Netherlands<br>
Roberto Parrotto, Politecnico di Milano, Italy</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_2_version_1_0_fmi_for_co_simulation">A.2 Version 1.0 – FMI for Co-Simulation</h3>
<div class="paragraph">
<p>Version 1.0 of FMI for Co-Simulation was released on Oct. 10, 2010.</p>
</div>
<div class="paragraph">
<p>FMI for Co-Simulation was developed in three subgroups: "Solver
Coupling" headed by Martin Arnold (University Halle) and Torsten
Blochwitz (ITI), "Tool Coupling" headed by Jörg-Volker Peetz (Fraunhofer
SCAI), and "Control Logic" headed by Manuel Monteiro (Atego). The
essential part of the design of this version was performed by
(alphabetical list):</p>
</div>
<div class="paragraph indented2">
<p>Martin Arnold, University Halle, Germany<br>
Constanze Bausch, Atego Systems GmbH, Wolfsburg, Germany<br>
Torsten Blochwitz, ITI GmbH, Dresden, Germany<br>
Christoph Clauß, Fraunhofer IIS EAS, Dresden, Germany<br>
Manuel Monteiro, Atego Systems GmbH, Wolfsburg, Germany<br>
Thomas Neidhold, ITI GmbH, Dresden, Germany<br>
Jörg-Volker Peetz, Fraunhofer SCAI, St. Augustin, Germany<br>
Susann Wolf, Fraunhofer IIS EAS, Dresden, Germany</p>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical
list):</p>
</div>
<div class="paragraph indented2">
<p>SimulationX by Torsten Blochwitz and Thomas Neidhold (ITI GmbH),<br>
Master algorithms by Christoph Clauß (Fraunhofer IIS EAS)</p>
</div>
<div class="paragraph">
<p>The following MODELISAR partners participated at FMI design meetings and
contributed to the discussion (alphabetical list):</p>
</div>
<div class="paragraph indented2">
<p>Martin Arnold, University Halle, Germany<br>
Jens Bastian, Fraunhofer IIS EAS, Dresden, Germany<br>
Constanze Bausch, Atego Systems GmbH, Wolfsburg, Germany<br>
Torsten Blochwitz, ITI GmbH, Dresden, Germany<br>
Christoph Clauß, Fraunhofer IIS EAS, Dresden, Germany<br>
Manuel Monteiro, Atego Systems GmbH, Wolfsburg, Germany<br>
Thomas Neidhold, ITI GmbH, Dresden, Germany<br>
Dietmar Neumerkel, Daimler AG, Böblingen, Germany<br>
Martin Otter, DLR, Oberpfaffenhofen, Germany<br>
Jörg-Volker Peetz, Fraunhofer SCAI, St. Augustin, Germany<br>
Tom Schierz, University Halle, Germany<br>
Klaus Wolf, Fraunhofer SCAI, St. Augustin, Germany</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_3_version_2_0_fmi_for_model_exchange_and_co_simulation">A.3 Version 2.0 – FMI for Model Exchange and Co-Simulation</h3>
<div class="paragraph">
<p>FMI 2.0 for Model Exchange and Co-Simulation was released on July 25, 2014.</p>
</div>
<div class="sect3">
<h4 id="_a_3_1_overview">A.3.1 Overview</h4>
<div class="paragraph">
<p>This section gives an overview about the changes with respect to versions 1.0 for Model Exchange and 1.0 for Co-Simulation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FMI 2.0 is not backwards compatible to FMI 1.0.</p>
</li>
<li>
<p>The documents, schema and header files for Model Exchange and for Co-Simulation have been merged. Due to the merging, some conflicts had to be resolved leading to some non-backwards compatible changes with respect to FMI 1.0.</p>
</li>
<li>
<p>Parameters can be declared to be "tunable" in the FMU, in other words, during simulation these parameters can be changed (if supported by the simulation environment).</p>
</li>
<li>
<p>When enabling logging, log categories to be logged can be defined, so that the FMU only needs to generate logs of the defined categories (in FMI 1.0, logs had to be generated for all log categories and they had to be filtered afterwards). Log categories that are supported by an FMU can be optionally defined in the XML file so that a simulation environment can provide them to the user for selection.</p>
</li>
<li>
<p>In order that tools can more simply support importing both FMI 1.0 and 2.0, all file and function names of FMI 2.0 start with <code>fmi2</code>, whereas they start with <code>fmi</code> for FMI 1.0.</p>
</li>
<li>
<p>FMI function names are no longer prefixed with the <code>modelIdentifier</code> if used in a DLL/sharedObject. As a result, FMUs that need a tool can use a generic communication DLL, and the loading of DLLs is no longer FMU dependent.</p>
</li>
<li>
<p>The different modes of an FMU are now clearly signaled with respective function calls (<code>fmi2EnterInitializationMode</code>, <code>fmi2EnterEventMode</code>, <code>fmi2EnterContinuousTimeMode</code>).</p>
</li>
<li>
<p>The interfaces have been redesigned, in order that algebraic loops over connected FMUs with Real, Integer, or Boolean unknowns can now be handled reasonably not only in Continuous Time Mode, but also in Initialization and Event Mode. In FMI 1.0, algebraic loops in Initialization and Even Mode could not be handled.</p>
</li>
<li>
<p>The termination of every global event iteration over connected FMUs must be reported by a new function call (<code>fmi2EnterContinuousTimeMode</code>).</p>
</li>
<li>
<p>The unit definitions have been improved: The tool-specific unit-name can optionally be expressed as function of the 7 SI base units and the SI derived unit "rad". It is then possible to check units when FMUs are connected together (without standardizing unit names), or to convert variable values that are provided in different units (for the same physical quantity).</p>
</li>
<li>
<p>Enumerations have an arbitrary (but unique) mapping to integers (in FMI 1.0, the mapping was automatically to 1,2,3,&#8230;&#8203;).</p>
</li>
<li>
<p>The alias/negatedAlias variable definitions have been removed, to simplify the interface: If variables of the same base type (like <code>fmi2Real</code>) have the same valueReference, they have identical values. A simulation environment may ignore this completely (this was not possible in FMI 1.0), or can utilize this information to more efficiently store results on file.</p>
</li>
<li>
<p>When instantiating an FMU, the absolute path to the FMU resource directory is now reported also in Model Exchange, in order that the FMU can read all of its resources (for example, maps, tables, &#8230;&#8203;) independently of the "current directory" of the simulation environment where the FMU is used.</p>
</li>
<li>
<p>An ordering is defined for input, output, and state variables in the XML file of an FMU, in order for this order to be defined in the FMU, and not be (arbitrarily) selected by the simulation environment. This is essential, for example, when linearizing an FMU, or when providing "sparsity" information (see below).</p>
</li>
<li>
<p>Several optional features have been added:</p>
<div class="ulist">
<ul>
<li>
<p>The complete FMU state can be saved, restored, and serialized to a byte vector (that can be stored on file). As a result, a simulation (both for Model Exchange and for Co-Simulation) can be restarted from a saved FMU state. Rejecting steps for variable step-size Co-Simulation master algorithms is now performed with this feature (instead of the less powerful method of FMI 1.0).</p>
</li>
<li>
<p>The dependency of state derivatives and of output variables from inputs and states can be defined in the XML file, in other words, the sparsity pattern for Jacobians can be defined. This allows simulating stiff FMUs with many states (&gt; 1000 states) since sparse matrix methods can be utilized in the numerical integration method. Furthermore, it can be stated whether this dependency is linear (this allows to transform nonlinear algebraic equation systems into linear equation systems when connecting FMUs).</p>
</li>
<li>
<p>Directional derivatives can be computed for derivatives of continuous-time states and for outputs. This is useful when partial derivatives of connected FMUs must be computed. If the exported FMU performs this computation analytically, then all numerical algorithms based on these partial derivatives (for example, the numerical integration method or nonlinear algebraic solvers) are more efficient and more reliable.</p>
</li>
<li>
<p>Every scalar variable definition can have an additional "annotation" data structure that is arbitrary ("any" element in XML). A tool vendor can store tool-dependent information here (that other tools can ignore), for example, to store the graphical layout of parameter menus. The <code>VendorAnnotations</code> element was also generalized from (name, value) pairs to any XML data structure.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Many smaller improvements have been included, due to the experience in using FMI 1.0 (for example, the causality/variability attributes have been changed and more clearly defined, the fmi2ModelFunctions.h header has been split into two header files (one for the function signature, and one for the function names), in order that the header files can be directly used both for DLLs and for source code distribution).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_2_main_changes">A.3.2 Main changes</h4>
<div class="paragraph">
<p>This section gives the details about the changes with respect to versions 1.0 for Model Exchange and 1.0 for Co-Simulation:</p>
</div>
<div class="paragraph">
<p>In this version, the documents of version 1.0 for Model Exchange and for Co-Simulation have been merged and several new features have been added.</p>
</div>
<div class="paragraph">
<p><strong>The following changes in FMI 2.0 are <span class="underline">not backwards compatible</span> due to the merging</strong>:</p>
</div>
<div class="paragraph second-indented">
<p>File fmiModelTypes.h (in FMI for Model Exchange) has been renamed to fmi2TypesPlatform.h (the file name used in FMI for Co-Simulation).</p>
</div>
<div class="paragraph second-indented">
<p>File fmiModelFunctions.h (in FMI for Model Exchange) has been renamed to fmi2Functions.h (the file name used in FMI for Co-Simulation), and the function prototypes in this header files have been merged from "Model Exchange" and from "Co-Simulation"). Additionally, a new header files has been added, <code>fmi2FunctionTypes.h</code> that contains a definition of the function signatures. This header file is also used in <code>fmi2Functions.h</code> (so the signature is not duplicated). The benefit is that <code>fmi2FunctionTypes.h</code> can be directly used when loading a DLL/sharedObject (in FMI 1.0, the tool providers had to provide this header file by themselves).</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #47:<br>
In FMI 1.0 for Model Exchange the fmiModelDescription.version was
defined as string, whereas in Co-Simulation it was defined as integer.
This has been changed, so that version is a string.</p>
</div>
<div class="paragraph">
<p><strong>The following <span class="underline">backwards compatible</span> improvements have been made in FMI 2.0:</strong></p>
</div>
<div class="paragraph">
<p>The FMI 1.0 documents have been merged (for example, all common definitions have been placed in the new chapter 2).</p>
</div>
<div class="paragraph">
<p><strong>The following <span class="underline">not backwards compatible</span> improvements have been made in FMI 2.0:</strong></p>
</div>
<div class="paragraph second-indented">
<p>Element "fmiModelDescription.Implementation" in the model description schema file has been replaced by a different structure where one hierarchical level is removed. There are now 2 elements directly under fmiModelDescription: "ModelExchange" and "CoSimulation".<br>
File "fmiImplementation.xsd" has been removed.<br>
New capability flags have been introduced both for <code>ModelExchange</code> and for <code>CoSimulation</code>, such as <code>canGetAndSetFMUstate</code>, <code>canSerializeFMUstate</code>, etc.<br>
Attribute <code>modelIdentifier</code> has been moved from an <code>fmiModelDescription</code> attribute to an attribute in <code>ModelExchange</code> and in <code>CoSimulation</code>. This allows providing different identifiers, and then an FMU may contain both distribution types with different DLL names (which correspond to the <code>modelIdentifier</code> names).<br>
A new attribute <code>needsExecutionTool</code> has been introduced both in <code>ModelExchange</code> and in <code>CoSimulation</code> in order to define whether a tool is needed to execute the FMU. The previous elements in <code>CoSimulation_Tool</code> have been removed.</p>
</div>
<div class="paragraph second-indented">
<p>The state machines of ModelExchange and CoSimulation have been improved. Especially, the entering of the states in this state machine are now clearly marked by corresponding function calls (<code>fmi2EnterInitializationMode</code>, <code>fmi2EnterEventMode</code>, <code>fmi2EnterContinuousTimeMode</code>).</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #9:<br>
A new element <code>LogCategory</code> was introduced in <code>fmiModelDescription</code>. This is an unordered set of strings representing the possible values of the log categories of the FMU (for example, <code>logEvent</code>).<br>
Function <code>fmi2SetDebugLogging</code> has two new arguments to define the categories (from <code>LogCategory</code>) to be used in log messages.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #33:<br>
The <code>causality</code> and <code>variability</code> attributes of a <code>ScalarVariable</code> have not been fully clear. This has been fixed by changing the enumeration values of variability from <code>"constant, parameter, discrete, continuous"</code> to <code>"constant, fixed, tunable, discrete, continuous"</code> and causality from <code>"input output internal none"</code> to <code>"parameter, input, output, local"</code>. This change includes now also the support of parameters that can be tuned (changed) during simulation.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #35:<br>
In order to simplify implementation (for example, an "element event handler" is no longer needed in SAX XML parser), the only location where data is not defined by attributes, is changed to an attribute definition: Element <code>DirectDependency</code> in <code>ScalarVariable</code> is removed. The same information can now be obtained from the <code>InputDependency</code> attribute inside <code>&lt;fmiModelDescription&gt;&lt;ModelStructure&gt;&lt;Outputs&gt;</code>.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #37:<br>
The new status flag <code>fmi2Terminate</code> is added to the Co-Simulation definition. This allows a slave to terminate the simulation run before the stop time is reached without triggering an error.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #39:<br>
Wrong example in the previous section 2.10 of Co-Simulation has been fixed.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #41:<br>
New types introduced in fmi2TypesPlatform.h :<br>
<code>fmi2ComponentEnvironment</code>, <code>fmi2FMUstate</code>, <code>fmi2Byte</code>.<br>
Struct <code>fmi2CallbackFunctions</code> gets a new last argument:<br>
<code>fmi2ComponentEnvironment componentEnvironment</code><br>
The first argument of function <code>logger</code> is changed from type <code>fmi2Component</code>
to <code>fmi2ComponentEnvironment</code>.<br>
By these changes, a pointer to a data structure from the simulation environment is passed to the <code>logger</code> and allows the <code>logger</code>, for example, to transform a <code>valueReference</code> in the log message to a variable name.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #42:<br>
Enumerations defined in fmi2Type.xsd are now defined with (name, value) pairs. An enumeration value must be unique within the same enumeration (to have a bijective mapping between enumeration names and values, in order that results can optionally be presented with names and not with values).<br>
Furthermore, the <code>min/max</code> values of element <code>Enumeration</code> in <code>TypeDefinition</code> have been removed because they are meaningless.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #43:<br>
The previous header file fmiFunctions.h is split into 2 header files, fmi2FunctionTypes.h and fmi2Functions.h, in order to simplify the dynamic loading of an FMU (the typedefs of the function prototypes defined in fmi2FunctionTypes.h can be used to type case the function pointers of the dynamic loading).</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #45:<br>
Contrary to the ticket proposal, no new function <code>fmiResetModel</code> is added. Instead 6 new functions are added to get and set the internal FMU state via a pointer and to serialize and deserialize an FMU state via a byte vector provided by the environment. For details, see section 2.1.8. This feature allows, for example, to support more sophisticated co-simulation master algorithms which require the repetition of communication steps. Additionally, two capability flags have been added (<code>canGetAndSetFMUstate</code>, <code>canSerializeFMUstate</code>) in order to define whether these features are supported by the FMU.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #46:<br>
The unit definitions have been enhanced by providing an optional mapping to the 7 SI base units and the SI derived unit <code>"rad"</code>, in order for a tool to be able to check whether a signal provided to the FMU or inquired by the FMU has the expected unit.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #48:<br>
The definition of <code>fmiBoolean</code> in <code>fmiTypesPlatform.h</code> for <code>"standard32"</code> was changed from <code>char</code> to <code>int</code>. The main reason is to avoid unnecessary casting of Boolean types when exporting an FMU from a Modelica environment or when importing it into a Modelica environment.<br>
The current definition of <code>char</code> for a Boolean was not meaningful, since, for example, for embedded code generation usually Booleans are packed on integers and <code>char</code> for one Boolean would also not be used. It is planned to add more supported data types to an FMU in the future, which should then also include support for packed Booleans.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #49:<br>
Argument <code>fmiComponent</code> in function pointer <code>stepFinished</code> was changed to <code>fmi2ComponentEnvironment</code> (when <code>stepFinished</code> is called from a co-simulation slave and provides <code>fmi2ComponentEnvironment</code>, then this data structure provided by the environment can provide environment specific data to efficiently identify the slave that called the function).</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #54:<br>
In section 2.3 it is now stated, that the FMU must include all referenced resources. This means especially that for Microsoft VisualStudio the option "MT" has to be used when constructing a DLL in order to include the run-time environment of VisualStudio in the DLL.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #75:<br>
Since states are now explicitly defined in the XML file, function <code>fmiGetStateValueReferences</code> is no longer needed, as well as the special type <code>fmiUndefinedValueReference</code> that might be used as return value of this function. Therefore, both elements have been removed in FMI 2.0.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #85:<br>
New argument <code>noSetFMUStatePriorToCurrentPoint</code> to function <code>fmi2CompletedIntegratorStep</code>, similarly to <code>fmi2DoStep</code>, in order that the FMU can flush a result buffer if necessary.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #86:<br>
The fmi2TypesPlatform.h header file has been slightly changed: The default value of <code>fmi2TypesPlatform</code> is changed from <code>"standard32"</code> to <code>"default"</code>, since this definition holds for most platforms and compilers. Furthermore, the default type of <code>fmi2ValueReference</code> has been changed from <code>unsigned int</code> to <code>size_t</code>.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #88:<br>
The definition of fmi2Functions.h slightly changed to improve portability (the header file can now be utilized both for Microsoft and gnu compilers, and the danger of name conflicts has been reduced).</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #95:<br>
FMI XML files need to be UTF-8 encoded (as are XML schema files and strings in the C-API), in order to simplify reading of XML files.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #113:<br>
Changed function name <code>fmiTerminateSlave</code> to <code>fmi2Terminate</code> in order to be consistent with the other function definitions (<code>fmi2EnterSlaveInitializationMode</code>, <code>fmi2Terminate</code>).</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #115:<br>
Clarification added, that the special values <code>NAN</code>, <code>+INF</code>, <code>-INF</code>, are not allowed in the FMI XML files.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #127:<br>
Added clarifications in section 2.1, that all C-API functions are not thread safe and that FMUs must not influence each other.</p>
</div>
<div class="paragraph second-indented">
<p>Fixing ticket #218:<br>
Changed all name prefixes from <code>fmi</code> to <code>fmi2</code> in *.h, *.xsd, *.png files and in the specification to avoid compiler and linker problems when supporting both FMI 1.0 and 2.0 in the same program.</p>
</div>
<div class="paragraph second-indented">
<p>Function <code>fmiInitialize</code> was split into two functions: <code>fmi2EnterInitializationMode</code> and <code>fmi2ExitInitializationMode</code> in order that artificial or "real" algebraic loops over connected FMUs can be handled in an efficient way.</p>
</div>
<div class="paragraph second-indented">
<p>Function <code>stepEvent</code> in <code>struct fmi2CallbackFunctions</code> had different locations in the FMI documentation and in the header file. This inconsistency has been corrected by using the location in the header file (at the end of the <code>struct</code>).</p>
</div>
<div class="paragraph second-indented">
<p>The <code>struct fmi2CallbackFunctions</code> is provided as a pointer to the <code>struct</code> when instantiating an FMU, and not as the <code>struct</code> itself. This simplifies the importing of an FMU into a Modelica environment.</p>
</div>
<div class="paragraph second-indented">
<p>Defined how to utilize the <code>min</code>/<code>max</code> attributes for <code>fmi2SetReal</code>, <code>fmi2SetInteger</code>, <code>fmi2GetReal</code>, <code>fmi2GetInteger</code> calls.</p>
</div>
<div class="paragraph second-indented">
<p>Attributes <code>numberOfScalarVariables</code>, <code>numberOfContinuousStates</code>, <code>numberOfInputs</code>, <code>numberOfOutputs</code> available in FMI 1.0 have been removed, because they can be deduced from the remaining XML file (so in FMI 2.0 this would have been redundant information).</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_3_contributors">A.3.3 Contributors</h4>
<div class="paragraph">
<p>The development group for this version was headed by Torsten Blochwitz (ITI). The essential part of the design of this version was performed by (alphabetical list):</p>
</div>
<div class="paragraph indented2">
<p>Johan Akesson, Modelon, Sweden<br>
Martin Arnold, University Halle, Germany<br>
Torsten Blochwitz, ITI, Germany<br>
Christoph Clauss, Fraunhofer IIS EAS, Germany<br>
Hilding Elmqvist, Dassault Systèmes, Sweden<br>
Rüdiger Franke, ABB AG, Germany<br>
Markus Friedrich, SIMPACK AG, Germany<br>
Lev Greenberg, IBM Research, Israel<br>
Andreas Junghanns, QTronic, Germany<br>
Jakob Mauss, QTronic, Germany<br>
Iakov Nakhimovski, Modelon, Sweden<br>
Dietmar Neumerkel, Daimler AG, Germany<br>
Hans Olsson, Dassault Systèmes, Sweden<br>
Martin Otter, DLR RMC-SR, Germany<br>
Antoine Viel, Siemens PLM Software, France</p>
</div>
<div class="paragraph">
<p>The FMI 2.0 document was edited by Martin Otter (DLR), Torsten Blochwitz (ITI), and Martin Arnold (Uni Halle). The State Machines and tables for the Calling Sequences for Model Exchange and Co-Simulation are from Jakob Mauss (QTronic).</p>
</div>
<div class="paragraph">
<p>This version was evaluated with prototypes implemented for (alphabetical
list):</p>
</div>
<div class="paragraph indented2">
<p>Dymola by Peter Nilsson, Karl Wernersson, and Sven Erik Mattson, Dassault Systèmes, Sweden<br>
FMI Compliance Checker by Iakov Nakhimovski, Modelon AB, Sweden<br>
LMS Imagine.Lab AMESim by Antoine Viel, Siemens PLM Software, France<br>
MapleSim, by Kaska Kowalska, Maplesoft, Canada<br>
Silver by Andreas Junghanns, QTronic, Germany<br>
SimulationX by Torsten Blochwitz, ITI, Germany<br>
SCALEXIO and VEOS by Irina Zacharias, Andreas Pillekeit, dSPACE GmbH, Germany<br>
xMOD by Mongi ben Gaid, Bertrand Hugon, Bruno Léty, and Fabien Debertolis, IFPEN, France</p>
</div>
<div class="paragraph">
<p>These prototypes have been used to refine the design of "FMI 2.0 for Model Exchange and Co-Simulation".</p>
</div>
<div class="paragraph">
<p>The open source FMITest library (<a href="https://svn.fmi-standard.org/fmi/branches/public/Test_FMUs/_FMIModelicaTest/FMITest/help/FMITest.html" class="bare">https://svn.fmi-standard.org/fmi/branches/public/Test_FMUs/_FMIModelicaTest/FMITest/help/FMITest.html</a>) to test difficult cases of connected FMUs was implemented by Martin Otter (DLR, Germany) based on suggestions by Hilding Elmqvist (Dassault Systèmes, Sweden) and Torsten Blochwitz (ITI, Germany).</p>
</div>
<div class="paragraph">
<p>The following partners participated at FMI 2.0 design meetings and contributed to the discussion (alphabetical list):</p>
</div>
<div class="paragraph indented2">
<p>Johan Akesson, Modelon, Sweden<br>
Christian Andersson, Modelon, Sweden<br>
Martin Arnold, University Halle, Germany<br>
Adeel Asghar, PELAB, Sweden<br>
Mongi Ben-Gaid, IFP, France<br>
Christian Bertsch, Robert Bosch GmbH, Germany<br>
Torsten Blochwitz, ITI, Germany<br>
Christoph Clauss, Fraunhofer IIS EAS, Germany<br>
Alex Eichberger, SIMPACK AG, Germany<br>
Hilding Elmqvist, Dassault Systèmes, Sweden<br>
Rüdiger Franke, ABB AG, Germany<br>
Markus Friedrich, SIMPACK AG, Germany<br>
Peter Fritzson, PELAB, Sweden<br>
Rafael Gilles (Erbacher), dSPACE GmbH, Germany<br>
Lev Greenberg, IBM Research, Israel<br>
Anton Haumer, Modelon, Germany<br>
Andreas Junghanns, QTronic, Germany<br>
Karsten Krügel, dSPACE GmbH, Germany<br>
Edward Lee, Berkeley University, U.S.A.<br>
Bruno Loyer, Siemens PLM Software, France<br>
Petter Lindholm, Modelon, Sweden<br>
Kristin Majetta, Fraunhofer IIS EAS, Germany<br>
Sven Erik Mattsson, Dassault Systèmes, Sweden<br>
Jakob Mauss, QTronic, Germany<br>
Monika Mühlbauer, Siemens AG, Germany<br>
Dietmar Neumerkel, Daimler AG, Germany<br>
Peter Nilsson, Dassault Systèmes, Sweden<br>
Hans Olsson, Dassault Systèmes, Sweden<br>
Martin Otter, DLR RMC-SR, Germany<br>
Nicolas Pernet, IFPEN, France<br>
Andreas Pillekeit, dSPACE GmbH, Germany<br>
Bernd Relovsky, Daimler AG, Germany<br>
Tom Schierz, University Halle, Germany<br>
Chad Schmitke, Maplesoft, Canada<br>
Stefan-Alexander Schneider, BMW, Germany<br>
Klaus Schuch, AVL List GmbH, Austria<br>
Bernhard Thiele, DLR RMC-SR, Germany<br>
Antoine Viel, Siemens PLM Software, France<br>
Karl Wernersson, Dassault Systèmes, Sweden<br>
Irina Zacharias, dSPACE GmbH, Germany</p>
</div>
<div class="paragraph">
<p>The following people contributed with comments (alphabetical list):</p>
</div>
<div class="paragraph indented2">
<p>Peter Aaronsson, MathCore, Sweden<br>
Bernhard Bachmann, University of Bielefeld, Germany<br>
Andreas Pfeiffer, DLR RMC-SR</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_4_fmi_2_0_1_maintenane_release_changes_and_contributors">A.3.4 FMI 2.0.1 maintenane release: changes and contributors</h4>
<div class="paragraph">
<p>The changes w.r.t. FMI 2.0 (clarifications and bugfixes) are summarized on the release page for FMI 2.0.1 <a href="https://github.com/modelica/fmi-standard/releases/tag/v2.0.1" class="bare">https://github.com/modelica/fmi-standard/releases/tag/v2.0.1</a></p>
</div>
<div class="paragraph">
<p>The following partners participated at FMI 2.0.1 meetings (alphabetical list):</p>
</div>
<div class="paragraph">
<p>Christian Bertsch, Robert Bosch GmbH, Germany<br>
Torsten Blochwitz, ESI ITI GmbH, Germany<br>
Robert Braun, Linköping University, Sweden<br>
Andreas Junghanns, QTronic GmbH, Germany<br>
Pierre R. Mai, PMSF IT Consulting, Germany<br>
Masoud Najafi, Altair, France<br>
Andreas Pillekeit, dSPACE GmbH, Germany<br>
Torsten Sommer, Dassault Systèmes, Germany<br>
Karl Wernersson, Dassault Systèmes, Sweden</p>
</div>
<div class="paragraph">
<p>For further contributors by comments please refer to the issue tracking system <a href="https://github.com/modelica/fmi-standard/milestone/3" class="bare">https://github.com/modelica/fmi-standard/milestone/3</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_5fmi_2_0_2_maintenance_release_changes_and_contributors">A.3.5	FMI 2.0.2 maintenance release: changes and contributors</h4>
<div class="paragraph">
<p>The changes w.r.t. FMI 2.0.1 (clarifications and bugfixes) are summarized on the release page for FMI 2.0.2
<a href="https://github.com/modelica/fmi-standard/releases/tag/v2.0.2" class="bare">https://github.com/modelica/fmi-standard/releases/tag/v2.0.2</a></p>
</div>
<div class="paragraph">
<p>For contributors please refer to the issue tracking system <a href="https://github.com/modelica/fmi-standard/milestone/15" class="bare">https://github.com/modelica/fmi-standard/milestone/15</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_a_3_6fmi_2_0_3_maintenance_release_changes_and_contributors">A.3.6	FMI 2.0.3 maintenance release: changes and contributors</h4>
<div class="paragraph">
<p>The changes w.r.t. FMI 2.0.2(clarifications and bugfixes) are summarized on the release page for FMI 2.0.3
<a href="https://github.com/modelica/fmi-standard/releases/tag/v2.0.3" class="bare">https://github.com/modelica/fmi-standard/releases/tag/v2.0.3</a></p>
</div>
<div class="paragraph">
<p>For contributors please refer to the issue tracking system <a href="https://github.com/modelica/fmi-standard/milestone/18" class="bare">https://github.com/modelica/fmi-standard/milestone/18</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_glossary">Appendix B: Glossary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This glossary is a subset of (<em>MODELISAR Glossary, 2009</em>) with some extensions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Term</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>algorithm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A formal recipe for solving a specific type of problem.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>application programming interface (API)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of functions, procedures, methods or classes together with type conventions/declarations (for example, C header files) that an operating system, library or service provides to support requests made by computer programs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>AUTOSAR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AUTomotive Open System ARchitecture (<a href="http://www.autosar.org/">www.autosar.org</a>).<br>
Evolving standard of the automotive industry to define the implementation of embedded systems in vehicles including communication mechanisms. An important part is the standardization of C functions and macros to communicate between software components. AUTOSAR is targeted to build on top of the real-time operating system OSEK (<a href="http://www.osek-vdx.org/">www.osek-vdx.org</a>, <a href="http://de.wikipedia.org/wiki/OSEK">de.wikipedia.org/wiki/OSEK</a>). The use of the AUTOSAR standard requires AUTOSAR membership.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time grid for data exchange between master and slaves in a co-simulation environment (also known as "sampling points" or "synchronization points").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>communication step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>communication points</em> (also known as "sampling rate" or "macro step size").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>co-simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coupling (in other words, dynamic mutual exchange and utilization of intermediate results) of several <em>simulation programs</em> including their numerical solvers in order to simulate a system consisting of several subsystems.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>co-simulation platform</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software used for coupling several <em>simulation programs</em> for <em>co-simulation.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ECU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Electronic Control Unit (Microprocessor that is used to control a subsystem in a vehicle).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something that occurs instantaneously at a specific time or when a specific condition occurs. At an event, numerical integration is suspended and variables may change their values discontinuously.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface:<br>
Interface of a functional mock-up in form of a model. In analogy to the term digital mock-up (see <em>mock-up</em>), functional mock-up describes a computer-based representation of the functional behavior of a system for all kinds of analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Co-Simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Co-Simulation:<br>
One of the MODELISAR <em>functional mock-up interfaces.</em> It connects the <em>master solver</em> component with one or more <em>slave solvers</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMI for Model Exchange</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Interface for Model Exchange:<br>
One of the MODELISAR <em>functional mock-up interfaces.</em> It consists of the <em>model description interface</em> and the <em>model execution interface</em>.<br>
It connects the <em>external model</em> component with the <em>solver</em> component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>FMU</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Functional Mock-up Unit:<br>
A "model class" from which one or more "model instances" can be instantiated for simulation. An FMU is stored in one ZIP file as defined in section 2.3 consisting basically of one XML file that defines the model variables and a set of C functions (see section 2.1), in source or binary form, to execute the model equations or the simulator slave. In case of tool execution, additionally, the original simulator is required to perform the co-simulation (compare section 4.3.1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integration algorithm</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The numerical algorithm to solve differential equations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>integrator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>software component</em>, which implements an <em>integration algorithm</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An abstraction of a <em>software component</em> that describes its behavior without dealing with the internal implementation. <em>Software components</em> communicate with each other via interfaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>master/slave</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A method of communication, where one device or process has unidirectional control over one or more other devices. Once a master/slave relationship between devices or processes is established, the direction of control is always from the master to the slaves. In some systems a master is elected from a group of eligible devices, with the other devices acting in the role of slaves.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>mock-up</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A full-sized structural, but not necessarily functional model built accurately to scale, used chiefly for study, testing, or display. In the context of computer aided design (CAD), a digital mock-up (DMU) means a computer-based representation of the product geometry with its parts, usually in 3-D, for all kinds of geometrical and mechanical analyses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A model is a mathematical or logical representation of a system of entities, phenomena, or processes. Basically a model is a simplified abstract view of the complex reality.<br>
It can be used to compute its expected behavior under specified conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description file</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The model description file is an XML file, which supplies a description of all properties of a <em>model</em> (for example, input/output variables).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>model description interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An interface description to write or retrieve information from the <em>model description file</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Model Description Schema</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An <em>XML</em> schema that defines how all relevant, non-executable, information about a "model class" (<em>FMU)</em> is stored in a text file in <em>XML</em> format. Most important, data for every variable is defined (variable name, handle, data type, variability, unit, etc.), see section 2.2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>numerical solver</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>solver</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output points</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool internal time grid for saving output data to file (in some tools also known as "<em>communication points</em>" – but this term is used in a different way in FMI for Co-Simulation, see above).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>output step size</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distance between two subsequent <em>output points</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>parameter</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A quantity within a <em>model</em>, which remains constant during <em>simulation (fixed parameter) or may change at event instances (tunable parameter)</em>. Examples are a mass, stiffness, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>slave</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>master/slave</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute the behavior of one or several <em>models</em> under specified conditions.<br>
(see also <em>co-simulation</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation model</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>model</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation program</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software to develop and/or solve simulation <em>models</em>. The software includes a <em>solver</em>, may include a user interface and methods for post processing (see also: <em>simulation tool</em>, <em>simulation environment</em>).<br>
Examples of simulation programs are: AMESim, Dymola, SIMPACK, SimulationX, SIMULINK.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulation tool</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">see <em>simulation program</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>simulator</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simulator can include one or more <em>simulation programs</em>, which solve a common simulation task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>solver</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Software component,</em> which includes algorithms to solve <em>model</em>s, for example, <em>integration algorithms</em> and <em>event handling</em> methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The "continuous states" of a model are all variables that appear differentiated in the model and are independent from each other.<br>
The "discrete states" of a model are time-discrete variables that have two values in a model: The value of the variable from the previous <em>event</em> instant, and the value of the variable at the actual event instant.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>state event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by the time instant where the domain \(z &gt; 0\) of an event indicator variable <code>z</code> is changed to \(z \leq 0\), or vice versa.<br>
This definition is slightly different from the usual standard definition of state events: "\(z(t)*z(t_{i-1}) \leq 0\)" which has the severe drawback that the value of the event indicator at the previous event instant, \(z(t_{i-1}) \neq 0\), must be non-zero and this condition cannot be guaranteed. The often used term "zero crossing function" for <code>z</code> is misleading (and is therefore not used in this document), since a state event is defined by a change of a domain and not by a zero crossing of a variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>step event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that might occur at a completed integrator step. Since this event type is not defined by a precise time or condition, it is usually not defined by a user. A program may use it, for example, to dynamically switch between different states. A step event is handled much more efficiently than a <em>state event</em>, because the event is just triggered after performing a check at a completed integrator step, whereas a search procedure is needed for a state event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>super dense time</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A precise definition of time taking into account iterations at an event. For an <em>FMU</em>, the independent variable time \(t \in \mathbb{T}\) is a tuple \(t = (t_R, t_I)\) where \(t_R \in  \mathbb{R}, t_I \in \mathbb{N} = \{0,1,2,\ldots\}\). The real part \(t_R\) of this tuple is the independent variable of the FMU for describing the continuous-time behavior of the model between events. In this phase \(t_I = 0\). The integer part \(t_I\) of this tuple is a counter to enumerate (and therefore distinguish) the events at the same continuous-time instant \(t_R\).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>time event</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Event</em> that is defined by a predefined time instant. Since the time instant is known in advance, the integrator can select its step size so that the event point is directly reached. Therefore, this event can be handled efficiently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>user interface</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The part of the simulation program that gives the user control over the simulation and allows watching results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>value reference</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of a scalar variable of an FMU is identified with an Integer handle called <em>value reference</em>. This handle is defined in the modelDescription.xml file (as attribute <code>valueReference</code> in element <code>ScalarVariable</code>). Element <code>valueReference</code> might not be unique for all variables. If two or more variables of the same base data type (such as <code>fmi2Real</code>) have the same <code>valueReference</code>, then they have identical values but other parts of the variable definition might be different (for example, min/max attributes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XML</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eXtensible Markup Language (<a href="http://www.w3.org/XML/">www.w3.org/XML</a>, <a href="http://en.wikipedia.org/wiki/Xml">en.wikipedia.org/wiki/XML</a>) – An open standard to store information in text files in a structured form.</p></td>
</tr>
</tbody>
</table>
<script>
// hide / show the Table of Contents (TOC)
function toggleTOC() {
  var toc = document.getElementById("toc");
  var body = document.getElementsByTagName("body")[0];

  if (toc.style.display === "none") {
      toc.style.display = "block";
      body.classList.remove("toc-hidden");
  } else {
      toc.style.display = "none";
      body.classList.add("toc-hidden");
  }
}

// toggle the TOC when "t" key is pressed
document.addEventListener('keydown', (event) => {
  if (event.key == 't') {
    toggleTOC();
  }
});
</script>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. ModelicaはModelica Associationの登録商標であり、SimulinkはMathWorks Inc. はMathWorks Inc.の登録商標、SIMPACKはSIMPACK AGの登録商標です。
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. MicrosoftとCygwinのコンパイラではFMI2_Export` は <code>__declspec(dllexport)</code> として定義され、Gnu-Compilers では <code>FMI2_Export</code> は <code>__attribute__ ( ( visibility("default") ) )</code> として定義され、ダイナミックローディングのために名前をエクスポートします。 それ以外は空の定義となります。
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. 関数 <code>fmi2SetXXX</code> は通常、計算を行わず、渡された値を内部バッファに格納するだけです。 実際の計算は`fmi2GetXXX`関数が行います。 しかし、<code>fmi2SetXXX`関数は、入力された引数が有効範囲内にあるかどうかをチェックすることができます。 そうでない場合、これらの関数は `fmi2Discard</code> で返すことができます。
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. 通常、`fmi2Error`は「ディスクが一杯です」などの数字にならない理由で返されます。 fmi2SetFMUstate`で定義された最後の一貫した状態でシミュレーションを続行することができます。
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. fmiModelDescription.xml`ファイルで`causality = "independent"`と定義されている変数です。
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. Note that the screenshots of this section have been generated from the schema files with the tool "Altova XMLSpy" (www.altova.com). With the enterprise edition of XMLSpy it is possible to automatically generate C++, C# and Java code that reads an XML file of fmiModelDescription.xsd. An efficient open source XML parser is SAX (<a href="http://sax.sourceforge.net/" class="bare">http://sax.sourceforge.net/</a>, <a href="http://en.wikipedia.org/wiki/Simple_API_for_XML" class="bare">http://en.wikipedia.org/wiki/Simple_API_for_XML</a>). All data from the XML file is only defined via "attributes" and not via "elements". Therefore, only an "attribute" handler needs to be defined for a SAX parser.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. Note, elements <code>&lt;ModelVariables&gt;</code> and <code>&lt;ModelStructure&gt;</code> are mandatory, whereas <code>&lt;UnitDefinitions&gt;</code>, <code>&lt;TypeDefinitions&gt;</code>, <code>&lt;LogCategories&gt;</code>, <code>&lt;DefaultExperiment&gt;</code>, <code>&lt;VendorAnnotation&gt;</code> are optional. If an optional element is present and defines a list (such as <code>&lt;UnitDefinitions&gt;</code>), the list must have at least one element (such as <code>&lt;Unit&gt;</code>).
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. If no units are defined, element <code>&lt;UnitDefinitions&gt;</code> must not be present. If 1 or more units are defined, this element must be present.
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. This definition is identical to the syntax of an identifier in Modelica version 3.2.
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. The notation \(^{\bullet}t\) is from (<em>Benveniste et.al. 2010</em>) adapted from non-standard analysis to super-dense time, in order to precisely define the value from the previous event iteration.
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. This definition is slightly different from the standard definition of state events: "\(z_j(t) \cdot z_j(t_{i-1}) \leq 0\)". This often used definition has the severe drawback that \(z_j(t_{i-1}) \ne 0\) is required in order to be well-defined and this condition cannot be guaranteed.
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>